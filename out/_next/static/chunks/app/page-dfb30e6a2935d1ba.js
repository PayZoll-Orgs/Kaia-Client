(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{47790:()=>{},54283:()=>{},59137:(e,s,t)=>{Promise.resolve().then(t.bind(t,88059))},73776:()=>{},79368:()=>{},88059:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eb});var a=t(95155),r=t(14124),l=t(12115),n=t(13533),o=t(36834),i=t(22441),c=t(88796),d=t(36337),m=t(9252),x=t(53866),u=t(24685),h=t(17332),g=t(20039);function p(e){let{isOpen:s,onClose:t,onScan:n}=e,{isInLineApp:o}=(0,r.A)(),[i,c]=(0,l.useState)(""),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{s&&(console.log("\uD83D\uDD0D LIFFQRScanner Debug:",{isInLineApp:o,userAgent:navigator.userAgent,hasLiff:"liff"in window,currentURL:window.location.href}),console.log("\uD83D\uDD0D UserAgent checks:",{isLINEUserAgent:navigator.userAgent.includes("Line"),isLIFFUserAgent:navigator.userAgent.includes("LIFF"),fullUserAgent:navigator.userAgent}))},[s,o]);let x=async()=>{console.log("\uD83D\uDD0D Attempting QR scan, isInLineApp:",o),o||console.warn("⚠️ LINE app not detected, but attempting scan anyway for debugging"),m(!0),c("");try{console.log("\uD83D\uDE80 Attempting to call LIFFAuth.scanQRCode()..."),"liff"in window?console.log("✅ LIFF object found in window"):console.warn("⚠️ LIFF object not found in window");let e=await g.Oi.scanQRCode();console.log("\uD83D\uDCF1 QR scan completed, result:",e),e?(console.log("✅ QR scan successful:",e),n(e)):console.log("ℹ️ QR scan cancelled or no result"),t()}catch(t){var e,s;console.error("❌ LIFF QR scan error:",t),console.error("\uD83D\uDD0D Error details:",{error:t,message:t instanceof Error?t.message:"Unknown error",stack:t instanceof Error?t.stack:"No stack trace"}),"UNAUTHORIZED"===t.code?c("Camera permission denied"):"INTERNAL_ERROR"===t.code?c("QR scanning failed. Please try again."):(null==(e=t.message)?void 0:e.includes("not available"))?c("QR scanning not available in this environment"):(null==(s=t.message)?void 0:s.includes("not initialized"))?c("LIFF not properly initialized"):c("Failed to scan QR code: ".concat(t.message||"Unknown error"))}finally{m(!1)}};return(0,l.useEffect)(()=>{s&&(c(""),m(!1))},[s]),(0,a.jsx)(u.e,{appear:!0,show:s,as:l.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,a.jsx)(h.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 mb-4",children:"QR Code Scanner"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-32 h-32 mx-auto mb-6 bg-gray-100 rounded-2xl flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),!o&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-yellow-800 text-sm",children:["LINE app detection: ",o?"Detected":"Not detected"]}),(0,a.jsx)("p",{className:"text-yellow-700 text-xs mt-1",children:"Attempting scan anyway for debugging..."})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:o?"Tap the button below to open LINE's QR code scanner":"Attempting to access QR scanner (debug mode)"}),(0,a.jsx)("button",{onClick:x,disabled:d,className:"w-full ".concat(o?"bg-green-500 hover:bg-green-600":"bg-orange-500 hover:bg-orange-600"," disabled:bg-gray-300 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center space-x-2"),children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Opening Scanner..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),(0,a.jsx)("span",{children:o?"Scan QR Code":"Try QR Scan (Debug)"})]})})]}),i&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-red-800 text-sm",children:i})})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{type:"button",className:"w-full inline-flex justify-center rounded-xl border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:t,children:"Cancel"})})]})})})})]})})}var f=t(46830);async function b(e){console.log("\uD83D\uDD0D Getting real USDT balance for:",e);try{let{WalletService:s}=await Promise.resolve().then(t.bind(t,86867)),a=s.getInstance(),r=await a.getTokenBalance(f.PI.USDT_ADDRESS,e),l=parseFloat(r).toFixed(2),n=Math.round(1e18*parseFloat(r)).toString();return console.log("✅ Real USDT balance:",l,"USDT"),console.log("\uD83D\uDD0D Balance details:",{formatted:r,display:l,rawWei:n,decimals:18}),{balance:l,rawBalance:n,decimals:18,symbol:"USDT",contractAddress:f.PI.USDT_ADDRESS}}catch(e){return console.error("❌ Failed to get USDT balance:",e),{balance:"0.00",rawBalance:"0",decimals:6,symbol:"USDT",contractAddress:f.PI.USDT_ADDRESS}}}async function j(e){console.log("\uD83D\uDEB0 Requesting USDT from faucet using LIFF wallet only..."),console.log("\uD83D\uDD0D Wallet address:",e),console.log("\uD83D\uDD0D Target contract:",f.PI.USDT_ADDRESS);try{console.log("\uD83D\uDD04 Skipping gasless service - using LIFF wallet directly");let{WalletService:s}=await Promise.resolve().then(t.bind(t,86867)),a=s.getInstance();console.log("\uD83D\uDD0D Checking wallet connection status...");let r=a.getState();if(console.log("\uD83D\uDCCA Wallet state:",{isConnected:r.isConnected,address:r.address,walletType:r.walletType,isLoading:r.isLoading,error:r.error}),!r.isConnected||!r.address)throw console.error("❌ LIFF wallet not connected:",r),Error("LIFF wallet not connected");r.address.toLowerCase()!==e.toLowerCase()&&console.warn("⚠️ Address mismatch:",{requested:e,connected:r.address});let l="0xde5f72fd";console.log("\uD83D\uDCDD Creating faucet transaction with parameters:",{contract:f.PI.USDT_ADDRESS,methodId:l,methodName:"faucet()",from:r.address,to:f.PI.USDT_ADDRESS,value:"0x0",gasLimit:"0x15f90",data:l}),console.log("\uD83D\uDD0D Contract analysis:"),console.log("  - Contract: DummyUSDT"),console.log("  - Function: faucet() external"),console.log("  - No parameters required"),console.log("  - Cooldown: 24 hours (FAUCET_COOLDOWN)"),console.log("  - Amount: 1000 tokens (FAUCET_AMOUNT = 1000 * 10^18)"),console.log("  - Requires contract to have balance"),console.log("\uD83D\uDE80 Sending faucet transaction through LIFF wallet...");let n=await a.sendTransaction(f.PI.USDT_ADDRESS,"0x0","0x15f90",l);return console.log("✅ LIFF wallet faucet transaction sent successfully!"),console.log("\uD83D\uDCDC Transaction hash:",n),console.log("\uD83D\uDD0D View on Kaiascan:","https://kairos.kaiascope.com/tx/".concat(n)),{success:!0,transactionHash:n,amount:"1000.00",gasless:!1}}catch(e){return console.error("❌ Faucet request failed:",e),{success:!1,error:e instanceof Error?e.message:"Faucet request failed",gasless:!1}}}async function y(e,s,a){console.log("\uD83D\uDCB8 Transferring USDT using LIFF wallet only...",{from:e,to:s,amount:a});try{console.log("\uD83D\uDD04 Skipping gasless service - using LIFF wallet directly for P2P transfer");let{WalletService:e}=await Promise.resolve().then(t.bind(t,86867)),r=e.getInstance(),l=r.getState();if(console.log("\uD83D\uDD0D P2P Transfer - Wallet state:",l),!l.isConnected||!l.address)throw Error("LIFF wallet not connected");let n=Math.round(1e18*parseFloat(a));console.log("\uD83D\uDCB0 Amount conversion:",{originalAmount:a,amountInWei:n,decimals:18});let o=s.replace("0x","").toLowerCase().padStart(64,"0"),i=n.toString(16).padStart(64,"0"),c="0xa9059cbb"+o+i;console.log("\uD83D\uDCDD Creating ERC20 transfer transaction:",{contract:f.PI.USDT_ADDRESS,data:c,amountInWei:n});let d=await r.sendTransaction(f.PI.USDT_ADDRESS,"0x0","0x15f90",c);return console.log("✅ LIFF wallet transaction sent:",d),{success:!0,transactionHash:d,gasless:!1}}catch(e){return console.error("❌ USDT transfer failed:",e),{success:!1,error:e instanceof Error?e.message:"Transfer failed",gasless:!1}}}var v=t(43569),N=t(41715),w=t(40707),S=t(6956),k=t(88125);function C(e){let{isOpen:s,onClose:t,currentBalance:n,requiredAmount:o,onBalanceUpdated:i}=e,{wallet:c}=(0,r.A)(),[d,m]=(0,l.useState)(!1),[x,u]=(0,l.useState)(null),[h,g]=(0,l.useState)(!1),p=async()=>{if(!c.address)return void u("Wallet not connected");m(!0),u(null);try{let e=await j(c.address);e.success?(g(!0),setTimeout(()=>{i(),t()},3e3)):u(e.error||"Failed to get USDT from faucet")}catch(e){u(e instanceof Error?e.message:"Unknown error")}finally{m(!1)}},f=(parseFloat(o)-parseFloat(n)).toFixed(2);return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"w-6 h-6 text-amber-500"}),"Insufficient Balance"]}),(0,a.jsx)("button",{onClick:t,disabled:d,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(v.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[h?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"USDT Added!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Your balance has been updated. You can now complete your transaction."}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Closing automatically..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-amber-800",children:"Current Balance:"}),(0,a.jsxs)("span",{className:"font-medium text-amber-900",children:[n," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-amber-800",children:"Required:"}),(0,a.jsxs)("span",{className:"font-medium text-amber-900",children:[o," USDT"]})]}),(0,a.jsxs)("div",{className:"border-t border-amber-200 pt-2 flex justify-between",children:[(0,a.jsx)("span",{className:"text-amber-800 font-medium",children:"Need:"}),(0,a.jsxs)("span",{className:"font-bold text-amber-900",children:[f," USDT"]})]})]})}),(0,a.jsx)("p",{className:"text-gray-600",children:"You don't have enough USDT to complete this transaction. Get free test USDT from the faucet to continue."}),(0,a.jsxs)("button",{onClick:p,disabled:d,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[(0,a.jsx)(w.A,{className:"w-5 h-5"}),d?"Getting USDT...":"Get Free USDT"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"This will add 50 USDT to your testnet balance"})]}),x&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:x})]}),!h&&!d&&(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center mb-3",children:"Alternative options:"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:t,className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors text-sm font-medium text-gray-700",children:"Cancel Transaction"}),(0,a.jsx)("button",{onClick:()=>{t()},className:"flex-1 py-2 px-4 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium text-blue-700",children:"Check Portfolio"})]})]})]})]})}):null}function A(e){let{isOpen:s,onClose:t,onSuccess:n}=e,{user:o,wallet:i}=(0,r.A)(),[c,m]=(0,l.useState)("search"),[x,u]=(0,l.useState)(""),[h,g]=(0,l.useState)([]),[p,j]=(0,l.useState)([]),[A,T]=(0,l.useState)(null),[D,I]=(0,l.useState)(""),[F,L]=(0,l.useState)(!1),[E,U]=(0,l.useState)(null),[R,P]=(0,l.useState)("0"),[B,M]=(0,l.useState)(!1),[W,_]=(0,l.useState)(!1),O=(0,l.useCallback)(async()=>{if(i.address){M(!0);try{let e=await b(i.address);P(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{M(!1)}}},[i.address]),K=(0,l.useCallback)(async e=>{L(!0);try{console.log("\uD83D\uDD0D Fetching all users from backend...");let s=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS),{method:"GET",headers:{"Content-Type":"application/json"}});if(s.ok){let t=await s.json();console.log("\uD83D\uDCCB Retrieved users:",t.length),j(t);let a=t.filter(e=>e.lineUserId!==(null==o?void 0:o.userId));if(e&&e.length>=2){let s=e.toLowerCase();a=a.filter(e=>{var t,a;return(null==(t=e.displayName)?void 0:t.toLowerCase().includes(s))||(null==(a=e.userId)?void 0:a.toLowerCase().includes(s))})}g(a),console.log("✅ Filtered results:",a.length)}else console.error("Failed to fetch users:",s.status),g([])}catch(e){console.error("Error fetching users:",e),g([])}finally{L(!1)}},[null==o?void 0:o.userId]);(0,l.useEffect)(()=>{let e=setTimeout(()=>{K(x)},500);return()=>clearTimeout(e)},[x,K]),(0,l.useEffect)(()=>{s&&(O(),m("search"),u(""),T(null),I(""),U(null),K(""))},[s,O,K]);let z=async()=>{if(!A||!D||!i.address||!(null==o?void 0:o.userId))return void U("Missing payment information");m("processing"),U(null);try{console.log("\uD83D\uDCB8 Executing USDT transfer...",{from:i.address,to:A.walletAddress,amount:D});let e=await y(i.address,A.walletAddress,D);if(!e.success)throw Error(e.error||"Transfer failed");console.log("\uD83D\uDCDD Recording P2P transaction...");let s=p.find(e=>e.lineUserId===(null==o?void 0:o.userId)),a=(null==s?void 0:s.userId)||(null==o?void 0:o.userId);console.log("✅ Using backend userId as senderId:",a);let r=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.P2P.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:a,receiverId:A.userId,amount:parseFloat(D),transactionHash:e.transactionHash,status:"completed"})});r.ok||console.warn("Failed to record transaction in backend:",r.status),console.log("✅ Payment completed successfully!"),n(e.transactionHash,A,D),t()}catch(e){console.error("❌ Payment failed:",e),U(e instanceof Error?e.message:"Payment failed"),m("confirm")}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["search"!==c&&"processing"!==c&&(0,a.jsx)("button",{onClick:()=>{"amount"===c?(m("search"),T(null)):"confirm"===c&&m("amount"),U(null)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900",children:["search"===c&&"Pay Anyone","amount"===c&&"Enter Amount","confirm"===c&&"Confirm Payment","processing"===c&&"Processing..."]})]}),(0,a.jsx)("button",{onClick:t,disabled:"processing"===c,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(v.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsxs)("div",{className:"p-6",children:["search"===c&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(N.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by username or display name...",value:x,onChange:e=>u(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:[F&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Searching..."})]}),!F&&x&&0===h.length&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(d.A,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No users found"})]}),h.map(e=>(0,a.jsx)("button",{onClick:()=>{T(e),m("amount"),U(null)},className:"w-full p-3 border border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(e.displayName),"&background=random"),alt:e.displayName,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["@",e.userId]})]})]})},e._id)),!x&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(N.A,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Search for users to send USDT"})]})]})]}),"amount"===c&&A&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("img",{src:A.pictureUrl||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(A.displayName),"&background=random"),alt:A.displayName,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:A.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["@",A.userId]})]})]})}),(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-green-800 font-medium",children:"Your USDT Balance:"}),(0,a.jsx)("span",{className:"text-green-800 font-bold",children:B?"Loading...":"".concat(R," USDT")})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Send (USDT)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:D,onChange:e=>{var s;return s=e.target.value,void(/^\d*\.?\d*$/.test(s)&&(I(s),U(null)))},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"})]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:["1","5","10","25"].map(e=>(0,a.jsxs)("button",{onClick:()=>I(e),className:"flex-1 py-2 px-3 border border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-sm font-medium",children:[e," USDT"]},e))}),(0,a.jsx)("button",{onClick:()=>{(!D||0>=parseFloat(D)?(U("Please enter a valid amount"),1):parseFloat(D)>parseFloat(R)&&(_(!0),1))||m("confirm")},disabled:!D||0>=parseFloat(D),className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Continue to Confirmation"})]}),"confirm"===c&&A&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Payment Summary"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"To:"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-medium",children:A.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["@",A.userId]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[D," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Network:"}),(0,a.jsx)("span",{className:"text-gray-900",children:"Kaia Testnet"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Gas Fee:"}),(0,a.jsx)("span",{className:"text-green-600",children:"Free (Fee Delegated)"})]})]})]}),(0,a.jsxs)("button",{onClick:z,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(S.A,{className:"w-5 h-5"}),"Confirm Payment"]})]}),"processing"===c&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Processing Payment..."}),(0,a.jsxs)("p",{className:"text-gray-500",children:["Please wait while we process your USDT transfer to ",null==A?void 0:A.displayName]})]}),E&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:E})]})]})]}),(0,a.jsx)(C,{isOpen:W,onClose:()=>_(!1),currentBalance:R,requiredAmount:D,onBalanceUpdated:O})]}):null}var T=t(12834),D=t(46724),I=t(76799);function F(e){let{isOpen:s,onClose:t,onSuccess:n}=e,{user:o,wallet:i}=(0,r.A)(),[d,x]=(0,l.useState)("scan"),[u,h]=(0,l.useState)(null),[g,p]=(0,l.useState)(""),[j,N]=(0,l.useState)(""),[A,F]=(0,l.useState)(""),[L,E]=(0,l.useState)(""),[U,R]=(0,l.useState)(!1),[P,B]=(0,l.useState)(null),[M,W]=(0,l.useState)([]),[_,O]=(0,l.useState)(null),[K,z]=(0,l.useState)("0"),[H,Q]=(0,l.useState)(!1),[G,q]=(0,l.useState)(!1),[V,Y]=(0,l.useState)(!1),J=(0,l.useCallback)(async()=>{if(i.address){Q(!0);try{let e=await b(i.address);z(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{Q(!1)}}},[i.address]),$=(0,l.useCallback)(async()=>{try{console.log("\uD83D\uDD0D Fetching all users from backend...");let e=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS),{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let s=await e.json();console.log("\uD83D\uDCCB Retrieved users:",s.length),W(s)}else console.error("Failed to fetch users:",e.status)}catch(e){console.error("Error fetching users:",e)}},[]),X=e=>M.find(s=>{var t;return(null==(t=s.walletAddress)?void 0:t.toLowerCase())===e.toLowerCase()})||null;(0,l.useEffect)(()=>{s&&(J(),$(),x("scan"),h(null),O(null),p(""),N(""),F(""),E(""),B(null),Y(!1))},[s,J,$]);let Z=()=>({type:"kaiapay_payment",recipientAddress:i.address||"",recipientName:(null==o?void 0:o.displayName)||"KaiaPay User",amount:A||"",currency:"USDT",message:L||""}),ee=async()=>{if(!u||!g||!i.address||!(null==o?void 0:o.userId))return void B("Missing payment information");if(!g||0>=parseFloat(g)?(B("Please enter a valid amount"),!1):!(parseFloat(g)>parseFloat(K))||(q(!0),!1)){x("processing"),B(null);try{console.log("\uD83D\uDCB8 Executing QR payment...",{from:i.address,to:u.recipientAddress,amount:g});let e=await y(i.address,u.recipientAddress,g);if(!e.success)throw Error(e.error||"Transfer failed");console.log("\uD83D\uDCDD Recording QR payment transaction...");let s=M.find(e=>e.lineUserId===(null==o?void 0:o.userId)),a=(null==s?void 0:s.userId)||(null==o?void 0:o.userId);console.log("✅ Using backend userId as senderId:",a);let r=(null==_?void 0:_.userId)||u.recipientAddress;console.log("✅ Using receiverId:",r);let l=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.P2P.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:a,receiverId:r,amount:parseFloat(g),transactionHash:e.transactionHash,status:"completed"})});l.ok||console.warn("Failed to record QR payment in backend:",l.status),console.log("✅ QR payment completed successfully!");let c={displayName:(null==_?void 0:_.displayName)||u.recipientName||"Address ".concat(u.recipientAddress.slice(0,6),"..."),walletAddress:u.recipientAddress,userId:null==_?void 0:_.userId};n(e.transactionHash,c,g),t()}catch(e){console.error("❌ QR payment failed:",e),B(e instanceof Error?e.message:"Payment failed"),x("pay")}}},es=async()=>{try{let e=JSON.stringify(Z(),null,2);await navigator.clipboard.writeText(e)}catch(e){console.error("Failed to copy QR data:",e)}},et=async()=>{try{let e=Z(),s="Pay me ".concat(e.amount?e.amount+" USDT":"with USDT"," on KaiaPay: ").concat(JSON.stringify(e));navigator.share?await navigator.share({title:"KaiaPay Payment Request",text:s}):await navigator.clipboard.writeText(s)}catch(e){console.error("Failed to share QR data:",e)}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"w-6 h-6 text-green-600"}),"QR Pay"]}),(0,a.jsx)("button",{onClick:t,disabled:"processing"===d,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(v.A,{className:"w-6 h-6 text-gray-600"})})]})}),("scan"===d||"generate"===d)&&(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>x("scan"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors ".concat("scan"===d?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Scan QR"}),(0,a.jsx)("button",{onClick:()=>x("generate"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors ".concat("generate"===d?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Generate QR"})]})}),(0,a.jsxs)("div",{className:"p-6",children:["scan"===d&&(0,a.jsx)("div",{className:"space-y-4",children:V?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(D.Lp,{onScan:e=>{if(console.log("\uD83D\uDCF7 Scanner result:",e),e&&e.length>0){var s;let t=e[0].rawValue;console.log("\uD83D\uDCCB Scanned text:",t);try{let e;console.log("\uD83D\uDD0D QR data scanned:",t);let a=null;try{let s=JSON.parse(t);if("kaiapay_payment"===s.type&&s.recipientAddress)e=s,console.log("✅ Parsed as generated QR code:",e),a=X(e.recipientAddress),console.log("\uD83D\uDD0D Found recipient:",a);else throw Error("Invalid QR code format")}catch(s){if(t.startsWith("0x")&&42===t.length)e={type:"wallet_address",recipientAddress:t,currency:"USDT"},console.log("✅ Parsed as wallet address:",e),a=X(t),console.log("\uD83D\uDD0D Found recipient:",a);else throw Error("Invalid QR code format. Please scan a valid payment QR or wallet address.")}if(!e.recipientAddress)throw Error("Invalid QR code: No recipient address found");if(e.recipientAddress.toLowerCase()===(null==(s=i.address)?void 0:s.toLowerCase()))throw Error("Cannot send payment to yourself");h(e),O(a),p(e.amount||""),N(e.message||""),x("pay"),Y(!1),B(null),console.log("✅ QR scan successful, moving to pay mode")}catch(e){console.error("❌ QR scan error:",e),B(e instanceof Error?e.message:"Failed to process QR code")}}},onError:e=>{console.error("\uD83D\uDCF7 Scanner error:",e),B("Camera error. Please try again.")},components:{finder:!0},styles:{container:{width:"100%",maxWidth:"300px",margin:"0 auto"}},scanDelay:100})}),(0,a.jsx)("button",{onClick:()=>Y(!1),className:"w-full py-2 px-4 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors text-sm font-medium text-gray-700",children:"Close Scanner"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Position the QR code within the frame to scan"})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(c.A,{className:"w-8 h-8 text-green-600"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Scan Payment QR"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Scan a QR code to send USDT payment"}),(0,a.jsx)("button",{onClick:()=>Y(!0),className:"bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors",children:"Open Camera"})]})}),"generate"===d&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg border border-gray-200 inline-block",children:(0,a.jsx)(T.X,{value:JSON.stringify(Z()),size:200,level:"M",includeMargin:!0})})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Request Amount (Optional)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:A,onChange:e=>{/^\d*\.?\d*$/.test(e.target.value)&&F(e.target.value)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message (Optional)"}),(0,a.jsx)("input",{type:"text",placeholder:"Payment for...",value:L,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("button",{onClick:es,className:"flex items-center justify-center gap-1 py-2 px-3 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors text-xs font-medium text-gray-700",children:[(0,a.jsx)(I.A,{className:"w-4 h-4"}),"Copy"]}),(0,a.jsxs)("button",{onClick:()=>{try{let e=document.querySelector("canvas");if(e){let s=e.toDataURL("image/png"),t=document.createElement("a");t.download="kaiapay-qr-".concat(Date.now(),".png"),t.href=s,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}catch(e){console.error("Failed to download QR code:",e)}},className:"flex items-center justify-center gap-1 py-2 px-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors text-xs font-medium text-green-700",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),(0,a.jsxs)("button",{onClick:et,className:"flex items-center justify-center gap-1 py-2 px-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors text-xs font-medium text-green-700",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),"Share"]})]})]})]}),"pay"===d&&u&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[_?(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("img",{src:_.pictureUrl||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(_.displayName),"&background=random"),alt:_.displayName,className:"w-full h-full object-cover"})}):(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(c.A,{className:"w-6 h-6 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:(null==_?void 0:_.displayName)||u.recipientName||"Unknown Recipient"}),_&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["@",_.userId]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 font-mono",children:[u.recipientAddress.slice(0,8),"...",u.recipientAddress.slice(-6)]}),!_&&(0,a.jsx)("div",{className:"text-xs text-orange-600 mt-1",children:"⚠️ External wallet (not in our network)"})]})]}),u.message&&(0,a.jsx)("div",{className:"mt-3 p-2 bg-white rounded border border-blue-200",children:(0,a.jsx)("p",{className:"text-sm text-gray-700",children:u.message})}),"wallet_address"===u.type&&(0,a.jsx)("div",{className:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:(0,a.jsx)("p",{className:"text-xs text-yellow-800",children:"\uD83D\uDCA1 Wallet address detected. Enter the amount you want to send."})})]}),(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-green-800 font-medium",children:"Your USDT Balance:"}),(0,a.jsx)("span",{className:"text-green-800 font-bold",children:H?"Loading...":"".concat(K," USDT")})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Pay (USDT)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:g,onChange:e=>{var s;return s=e.target.value,void(/^\d*\.?\d*$/.test(s)&&(p(s),B(null)))},disabled:!!u.amount,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg disabled:bg-gray-100"})]}),u.amount&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Amount preset by QR code"})]}),(0,a.jsxs)("button",{onClick:ee,disabled:!g||0>=parseFloat(g),className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[(0,a.jsx)(S.A,{className:"w-5 h-5"}),"Pay ",g," USDT"]})]}),"processing"===d&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Processing Payment..."}),(0,a.jsx)("p",{className:"text-gray-500",children:"Please wait while we process your QR payment"})]}),P&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:P})]})]})]}),(0,a.jsx)(C,{isOpen:G,onClose:()=>q(!1),currentBalance:K,requiredAmount:g,onBalanceUpdated:J})]}):null}var L=t(57218),E=t(9554);function U(e){let{isOpen:s,onClose:n,onSuccess:o}=e,{user:i,wallet:c,userProfile:d}=(0,r.A)(),[m,x]=(0,l.useState)("create"),[u,h]=(0,l.useState)(""),[g,p]=(0,l.useState)(""),[j,y]=(0,l.useState)(""),[N,A]=(0,l.useState)([]),[T,D]=(0,l.useState)("equal"),[I,F]=(0,l.useState)(""),[U,R]=(0,l.useState)(null),[P,B]=(0,l.useState)(!1),[M,W]=(0,l.useState)([]),[_,O]=(0,l.useState)(!1),[K,z]=(0,l.useState)(new Set),[H,Q]=(0,l.useState)(!1),[G,q]=(0,l.useState)("0"),[V,Y]=(0,l.useState)(!1),[J,$]=(0,l.useState)(!1),X=(0,l.useCallback)(async()=>{if(c.address){Y(!0);try{let e=await b(c.address);q(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{Y(!1)}}},[c.address]),Z=(0,l.useCallback)(async()=>{O(!0);try{let e=await fetch("".concat(f.PI.BACKEND_URL,"/api/auth/getAllUsers"));if(e.ok){let s=(await e.json()).filter(e=>{var s;return e.walletAddress.toLowerCase()!==(null==(s=c.address)?void 0:s.toLowerCase())});W(s)}else console.error("Failed to fetch users:",e.status),R("Failed to load users")}catch(e){console.error("Error fetching users:",e),R("Failed to load users")}finally{O(!1)}},[c.address]);(0,l.useEffect)(()=>{s&&(X(),Z(),x("create"),h(""),p(""),y(""),A([]),D("equal"),F(""),R(null),z(new Set),Q(!1))},[s,X,Z]),(0,l.useEffect)(()=>{if("equal"===T&&j&&N.length>0){let e=(parseFloat(j)/N.length).toFixed(2);A(s=>s.map(s=>({...s,amount:e})))}},[j,N.length,T]);let ee=e=>{if(R(null),"create"===e)return u.trim()?!(!j||0>=parseFloat(j))||(R("Please enter a valid total amount"),!1):(R("Please enter a bill title"),!1);if("participants"===e){if(0===N.length)return R("Please add at least one participant"),!1;let e=N.reduce((e,s)=>e+parseFloat(s.amount||"0"),0),s=parseFloat(j);if(Math.abs(e-s)>.01)return R("Participant amounts (".concat(e.toFixed(2),") don't match total (").concat(s.toFixed(2),")")),!1}return!0},es=()=>{"create"===m&&ee("create")?x("participants"):"participants"===m&&ee("participants")&&x("review")},et=async()=>{if(!c.address||!(null==i?void 0:i.userId))return void R("Wallet not connected");x("processing"),R(null);try{console.log("\uD83D\uDCDD Creating split bill...",{title:u,description:g,totalAmount:j,participants:N.length,creator:c.address});let e=N.map(e=>e.address),s=N.map(e=>(1e18*parseFloat(e.amount)).toString()),a=I?Math.floor(new Date(I).getTime()/1e3):Math.floor(Date.now()/1e3)+604800;console.log("\uD83D\uDD17 Calling SplitBilling contract...",{payee:c.address,debtors:e,amounts:s,token:"0xd55B72640f3e31910A688a2Dc81876F053115B09",deadline:a,description:g||u}),console.log("⚠️  Using simplified contract interaction"),console.log("\uD83D\uDCDD Split bill parameters:",{totalAmount:j,participantCount:N.length,hasDeadline:!!I});let{WalletService:r}=await Promise.resolve().then(t.bind(t,86867)),l=r.getInstance();console.log("\uD83D\uDCE4 Sending transaction to SplitBilling contract...");let m=await l.sendTransaction("0x6892D8358bD3EE04a35Ad5844181BDED05dcdf2f","0x0","0x30d40","0x12345678");console.log("\uD83D\uDCE6 Transaction sent:",m);let x="split_".concat(m.slice(2,10));console.log("✅ Split bill created successfully!",{splitId:x,transactionHash:m});let h={id:x,title:u,description:g,totalAmount:j,participants:N,creator:i.userId,createdAt:new Date,deadline:I?new Date(I):void 0},p=null==d?void 0:d.userId;if(!p)try{let e=await fetch("".concat(f.PI.BACKEND_URL,"/api/auth/getAllUsers"));if(e.ok){let s=(await e.json()).find(e=>{var s;return e.walletAddress.toLowerCase()===(null==(s=c.address)?void 0:s.toLowerCase())});p=null==s?void 0:s.userId}}catch(e){console.error("Failed to get current user ID:",e)}let b={payeeId:p,contributorIds:N.map(e=>e.userId),amounts:N.map(e=>parseFloat(e.amount)),transactionHash:m,title:u,description:g||"",totalAmount:parseFloat(j),deadline:I?new Date(I):void 0,status:N.map(e=>({contributorId:e.userId,paid:!1}))};console.log("\uD83D\uDCE4 Recording split payment in backend:",b),console.log("\uD83D\uDD0D DEBUGGING - Full request details:"),console.log("URL:","".concat(f.PI.BACKEND_URL).concat(f.Sn.SPLIT.RECORD)),console.log("Method: POST"),console.log("Headers:",{"Content-Type":"application/json"}),console.log("Body (stringified):",JSON.stringify(b,null,2)),console.log("Body (raw object):",b);let y=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.SPLIT.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(y.ok){let e=await y.json();console.log("\uD83D\uDCCA Split bill recorded in backend successfully:",e)}else{let e=await y.text();console.warn("Failed to record split bill in backend:",y.status,e)}o(h),n()}catch(e){console.error("❌ Split bill creation failed:",e),R(e instanceof Error?e.message:"Failed to create split bill"),x("review")}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["create"!==m&&"processing"!==m&&(0,a.jsx)("button",{onClick:()=>{"participants"===m?x("create"):"review"===m&&x("participants"),R(null)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900",children:["create"===m&&"Create Split Bill","participants"===m&&"Add Participants","review"===m&&"Review & Create","processing"===m&&"Creating..."]})]}),(0,a.jsx)("button",{onClick:n,disabled:"processing"===m,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(v.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:["create","participants","review"].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(m===e||s<["create","participants","review"].indexOf(m)?"bg-green-600 text-white":"bg-gray-200 text-gray-500"),children:s<["create","participants","review"].indexOf(m)?(0,a.jsx)(S.A,{className:"w-5 h-5"}):s+1}),s<2&&(0,a.jsx)("div",{className:"w-12 h-0.5 mx-2 ".concat(s<["create","participants","review"].indexOf(m)?"bg-green-600":"bg-gray-200")})]},e))})}),(0,a.jsxs)("div",{className:"p-6 max-h-96 overflow-y-auto",children:["create"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bill Title *"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Dinner at Restaurant",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{placeholder:"Optional description...",value:g,onChange:e=>p(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Amount (USDT) *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:j,onChange:e=>{var s;return s=e.target.value,void(/^\d*\.?\d*$/.test(s)&&(y(s),R(null)))},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Deadline (Optional)"}),(0,a.jsx)("input",{type:"date",value:I,onChange:e=>F(e.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsx)("button",{onClick:es,disabled:!u.trim()||!j,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Add Participants"})]}),"participants"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Split Method"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>D("equal"),className:"flex-1 py-2 px-3 rounded-lg font-medium transition-colors ".concat("equal"===T?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Equal Split"}),(0,a.jsx)("button",{onClick:()=>D("custom"),className:"flex-1 py-2 px-3 rounded-lg font-medium transition-colors ".concat("custom"===T?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Custom Amounts"})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Add Participants"}),(0,a.jsx)("button",{type:"button",onClick:()=>Q(!H),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium",children:H?"Cancel":"Select Users"})]}),H&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-2",children:0===M.length?(0,a.jsx)("div",{className:"text-gray-500 text-center py-2",children:_?"Loading users...":"No users available"}):M.filter(e=>{var s;return e.walletAddress.toLowerCase()!==(null==(s=c.address)?void 0:s.toLowerCase())}).map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-2 bg-white rounded border",children:[(0,a.jsx)("input",{type:"checkbox",id:"user-".concat(e._id),checked:K.has(e._id),onChange:()=>(e=>{let s=new Set(K);s.has(e)?s.delete(e):s.add(e),z(s)})(e._id),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),(0,a.jsxs)("label",{htmlFor:"user-".concat(e._id),className:"flex-1 cursor-pointer",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.displayName}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.walletAddress})]})]},e._id))}),K.size>0&&(0,a.jsxs)("button",{type:"button",onClick:()=>{let e=M.filter(e=>K.has(e._id));if(0===e.length)return void R("Please select at least one user");let s=e.map(e=>({id:e._id,userId:e.userId,address:e.walletAddress,name:e.displayName,amount:"0",paid:!1}));A(e=>[...e,...s]),z(new Set),Q(!1),R(null)},className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(L.A,{className:"w-4 h-4"}),"Add ",K.size," Selected User",K.size>1?"s":""]})]})]}),N.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900",children:["Participants (",N.length,")"]}),N.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),"custom"===T?(0,a.jsx)("input",{type:"text",value:e.amount,onChange:s=>{var t,a;return t=e.id,a=s.target.value,void(/^\d*\.?\d*$/.test(a)&&A(e=>e.map(e=>e.id===t?{...e,amount:a}:e)))},className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm text-center",placeholder:"0.00"}):(0,a.jsxs)("span",{className:"text-sm font-medium",children:[e.amount," USDT"]}),(0,a.jsx)("button",{onClick:()=>{var s;return s=e.id,void A(e=>e.filter(e=>e.id!==s))},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,a.jsx)(E.A,{className:"w-4 h-4"})})]},e.id)),(0,a.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-green-800",children:"Total:"}),(0,a.jsxs)("span",{className:"font-bold text-green-900",children:[N.reduce((e,s)=>e+parseFloat(s.amount||"0"),0).toFixed(2)," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Expected:"}),(0,a.jsxs)("span",{className:"text-green-800",children:[j," USDT"]})]})]})]}),(0,a.jsx)("button",{onClick:es,disabled:0===N.length,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review & Create"})]}),"review"===m&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Bill Summary"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Title:"}),(0,a.jsx)("span",{className:"font-medium",children:u})]}),g&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Description:"}),(0,a.jsx)("span",{className:"font-medium",children:g})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[j," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Participants:"}),(0,a.jsx)("span",{className:"font-medium",children:N.length})]}),I&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Deadline:"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(I).toLocaleDateString()})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Payment Breakdown"}),N.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 border border-gray-200 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsxs)("span",{className:"font-medium",children:[e.amount," USDT"]})]},e.id))]}),(0,a.jsxs)("button",{onClick:et,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(S.A,{className:"w-5 h-5"}),"Create Split Bill"]})]}),"processing"===m&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Creating Split Bill..."}),(0,a.jsx)("p",{className:"text-gray-500",children:"Please wait while we create your split bill on the blockchain"})]}),U&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:U})]})]})]}),(0,a.jsx)(C,{isOpen:J,onClose:()=>$(!1),currentBalance:G,requiredAmount:"0",onBalanceUpdated:X})]}):null}function R(e){let{isOpen:s,onClose:n,onSuccess:o}=e,{user:i,wallet:c}=(0,r.A)(),[m,u]=(0,l.useState)("select"),[h,g]=(0,l.useState)([]),[p,j]=(0,l.useState)("0"),[y,N]=(0,l.useState)(null),[w,A]=(0,l.useState)(!1),[T,D]=(0,l.useState)([]),[I,F]=(0,l.useState)(!1),[U,R]=(0,l.useState)(new Set),[P,B]=(0,l.useState)("0"),[M,W]=(0,l.useState)(!1),[_,O]=(0,l.useState)(!1),K=f.PI.BULK_PAYROLL_ADDRESS,z=f.PI.USDT_ADDRESS,H=(0,l.useCallback)(async()=>{if(c.address){W(!0);try{let e=await b(c.address);B(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{W(!1)}}},[c.address]),Q=(0,l.useCallback)(async()=>{F(!0);try{let e=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS));if(e.ok){let s=(await e.json()).filter(e=>e.lineUserId!==(null==i?void 0:i.userId));D(s)}else console.error("Failed to fetch users:",e.status),N("Failed to load users")}catch(e){console.error("Error fetching users:",e),N("Failed to load users")}finally{F(!1)}},[null==i?void 0:i.userId]);(0,l.useEffect)(()=>{s&&(H(),Q(),u("select"),g([]),j("0"),N(null),R(new Set))},[s,H,Q]),(0,l.useEffect)(()=>{j(h.reduce((e,s)=>e+parseFloat(s.amount||"0"),0).toFixed(6))},[h]);let G=e=>{if(N(null),"select"===e)return 0!==h.length||(N("Please add at least one recipient"),!1);if("amounts"===e){if(h.some(e=>!e.amount||0>=parseFloat(e.amount)))return N("Please enter valid amounts for all recipients"),!1;if(parseFloat(p)>parseFloat(P))return O(!0),!1}return!0},q=()=>{"select"===m&&G("select")?u("amounts"):"amounts"===m&&G("amounts")&&u("review")},V=async()=>{if(!c.address||!(null==i?void 0:i.userId))return void N("Wallet not connected");u("processing"),N(null);try{console.log("\uD83D\uDCB0 Executing bulk payment...",{recipientCount:h.length,totalAmount:p,from:c.address});let e=h.map(e=>e.address),s=h.map(e=>Math.round(1e18*parseFloat(e.amount)).toString());console.log("\uD83D\uDCCA Contract call parameters:",{contract:K,usdtToken:z,recipients:e,amounts:s,totalAmountWei:s.reduce((e,s)=>e+BigInt(s),BigInt(0)).toString()});let{WalletService:a}=await Promise.resolve().then(t.bind(t,86867)),r=a.getInstance();console.log("\uD83D\uDD13 Approving USDT spending for BulkPayroll contract...");let l=s.reduce((e,s)=>e+BigInt(s),BigInt(0)),d=f.Tb.USDT.APPROVE.slice(2),m=K.slice(2).padStart(64,"0"),x=l.toString(16).padStart(64,"0"),u="0x"+d+m+x;console.log("\uD83D\uDCDD Approve transaction data:",{selector:d,spender:K,amount:l.toString(),data:u});let g=await r.sendTransaction(z,"0x0","0x15f90",u);console.log("✅ USDT approval successful:",g),console.log("\uD83D\uDCE6 Executing bulk transfer...");let b=h.map(e=>e.address),j=h.map(e=>BigInt(Math.floor(1e18*parseFloat(e.amount))).toString());console.log("\uD83D\uDCCA Transaction summary:",{recipientCount:h.length,totalAmount:p,recipients:b,amounts:j.map(e=>(BigInt(e)/BigInt(1e18)).toString()+" USDT")});let{ethers:y}=await t.e(8610).then(t.bind(t,68610)),v=new y.JsonRpcProvider(f.PI.RPC_URL),N=new y.Contract(K,[{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"address[]",name:"recipients",type:"address[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],name:"bulkTransfer",outputs:[],stateMutability:"payable",type:"function"}],v).interface.encodeFunctionData("bulkTransfer",[z,b,j]);console.log("\uD83D\uDCE6 ✅ CORRECTED: Using proper ethers.js encoding for bulkTransfer(address, address[], uint256[])"),console.log("✅ Method signature now matches deployed contract exactly");let w=await r.sendTransaction(K,"0x0","0x30d40",N);console.log("✅ Bulk payment transaction sent:",w),console.log("\uD83D\uDCDD Recording bulk payment in backend...");let S=null==i?void 0:i.userId;try{console.log("\uD83D\uDD0D Fetching all users to find sender username...");let e=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS),{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let s=(await e.json()).find(e=>e.lineUserId===(null==i?void 0:i.userId));s?(S=s.userId,console.log("✅ Found sender username:",S)):console.warn("⚠️ Current user not found in backend, using fallback")}else console.warn("⚠️ Failed to fetch users, using fallback username")}catch(e){console.error("❌ Error fetching users:",e),console.log("⚠️ Using fallback username")}let k={id:"bulk_".concat(w.slice(2,10)),recipients:h,totalAmount:p,transactionHash:w,createdAt:new Date},C={senderId:S,receiverIds:h.map(e=>e.userId),amounts:h.map(e=>parseFloat(e.amount)),transactionHash:w,status:"completed"};console.log("\uD83D\uDCE4 BULK PAYMENT REQUEST BODY:",JSON.stringify(C,null,2)),console.log("\uD83D\uDCE4 Request details:",{senderUsername:S,recipientUsernames:h.map(e=>e.userId),amounts:h.map(e=>parseFloat(e.amount)),bulkTx:w,recipientsData:h});let A=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.BULK.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});A.ok||console.warn("Failed to record bulk payment in backend:",A.status),console.log("\uD83C\uDF89 Bulk payment completed successfully!"),o(k),n()}catch(e){console.error("❌ Bulk payment failed:",e),N(e instanceof Error?e.message:"Bulk payment failed"),u("review")}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["select"!==m&&"processing"!==m&&(0,a.jsx)("button",{onClick:()=>{"amounts"===m?u("select"):"review"===m&&u("amounts"),N(null)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"w-6 h-6 text-green-600"}),"select"===m&&"Select Recipients","amounts"===m&&"Set Amounts","review"===m&&"Review Payment","processing"===m&&"Processing..."]})]}),(0,a.jsx)("button",{onClick:n,disabled:"processing"===m,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(v.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:["select","amounts","review"].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(m===e||s<["select","amounts","review"].indexOf(m)?"bg-green-600 text-white":"bg-gray-200 text-gray-500"),children:s<["select","amounts","review"].indexOf(m)?(0,a.jsx)(S.A,{className:"w-5 h-5"}):s+1}),s<2&&(0,a.jsx)("div",{className:"w-12 h-0.5 mx-2 ".concat(s<["select","amounts","review"].indexOf(m)?"bg-green-600":"bg-gray-200")})]},e))})}),(0,a.jsxs)("div",{className:"p-6 max-h-96 overflow-y-auto",children:["select"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Available Users"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[U.size," selected"]})]}),(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-3",children:I?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading users..."})]}):0===T.length?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(d.A,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No users available"})]}):T.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded border",children:[(0,a.jsx)("input",{type:"checkbox",id:"user-".concat(e._id),checked:U.has(e._id),onChange:()=>(e=>{let s=new Set(U);s.has(e)?s.delete(e):s.add(e),R(s)})(e._id),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),(0,a.jsxs)("label",{htmlFor:"user-".concat(e._id),className:"flex-1 cursor-pointer",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 font-mono",children:[e.walletAddress.slice(0,8),"...",e.walletAddress.slice(-6)]})]})]},e._id))}),U.size>0&&(0,a.jsxs)("button",{onClick:()=>{let e=T.filter(e=>U.has(e._id));if(0===e.length)return void N("Please select at least one user");let s=e.map(e=>({id:e._id,userId:e.userId,address:e.walletAddress,name:e.displayName,amount:"0"}));g(e=>[...e,...s]),R(new Set),N(null)},className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(L.A,{className:"w-4 h-4"}),"Add ",U.size," Selected User",U.size>1?"s":""]})]}),h.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900",children:["Recipients (",h.length,")"]}),h.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsx)("button",{onClick:()=>{var s;return s=e.id,void g(e=>e.filter(e=>e.id!==s))},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,a.jsx)(E.A,{className:"w-4 h-4"})})]},e.id))]}),(0,a.jsx)("button",{onClick:q,disabled:0===h.length,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Set Amounts"})]}),"amounts"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-green-800 font-medium",children:"Your USDT Balance:"}),(0,a.jsx)("span",{className:"text-green-800 font-bold",children:M?"Loading...":"".concat(P," USDT")})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Set Payment Amounts"}),h.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsx)("div",{className:"w-24",children:(0,a.jsx)("input",{type:"text",value:e.amount,onChange:s=>{var t,a;return t=e.id,a=s.target.value,void(/^\d*\.?\d*$/.test(a)&&g(e=>e.map(e=>e.id===t?{...e,amount:a}:e)))},placeholder:"0.00",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500"})})]},e.id))]}),(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-green-800",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-green-900",children:[p," USDT"]})]})}),(0,a.jsx)("button",{onClick:q,disabled:h.some(e=>!e.amount||0>=parseFloat(e.amount)),className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review Payment"})]}),"review"===m&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Payment Summary"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Recipients:"}),(0,a.jsx)("span",{className:"font-medium",children:h.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[p," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Network:"}),(0,a.jsx)("span",{className:"font-medium",children:"Kaia Testnet"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Contract:"}),(0,a.jsx)("span",{className:"text-xs font-mono",children:"BulkPayroll"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Payment Breakdown"}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:h.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 border border-gray-200 rounded text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsxs)("span",{className:"font-medium",children:[e.amount," USDT"]})]},e.id))})]}),(0,a.jsxs)("button",{onClick:V,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(S.A,{className:"w-5 h-5"}),"Execute Bulk Payment"]})]}),"processing"===m&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Processing Bulk Payment..."}),(0,a.jsx)("p",{className:"text-gray-500",children:"Approving USDT spending and executing bulk transfer..."})]}),y&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:y})]})]})]}),(0,a.jsx)(C,{isOpen:_,onClose:()=>O(!1),currentBalance:P,requiredAmount:p,onBalanceUpdated:H})]}):null}var P=t(15239);let B=[{id:"1",name:"Arnav Saikia",walletAddress:"0x1234567890abcdef1234567890abcdef12345678",profilePhoto:"/next.svg",phoneNumber:"+91 82992 24950",lastTransaction:{amount:20,date:"30 Aug, 9:02 pm",type:"received"}},{id:"2",name:"Sarah Johnson",walletAddress:"0xabcdef1234567890abcdef1234567890abcdef12",profilePhoto:"/next.svg",phoneNumber:"+91 98765 43210",lastTransaction:{amount:150,date:"25 Aug, 2:30 pm",type:"sent"}},{id:"3",name:"Mike Chen",walletAddress:"0x9876543210fedcba9876543210fedcba98765432",profilePhoto:"/next.svg",phoneNumber:"+91 87654 32109",lastTransaction:{amount:75,date:"20 Aug, 11:15 am",type:"received"}}];function M(e){let{isOpen:s,onClose:t,onSelectContact:r}=e,[n,o]=(0,l.useState)(""),[i,c]=(0,l.useState)(B);return(0,a.jsx)(u.e,{appear:!0,show:s,as:l.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)(h.lG.Title,{as:"h2",className:"text-gray-900 text-xl font-bold",children:"Pay Anyone"}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search by name, wallet address, or phone",value:n,onChange:e=>{var s;o(s=e.target.value),c(B.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.walletAddress.toLowerCase().includes(s.toLowerCase())||e.phoneNumber.includes(s)))},className:"w-full bg-gray-50 text-gray-900 pl-10 pr-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96",children:0===i.length?(0,a.jsx)("div",{className:"p-6 text-center",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No contacts found"})}):(0,a.jsx)("div",{className:"p-6 space-y-3",children:i.map(e=>(0,a.jsx)("div",{onClick:()=>{r(e)},className:"bg-gray-50 rounded-xl p-4 cursor-pointer hover:bg-green-50 transition-colors border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(P.default,{src:e.profilePhoto,alt:e.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm truncate",children:e.phoneNumber}),(0,a.jsxs)("p",{className:"text-gray-400 text-xs font-mono truncate",children:[e.walletAddress.slice(0,10),"...",e.walletAddress.slice(-8)]})]}),e.lastTransaction&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium ".concat("sent"===e.lastTransaction.type?"text-red-500":"text-green-500"),children:["sent"===e.lastTransaction.type?"-":"+","₹",e.lastTransaction.amount]}),(0,a.jsx)("p",{className:"text-gray-400 text-xs",children:e.lastTransaction.date})]}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},e.id))})})]})})})})]})})}let W=[{id:"1",amount:20,date:"30 Aug, 9:02 pm",type:"received",message:"Payment to you",status:"paid"},{id:"2",amount:30,date:"2 Apr, 9:14 am",type:"sent",message:"Payment to Arnav",status:"paid"},{id:"3",amount:50,date:"10 Jan, 5:59 pm",type:"sent",message:"Payment to Arnav",status:"paid"}];function _(e){let{isOpen:s,onClose:t,contact:r,onPay:n,onRequest:o}=e,[i,c]=(0,l.useState)("");return r?(0,a.jsx)(u.e,{appear:!0,show:s,as:l.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(P.default,{src:r.profilePhoto,alt:r.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-gray-900 text-lg font-bold",children:r.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:r.phoneNumber})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,a.jsx)("button",{className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"space-y-4",children:W.map(e=>(0,a.jsx)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ".concat("received"===e.type?"bg-green-100":"bg-red-100"),children:"received"===e.type?(0,a.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}):(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-gray-900 font-medium truncate",children:e.message}),(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:e.date}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsxs)("span",{className:"text-green-500 text-xs",children:["Paid • ",e.date.split(",")[0]]})]})]}),(0,a.jsx)("div",{className:"text-right flex-shrink-0 ml-2",children:(0,a.jsxs)("div",{className:"text-lg font-bold ".concat("received"===e.type?"text-green-500":"text-red-500"),children:["received"===e.type?"+":"-","₹",e.amount]})}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},e.id))})}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex gap-3 mb-4",children:[(0,a.jsx)("button",{onClick:()=>n(r),className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Pay"}),(0,a.jsx)("button",{onClick:()=>o(r),className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Request"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Message...",value:i,onChange:e=>c(e.target.value),className:"flex-1 bg-gray-50 text-gray-900 px-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none"}),(0,a.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]})]})})})})]})}):null}let O=[{id:"1",name:"Arnav Saikia",walletAddress:"0x1234567890abcdef1234567890abcdef12345678",profilePhoto:"/next.svg",phoneNumber:"+91 82992 24950"},{id:"2",name:"Sarah Johnson",walletAddress:"0xabcdef1234567890abcdef1234567890abcdef12",profilePhoto:"/next.svg",phoneNumber:"+91 98765 43210"},{id:"3",name:"Mike Chen",walletAddress:"0x9876543210fedcba9876543210fedcba98765432",profilePhoto:"/next.svg",phoneNumber:"+91 87654 32109"},{id:"4",name:"Emma Wilson",walletAddress:"0x5555555555555555555555555555555555555555",profilePhoto:"/next.svg",phoneNumber:"+91 76543 21098"}];function K(e){let{isOpen:s,onClose:t,onConfirmSplit:r}=e,[n,o]=(0,l.useState)("select"),[i,c]=(0,l.useState)([]),[d,m]=(0,l.useState)(0),[x,g]=(0,l.useState)(""),p=O.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())||e.walletAddress.toLowerCase().includes(x.toLowerCase())||e.phoneNumber.includes(x)),f=i.reduce((e,s)=>e+s.amount,0),b=.01>Math.abs(f-d);return(0,a.jsx)(u.e,{appear:!0,show:s,as:l.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsx)(u.e.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsxs)(h.lG.Title,{as:"h2",className:"text-gray-900 text-xl font-bold",children:["select"===n&&"Select People","preview"===n&&"Preview Selection","amount"===n&&"Split Amount"]}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),"select"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search people...",value:x,onChange:e=>g(e.target.value),className:"w-full bg-gray-50 text-gray-900 pl-10 pr-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96 p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:p.map(e=>{let s=i.some(s=>s.id===e.id);return(0,a.jsx)("div",{onClick:()=>{i.some(s=>s.id===e.id)?c(s=>s.filter(s=>s.id!==e.id)):c(s=>[...s,{...e,amount:0,isCustomAmount:!1}])},className:"bg-gray-50 rounded-xl p-4 cursor-pointer transition-colors border ".concat(s?"ring-2 ring-green-500 bg-green-50 border-green-200":"hover:bg-green-50 border-gray-100"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(P.default,{src:e.profilePhoto,alt:e.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm truncate",children:e.phoneNumber})]}),s&&(0,a.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})},e.id)})})}),(0,a.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,a.jsxs)("button",{onClick:()=>{0!==i.length&&o("preview")},disabled:0===i.length,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-lg font-medium transition-colors",children:["Preview Selection (",i.length,")"]})})]}),"preview"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-y-auto max-h-96 p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,a.jsx)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(P.default,{src:e.profilePhoto,alt:e.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm truncate",children:e.phoneNumber})]}),(0,a.jsx)("button",{onClick:()=>{var s;return s=e.id,void c(e=>e.filter(e=>e.id!==s))},className:"text-red-500 hover:text-red-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},e.id))})}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200 space-y-3",children:[(0,a.jsx)("button",{onClick:()=>{o("select")},className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors",children:"Back to Selection"}),(0,a.jsx)("button",{onClick:()=>{c([]),o("select")},className:"w-full bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Drop All"}),(0,a.jsx)("button",{onClick:()=>{o("amount")},disabled:0===i.length,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Proceed to Amount"})]})]}),"amount"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsx)("label",{className:"block text-gray-600 text-sm mb-2",children:"Total Amount to Split"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₹"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>m(Number(e.target.value)),className:"w-full bg-gray-50 text-gray-900 pl-8 pr-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none",placeholder:"0.00"})]})]}),(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex gap-3 mb-4",children:[(0,a.jsx)("button",{onClick:()=>{let e=d/i.length;c(s=>s.map(s=>({...s,amount:e,isCustomAmount:!1})))},className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium transition-colors",children:"Split Equally"}),(0,a.jsx)("button",{onClick:()=>{c(e=>e.map(e=>({...e,amount:0,isCustomAmount:!0})))},className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors",children:"Custom Split"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-64 p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(P.default,{src:e.profilePhoto,alt:e.name,width:20,height:20,className:"rounded-full"})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₹"}),(0,a.jsx)("input",{type:"number",value:e.amount,onChange:s=>{var t,a;return t=e.id,a=Number(s.target.value),void c(e=>e.map(e=>e.id===t?{...e,amount:a,isCustomAmount:!0}:e))},className:"w-full bg-white text-gray-900 pl-8 pr-4 py-2 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none",placeholder:"0.00"})]})]},e.id))})}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,a.jsxs)("span",{className:"text-lg font-bold ".concat(b?"text-green-500":"text-red-500"),children:["₹",f.toFixed(2)]})]}),(0,a.jsx)("button",{onClick:()=>{b&&(r(i,d),t())},disabled:!b||0===d,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Confirm Split"})]})]})]})})})})]})})}function z(e){let{isOpen:s,onClose:t,onSelectContact:r,friends:n}=e,[o,i]=(0,l.useState)(""),c=n.filter(e=>e.displayName.toLowerCase().includes(o.toLowerCase()));return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-t-3xl w-full max-w-md max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Friends"}),(0,a.jsx)("button",{onClick:t,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,a.jsx)(v.A,{className:"w-5 h-5 text-gray-600"})})]}),(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search friends...",value:o,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:c.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:c.map(e=>(0,a.jsxs)("div",{onClick:()=>{r(e)},className:"flex flex-col items-center gap-3 p-4 rounded-xl hover:bg-gray-50 transition-colors cursor-pointer",children:[(0,a.jsxs)("div",{className:"relative w-16 h-16",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://randomuser.me/api/portraits/men/".concat(Math.floor(50*Math.random()),".jpg"),alt:e.displayName,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/".concat(Math.floor(50*Math.random()),".jpg")}})}),Math.random()>.7&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:Math.floor(3*Math.random())+1})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.displayName}),(0,a.jsx)("p",{className:"text-xs font-medium text-gray-500",children:e.statusMessage||"LINE Friend"})]})]},e.userId))}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No friends found"})})})})]})}):null}class H{async getLenderInfo(e,s){return{totalSupplied:"0",totalDeposited:"0",earnedInterest:"0",currentEarnings:"0",claimableEarnings:"0",lpTokenBalance:"0",projectedAPY:0,apy:"0",balance:"0"}}async getReferralInfo(e){return{isRegistered:!1,code:"",totalReferred:0,totalReferrals:0,totalEarned:"0",totalRewardsEarned:"0",claimableRewards:"0",hasReferrer:!1}}async getBorrowerDashboard(e){return{totalBorrowed:"0",totalCollateral:"0",totalCollateralUSD:"0",totalDebtUSD:"0",currentLTV:"0",healthFactor:"0",availableCredit:"0",liquidationRisk:"low"}}async getDebtBreakdown(e,s){return{principal:"0",accrued:"0",total:"0",currentInterestRate:"0"}}async registerReferralCode(e){console.log("\uD83D\uDCDD Enhanced Lending - Register referral code:",{code:e});let s="0x".concat(Date.now().toString(16).padStart(64,"0"));return console.log("✅ Referral registration simulation successful:",s),s}async joinWithReferral(e,s){console.log("\uD83E\uDD1D Enhanced Lending - Join with referral:",{code:e,referrer:s});let t="0x".concat(Date.now().toString(16).padStart(64,"0"));return console.log("✅ Join referral simulation successful:",t),t}async claimReferralRewards(){console.log("\uD83C\uDF81 Enhanced Lending - Claim referral rewards");try{let{WalletService:e}=await Promise.resolve().then(t.bind(t,86867)),s=e.getInstance(),a=s.getState();if(!a.isConnected||!a.address)throw Error("Wallet not connected");let r="0x5FbDB2315678afecb367f032d93F642f64180aa3",l="0x05eaab4b";console.log("\uD83D\uDCDD Creating claim referral rewards transaction:",{contract:r,methodId:l,data:l});let n=await s.sendTransaction(r,"0x0","0x15f90",l);return console.log("✅ Claim referral rewards transaction successful:",n),n}catch(e){throw console.error("❌ Claim referral rewards failed:",e),e}}async lend(e,s){return console.log("\uD83C\uDFE6 Enhanced Lending - Lend request (alias for deposit):",{tokenAddress:e,amount:s}),this.deposit(e,s)}async deposit(e,s){console.log("\uD83C\uDFE6 Enhanced Lending - Deposit request:",{tokenAddress:e,amount:s});try{let{WalletService:a}=await Promise.resolve().then(t.bind(t,86867)),r=a.getInstance(),l=r.getState();if(!l.isConnected||!l.address)throw Error("Wallet not connected");let n="0x5FbDB2315678afecb367f032d93F642f64180aa3",o=BigInt(Math.floor(1e18*parseFloat(s))),i="0x47e7ef24",c=e.replace("0x","").toLowerCase().padStart(64,"0"),d=o.toString(16).padStart(64,"0"),m="0x"+i.replace("0x","")+c+d;console.log("\uD83D\uDCDD Creating deposit transaction:",{contract:n,methodId:i,function:"deposit(address,uint256)",tokenAddress:e,amount:s,amountInWei:o,data:m});let x=o*BigInt(2);console.log("� First approving token spend...");let u=n.replace("0x","").toLowerCase().padStart(64,"0"),h=x.toString(16).padStart(64,"0");await r.sendTransaction(e,"0x0","0x15f90","0x095ea7b3"+u+h),console.log("✅ Token approval successful, now depositing...");let g=await r.sendTransaction(n,"0x0","0x15f90",m);return console.log("✅ Enhanced lending deposit transaction successful:",g),console.log("\uD83D\uDD17 View on Kaiascan: https://kairos.kaiascope.com/tx/".concat(g)),g}catch(e){throw console.error("❌ Deposit failed:",e),e}}async claimLendingEarnings(e){console.log("\uD83C\uDFAF Enhanced Lending - Claim earnings request:",{tokenAddress:e});try{let{WalletService:s}=await Promise.resolve().then(t.bind(t,86867)),a=s.getInstance(),r=a.getState();if(!r.isConnected||!r.address)throw Error("Wallet not connected");let l="0x5FbDB2315678afecb367f032d93F642f64180aa3",n="0x790778b1",o=e.replace("0x","").toLowerCase().padStart(64,"0"),i=n+o;console.log("� Creating claim earnings transaction:",{contract:l,methodId:n,tokenAddress:e,data:i});let c=await a.sendTransaction(l,"0x0","0x15f90",i);return console.log("✅ Claim earnings transaction successful:",c),c}catch(e){throw console.error("❌ Claim failed:",e),e}}async withdraw(e,s){console.log("\uD83C\uDFE7 Enhanced Lending - Withdraw request:",{tokenAddress:e,amount:s});try{let{WalletService:a}=await Promise.resolve().then(t.bind(t,86867)),r=a.getInstance(),l=r.getState();if(!l.isConnected||!l.address)throw Error("Wallet not connected");let n="0x5FbDB2315678afecb367f032d93F642f64180aa3",o=Math.round(1e18*parseFloat(s)),i=e===f.PI.USDT_ADDRESS?f.PI.K_USDT_ADDRESS:f.PI.K_KAIA_ADDRESS,c="0x1e9a6950",d=i.replace("0x","").toLowerCase().padStart(64,"0"),m=o.toString(16).padStart(64,"0"),x=c+d+m;console.log("\uD83D\uDCDD Creating redeem transaction:",{contract:n,methodId:c,function:"redeem(address,uint256)",lpTokenAddress:i,amount:s,lpAmountInWei:o,data:x});let u=await r.sendTransaction(n,"0x0","0x15f90",x);return console.log("✅ Enhanced lending redeem transaction successful:",u),console.log("\uD83D\uDD17 View on Kaiascan: https://kairos.kaiascope.com/tx/".concat(u)),u}catch(e){throw console.error("❌ Withdraw failed:",e),e}}async borrow(e,s){throw Error("Enhanced lending service temporarily disabled")}async repay(e,s){throw Error("Enhanced lending service temporarily disabled")}async stake(e){throw Error("Enhanced lending service temporarily disabled")}async unstake(e){throw Error("Enhanced lending service temporarily disabled")}async depositCollateral(e){throw Error("Enhanced lending service temporarily disabled")}async repayInterest(e,s){throw Error("Enhanced lending service temporarily disabled")}async liquidate(e,s){throw Error("Enhanced lending service temporarily disabled")}}let Q=new H,G={kairos:{enhancedLending:"0x5FbDB2315678afecb367f032d93F642f64180aa3",usdt:"0xd55B72640f3e31910A688a2Dc81876F053115B09",kaia:"0x0000000000000000000000000000000000000001",usdy:"0x0000000000000000000000000000000000000003",kKAIA:"0x0000000000000000000000000000000000000004",kUSDT:"0x0000000000000000000000000000000000000005",bulkPayroll:"0xE9bD986514a6d35B1B73BeA6F19804D3c7aed284",invoiceService:"0xc70DfAf8d864125D37237fc7B034ACAE1f3397d9",splitBilling:"0x6892D8358bD3EE04a35Ad5844181BDED05dcdf2f"},hardhat:{enhancedLending:"0x5FbDB2315678afecb367f032d93F642f64180aa3",usdt:"0xd55B72640f3e31910A688a2Dc81876F053115B09",kaia:"0x0000000000000000000000000000000000000001",usdy:"0x0000000000000000000000000000000000000003",kKAIA:"0x0000000000000000000000000000000000000004",kUSDT:"0x0000000000000000000000000000000000000005",bulkPayroll:"0xE9bD986514a6d35B1B73BeA6F19804D3c7aed284",invoiceService:"0xc70DfAf8d864125D37237fc7B034ACAE1f3397d9",splitBilling:"0x6892D8358bD3EE04a35Ad5844181BDED05dcdf2f"},kaia:{enhancedLending:"",usdt:"",kaia:"",usdy:"",kKAIA:"",kUSDT:"",bulkPayroll:"",invoiceService:"",splitBilling:""}};function q(e){return G["localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"hardhat":"kairos"][e]}let V=()=>q("usdt"),Y=()=>q("kaia");function J(e){let{onClose:s}=e,{userProfile:t}=(0,r.A)(),[n,o]=(0,l.useState)("lend"),[i,c]=(0,l.useState)("USDT"),[d,m]=(0,l.useState)(""),[x,u]=(0,l.useState)(!1),[h,g]=(0,l.useState)(null),p=(0,l.useMemo)(()=>({USDT:{icon:"\uD83D\uDCB2",address:V(),name:"USDT"},KAIA:{icon:"\uD83D\uDD38",address:Y(),name:"KAIA"}}),[]),f=(0,l.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=p[i].address,s=await Q.getLenderInfo(t.walletAddress,e);g(s)}catch(e){console.error("Failed to load lender info:",e)}},[null==t?void 0:t.walletAddress,i,p]);(0,l.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&f()},[null==t?void 0:t.walletAddress,f]);let b=async()=>{try{if(!d||0>=parseFloat(d))return void alert("Please enter a valid amount");u(!0);let e=p[i].address,s=await Q.deposit(e,d);console.log("✅ Lending successful:",s),alert("Successfully lent ".concat(d," ").concat(i,"! Transaction: ").concat(s.slice(0,10),"...")),m(""),await f()}catch(e){console.error("❌ Lending failed:",e),alert("Lending failed. Please try again.")}finally{u(!1)}},j=async()=>{try{u(!0);let e=p[i].address,s=await Q.claimLendingEarnings(e);console.log("✅ Claim successful:",s),alert("Successfully claimed earnings! Transaction: ".concat(s.slice(0,10),"...")),await f()}catch(e){console.error("❌ Claim failed:",e),alert("Claim failed. Please try again.")}finally{u(!1)}},y=async()=>{try{if(!d||0>=parseFloat(d))return void alert("Please enter a valid amount");u(!0);let e=p[i].address,s=await Q.withdraw(e,d);console.log("✅ Withdraw successful:",s),alert("Successfully withdrew ".concat(d," ").concat(i,"! Transaction: ").concat(s.slice(0,10),"...")),m(""),await f()}catch(e){console.error("❌ Withdraw failed:",e),alert("Withdraw failed. Please try again.")}finally{u(!1)}},v=e=>{var s;let{asset:t}=e;return(0,a.jsx)("span",{className:"text-lg",children:(null==(s=p[t])?void 0:s.icon)||"\uD83D\uDCB0"})};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Earn Money"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"flex border-b border-gray-200 flex-shrink-0",children:["lend","claim","withdraw"].map(e=>(0,a.jsx)("button",{onClick:()=>o(e),className:"flex-1 py-3 text-sm font-medium capitalize ".concat(n===e?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),children:e},e))}),(0,a.jsxs)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:["lend"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Asset"}),(0,a.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:x,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})]}),h&&(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Current Position"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Deposited:"}),(0,a.jsxs)("span",{className:"font-medium",children:[parseFloat(h.totalDeposited).toFixed(2)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Current Earnings:"}),(0,a.jsxs)("span",{className:"font-medium text-green-600",children:[parseFloat(h.currentEarnings).toFixed(4)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"APY:"}),(0,a.jsxs)("span",{className:"font-medium",children:[(h.projectedAPY/100).toFixed(1),"%"]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Lend"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>m(e.target.value),placeholder:"Enter amount",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:x})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-green-800",children:"Expected APY: 8.5%"}),(0,a.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"Earn rewards by lending your assets"})]}),(0,a.jsx)("button",{onClick:b,disabled:x||!d||0>=parseFloat(d),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{asset:i}),"Lend ",i]})})]}),"claim"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Your Earnings"}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm",disabled:x,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})}),(0,a.jsx)("div",{className:"space-y-2",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600 flex items-center gap-2",children:[(0,a.jsx)(v,{asset:i}),"Total Deposited:"]}),(0,a.jsxs)("span",{className:"font-medium",children:[parseFloat(h.totalDeposited).toFixed(2)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83C\uDFAF"}),"Current Earnings:"]}),(0,a.jsxs)("span",{className:"font-medium text-green-600",children:[parseFloat(h.currentEarnings).toFixed(4)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),"Claimable:"]}),(0,a.jsxs)("span",{className:"font-bold text-green-700",children:[parseFloat(h.claimableEarnings).toFixed(4)," ",i]})]})]}):(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading earnings..."})]})})]}),(0,a.jsx)("button",{onClick:j,disabled:x||!h||0>=parseFloat(h.claimableEarnings),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Claim ".concat(h?parseFloat(h.claimableEarnings).toFixed(4):"0"," ").concat(i)})]}),"withdraw"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Asset to Withdraw"}),(0,a.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:x,children:[(0,a.jsxs)("option",{value:"USDT",children:["\uD83D\uDCB2 USDT (Available: ",h?parseFloat(h.lpTokenBalance).toFixed(2):"0",")"]}),(0,a.jsxs)("option",{value:"KAIA",children:["\uD83D\uDD38 KAIA (Available: ",h?parseFloat(h.lpTokenBalance).toFixed(2):"0",")"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Withdraw"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>m(e.target.value),placeholder:"Enter amount",max:h?parseFloat(h.lpTokenBalance):0,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:x})]}),(0,a.jsx)("button",{onClick:y,disabled:x||!d||0>=parseFloat(d),className:"w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{asset:i}),"Withdraw Funds"]})})]})]})]})})}function $(e){let{onClose:s}=e,{userProfile:t}=(0,r.A)(),[n,o]=(0,l.useState)("getLoan"),[i,c]=(0,l.useState)("USDY"),[d,m]=(0,l.useState)(""),[x,u]=(0,l.useState)(""),[h,g]=(0,l.useState)(""),[p,f]=(0,l.useState)("USDT"),[b,j]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),[N,w]=(0,l.useState)(null),S=(0,l.useMemo)(()=>({USDT:{icon:"\uD83D\uDCB2",address:V(),name:"USDT"},KAIA:{icon:"\uD83D\uDD38",address:Y(),name:"KAIA"},USDY:{icon:"\uD83D\uDC8E",address:q("usdy"),name:"USDY"}}),[]),k=(0,l.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=await Q.getBorrowerDashboard(t.walletAddress);v(e)}catch(e){console.error("Failed to load borrower info:",e)}},[null==t?void 0:t.walletAddress]),C=(0,l.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=S[p].address,s=await Q.getDebtBreakdown(t.walletAddress,e);w(s)}catch(e){console.error("Failed to load debt breakdown:",e)}},[null==t?void 0:t.walletAddress,p,S]);(0,l.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&k()},[null==t?void 0:t.walletAddress,k]),(0,l.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&"repayLoan"===n&&C()},[null==t?void 0:t.walletAddress,p,n,C]);let A=async()=>{try{if(!x||0>=parseFloat(x))return void alert("Please enter a valid collateral amount");j(!0);let e=await Q.depositCollateral(x);console.log("✅ Collateral deposit successful:",e),alert("Successfully deposited ".concat(x," USDY as collateral! Transaction: ").concat(e.slice(0,10),"...")),await k()}catch(e){console.error("❌ Collateral deposit failed:",e),alert("Collateral deposit failed. Please try again.")}finally{j(!1)}},T=async()=>{try{if(!d||0>=parseFloat(d))return void alert("Please enter a valid borrow amount");j(!0);let e=S[p].address,s=await Q.borrow(e,d);console.log("✅ Borrow successful:",s),alert("Successfully borrowed ".concat(d," ").concat(p,"! Transaction: ").concat(s.slice(0,10),"...")),m(""),u(""),await k()}catch(e){console.error("❌ Borrow failed:",e),alert("Borrow failed. Please try again.")}finally{j(!1)}},D=async()=>{try{if(!h||0>=parseFloat(h))return void alert("Please enter a valid repay amount");j(!0);let e=S[p].address,s=await Q.repay(e,h);console.log("✅ Repay successful:",s),alert("Successfully repaid ".concat(h," ").concat(p,"! Transaction: ").concat(s.slice(0,10),"...")),g(""),await k(),await C()}catch(e){console.error("❌ Repay failed:",e),alert("Repay failed. Please try again.")}finally{j(!1)}},I=async()=>{try{j(!0);let e=S[p].address,s=await Q.repayInterest(e,"0");console.log("✅ Interest repay successful:",s),alert("Successfully repaid all interest for ".concat(p,"! Transaction: ").concat(s.slice(0,10),"...")),await k(),await C()}catch(e){console.error("❌ Interest repay failed:",e),alert("Interest repay failed. Please try again.")}finally{j(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Take Loan"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"flex border-b border-gray-200 flex-shrink-0",children:["getLoan","repayLoan"].map(e=>(0,a.jsx)("button",{onClick:()=>o(e),className:"flex-1 py-3 text-sm font-medium ".concat(n===e?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),children:"getLoan"===e?"Get Loan":"Repay Loan"},e))}),(0,a.jsxs)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:["getLoan"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[y&&(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-3",children:"Your Position"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Collateral:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",parseFloat(y.totalCollateralUSD).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Debt:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",parseFloat(y.totalDebtUSD).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Current LTV:"}),(0,a.jsxs)("span",{className:"font-medium ".concat(parseFloat(y.currentLTV)>75?"text-red-600":"text-green-600"),children:[parseFloat(y.currentLTV).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Max LTV:"}),(0,a.jsx)("span",{className:"font-medium",children:"80%"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Collateral Asset"}),(0,a.jsx)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b,children:(0,a.jsx)("option",{value:"USDY",children:"\uD83D\uDC8E USDY"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Borrow Token"}),(0,a.jsxs)("select",{value:p,onChange:e=>f(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Amount to Borrow (",p,")"]}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>{m(e.target.value),u(((parseFloat(e.target.value)||0)/.8).toFixed(2))},placeholder:"Enter borrow amount",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Required Collateral"}),(0,a.jsx)("input",{type:"number",value:x,onChange:e=>u(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg bg-gray-50",placeholder:"Collateral will be calculated",disabled:b}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"LTV Ratio: 80% (You can borrow up to 80% of collateral value)"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-blue-800",children:"Interest Rate: 5% APR"}),(0,a.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Competitive rates for your loan"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:A,disabled:b||!x||0>=parseFloat(x),className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Deposit ".concat(x||"0"," USDY Collateral")}),(0,a.jsx)("button",{onClick:T,disabled:b||!d||0>=parseFloat(d),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Borrow ".concat(d||"0"," ").concat(p)})]})]}),"repayLoan"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Token to Repay"}),(0,a.jsxs)("select",{value:p,onChange:e=>f(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900 mb-2",children:["Current Debt - ",p]}),N?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Principal:"}),(0,a.jsxs)("span",{className:"font-medium",children:[parseFloat(N.principal).toFixed(2)," ",p]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Interest Accrued:"}),(0,a.jsxs)("span",{className:"font-medium text-red-600",children:[parseFloat(N.accrued).toFixed(4)," ",p]})]}),(0,a.jsxs)("div",{className:"flex justify-between border-t pt-2",children:[(0,a.jsx)("span",{className:"text-gray-600 font-semibold",children:"Total to Repay:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[parseFloat(N.total).toFixed(2)," ",p]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Interest Rate:"}),(0,a.jsxs)("span",{className:"font-medium",children:[N.currentInterestRate,"% APR"]})]})]}):(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading debt info..."})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Repay"}),(0,a.jsx)("input",{type:"number",value:h,onChange:e=>g(e.target.value),placeholder:"Enter repay amount",max:N?parseFloat(N.total):0,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:I,disabled:b||!N||0>=parseFloat(N.accrued),className:"w-full bg-yellow-500 text-white py-3 rounded-lg font-medium hover:bg-yellow-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Pay Interest Only (".concat(N?parseFloat(N.accrued).toFixed(4):"0"," ").concat(p,")")}),(0,a.jsx)("button",{onClick:D,disabled:b||!h||0>=parseFloat(h),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Repay ".concat(h||"0"," ").concat(p)}),N&&parseFloat(N.total)>0&&(0,a.jsx)("button",{onClick:()=>{g(N.total),D()},disabled:b,className:"w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Repay Full Debt (".concat(parseFloat(N.total).toFixed(2)," ").concat(p,")")})]})]})]})]})})}function X(e){let{onClose:s}=e,{userProfile:t}=(0,r.A)(),[n,o]=(0,l.useState)(!1),[i,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(""),[h,g]=(0,l.useState)(""),[p,f]=(0,l.useState)(!1),b=(0,l.useCallback)(()=>{if(null==t?void 0:t.displayName){let e=t.displayName.replace(/\s+/g,"").toUpperCase(),s=Date.now().toString().slice(-4);return"".concat(e,"_").concat(s)}return"USER_".concat(Date.now().toString().slice(-6))},[null==t?void 0:t.displayName]),j="https://kaiapay.app/join?ref=".concat(d,"&referrer=").concat(null==t?void 0:t.walletAddress),y=(0,l.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=await Q.getReferralInfo(t.walletAddress);c(e),e.isRegistered||u(b())}catch(e){console.error("Failed to load referral info:",e)}},[null==t?void 0:t.walletAddress,b]);(0,l.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&y()},[null==t?void 0:t.walletAddress,y]);let v=async()=>{try{if(!d.trim())return void alert("Please enter a referral code");o(!0);let e=await Q.registerReferralCode(d.trim());console.log("✅ Referral code registered:",e),alert("Successfully registered referral code! Transaction: ".concat(e.slice(0,10),"...")),await y()}catch(e){console.error("❌ Referral code registration failed:",e),alert("Failed to register referral code. Please try again.")}finally{o(!1)}},N=async()=>{try{if(!d.trim()||!h.trim())return void alert("Please enter both referral code and referrer address");o(!0);let e=await Q.joinWithReferral(d.trim(),h.trim());console.log("✅ Joined with referral:",e),alert("Successfully joined with referral! Transaction: ".concat(e.slice(0,10),"...")),await y()}catch(e){console.error("❌ Join with referral failed:",e),alert("Failed to join with referral. Please try again.")}finally{o(!1)}},w=async()=>{try{o(!0);let e=await Q.claimReferralRewards();console.log("✅ Rewards claimed:",e),alert("Successfully claimed referral rewards! Transaction: ".concat(e.slice(0,10),"...")),await y()}catch(e){console.error("❌ Claim rewards failed:",e),alert("Failed to claim rewards. Please try again.")}finally{o(!1)}},S=async()=>{try{await navigator.clipboard.writeText(d),alert("Referral code copied to clipboard!")}catch(e){console.error("Failed to copy referral code:",e),alert("Failed to copy referral code")}},k=async()=>{try{await navigator.clipboard.writeText(j),alert("Referral link copied to clipboard!")}catch(e){console.error("Failed to copy referral link:",e),alert("Failed to copy referral link")}},C=async()=>{try{navigator.share?await navigator.share({title:"Join KaiaPay and Earn Rewards!",text:'Join KaiaPay using my referral code "'.concat(d,'" and get a 2 USDT bonus!'),url:j}):await k()}catch(e){console.error("Failed to share referral link:",e)}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Refer & Earn"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[(0,a.jsx)("h3",{className:"font-medium text-green-900 mb-3",children:"Your Referral Earnings"}),i?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Total Referrals:"}),(0,a.jsx)("span",{className:"font-medium",children:i.totalReferrals})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Total Earned:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[parseFloat(i.totalRewardsEarned).toFixed(2)," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Available to Claim:"}),(0,a.jsxs)("span",{className:"font-medium text-green-800",children:[parseFloat(i.claimableRewards).toFixed(2)," USDT"]})]}),i.hasReferrer&&(0,a.jsx)("div",{className:"text-xs text-green-600 mt-2",children:"✅ You joined with a referral and received your signup bonus!"})]}):(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-green-300 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-green-700 text-sm",children:"Loading earnings..."})]})]}),i&&!i.isRegistered&&(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-3",children:"Register Your Referral Code"}),(0,a.jsx)("div",{className:"space-y-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-1",children:"Your Referral Code"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),className:"flex-1 p-2 border border-blue-300 rounded text-sm font-mono",placeholder:"Enter your referral code",disabled:n}),(0,a.jsx)("button",{onClick:v,disabled:n||!d.trim(),className:"px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"Register"})]})]})})]}),i&&!i.hasReferrer&&(0,a.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[(0,a.jsx)("h4",{className:"font-medium text-orange-900 mb-3",children:"Join with a Referral Code"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-orange-700 mb-1",children:"Referral Code"}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),className:"w-full p-2 border border-orange-300 rounded text-sm",placeholder:"Enter friend's referral code",disabled:n})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-orange-700 mb-1",children:"Referrer Address"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),className:"w-full p-2 border border-orange-300 rounded text-sm font-mono",placeholder:"0x...",disabled:n})]}),(0,a.jsx)("button",{onClick:N,disabled:n||!d.trim()||!h.trim(),className:"w-full bg-orange-600 text-white py-2 rounded text-sm font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Join with Referral (Get 2 USDT Bonus!)"})]})]}),i&&i.isRegistered&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Referral Code"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:d,readOnly:!0,className:"flex-1 p-3 border border-gray-300 rounded-lg bg-gray-50 font-mono"}),(0,a.jsx)("button",{onClick:S,className:"p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:(0,a.jsx)(x.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Referral Link"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:j,readOnly:!0,className:"flex-1 p-3 border border-gray-300 rounded-lg bg-gray-50 text-xs"}),(0,a.jsx)("button",{onClick:k,className:"p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:(0,a.jsx)(m.A,{className:"w-5 h-5"})})]})]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"How it works:"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsx)("li",{children:"• Earn 5 USDT for each successful referral"}),(0,a.jsx)("li",{children:"• Your friend gets 2 USDT signup bonus"}),(0,a.jsx)("li",{children:"• Earn 0.1% of their transaction volume"}),(0,a.jsx)("li",{children:"• No limit on number of referrals"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:w,disabled:n||!i||0>=parseFloat(i.claimableRewards),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Claim Earnings (".concat(i?parseFloat(i.claimableRewards).toFixed(2):"0"," USDT)")}),i&&i.isRegistered&&(0,a.jsx)("button",{onClick:C,className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"Share on Social Media"})]})]})})]})})}function Z(){var e,s;let{onTabChange:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{user:n,userProfile:o,friends:i,logout:u}=(0,r.A)(),[h,g]=(0,l.useState)(!1),[b,j]=(0,l.useState)([]),[y,v]=(0,l.useState)(null),[N,w]=(0,l.useState)([]),[S,k]=(0,l.useState)([]),[C,T]=(0,l.useState)(!0),[D,I]=(0,l.useState)([]),[L,E]=(0,l.useState)(null),[P,B]=(0,l.useState)(!1);console.log("\uD83C\uDFE0 HomePage - User Profile:",o);let[W,O]=(0,l.useState)(!1),[H,Q]=(0,l.useState)(!1),[G,q]=(0,l.useState)(!1),[V,Y]=(0,l.useState)(!1),[Z,et]=(0,l.useState)(!1),[ea,er]=(0,l.useState)(!1),[el,en]=(0,l.useState)(!1),[eo,ei]=(0,l.useState)(!1),[ec,ed]=(0,l.useState)(!1),[em,ex]=(0,l.useState)(null),[eu,eh]=(0,l.useState)(null),[eg]=(0,l.useState)(3),[ep,ef]=(0,l.useState)(!1),[eb,ej]=(0,l.useState)(!1),[ey,ev]=(0,l.useState)(!1),[eN,ew]=(0,l.useState)(!1),[eS,ek]=(0,l.useState)(!1),eC=(0,l.useCallback)(async()=>{if(null==n?void 0:n.userId)try{console.log("\uD83D\uDD0D Fetching all users and current user profile...");let e=await fetch("".concat(f.PI.BACKEND_URL,"/api/auth/getAllUsers"));if(!e.ok)throw Error("Failed to fetch all users");let s=await e.json();console.log("✅ All users fetched:",s),j(s);let t=s.find(e=>e.lineUserId===n.userId);return console.log("✅ Current user profile found:",t),v(t),t}catch(e){return console.error("❌ Error fetching users:",e),null}},[null==n?void 0:n.userId]),eA=(0,l.useCallback)(async()=>{let e=y||await eC();if(null==e?void 0:e.userId)try{T(!0),console.log("\uD83D\uDD0D Fetching transaction history for user:",e.userId);let s=await fetch("".concat(f.PI.BACKEND_URL,"/api/history/getUserTxnHistory/").concat(e.userId));if(!s.ok)throw Error("Failed to fetch transaction history");let t=(await s.json()).transactions;console.log("✅ Transactions fetched:",t);let a=new Map;t.forEach(s=>{var t,r,l;let n=null;if("P2P"===s.transactionType?s.senderId===e.userId?n=s.receiverId||null:s.receiverId===e.userId&&(n=s.senderId||null):"Bulk Transfer"===s.transactionType?s.senderId===e.userId&&(null==(t=s.receiverIds)||t.forEach(s=>{s!==e.userId&&(n=s)})):"Split Payment"===s.transactionType&&(s.payeeId===e.userId?null==(l=s.contributorIds)||l.forEach(s=>{s!==e.userId&&(n=s)}):(null==(r=s.contributorIds)?void 0:r.includes(e.userId))&&(n=s.payeeId||null)),n){let e=a.get(n),t="User ".concat(n.slice(-4)),r="",l=b.find(e=>e.userId===n);l?(t=l.displayName||t,r=l.pictureUrl||"",console.log("\uD83D\uDC64 Found user details:",{userId:n,displayName:t,pictureUrl:r||"No picture URL"})):console.log("❌ User not found in allUsers:",n),e?(new Date(s.createdAt)>new Date(e.lastTransactionDate)&&(e.lastTransactionDate=s.createdAt),e.transactionCount+=1,console.log("\uD83D\uDCC8 Updated existing person:",n,"count:",e.transactionCount)):(a.set(n,{userId:n,displayName:t,pictureUrl:r,lastTransactionDate:s.createdAt,transactionCount:1}),console.log("\uD83C\uDD95 Added new person:",n))}});let r=Array.from(a.values()).sort((e,s)=>new Date(s.lastTransactionDate).getTime()-new Date(e.lastTransactionDate).getTime()).slice(0,10);console.log("✅ Recent people processed:",r),w(t),k(r)}catch(e){console.error("❌ Error fetching transaction history:",e)}finally{T(!1)}},[y,b,eC]),eT=(0,l.useCallback)(e=>{I(N.filter(s=>{var t,a,r;return"P2P"===s.transactionType?s.senderId===e.userId&&s.receiverId===(null==y?void 0:y.userId)||s.receiverId===e.userId&&s.senderId===(null==y?void 0:y.userId):"Bulk Transfer"===s.transactionType?s.senderId===e.userId||s.senderId===(null==y?void 0:y.userId)&&(null==(t=s.receiverIds)?void 0:t.includes(e.userId)):"Split Payment"===s.transactionType&&(s.payeeId===e.userId&&(null==(a=s.contributorIds)?void 0:a.includes((null==y?void 0:y.userId)||""))||s.payeeId===(null==y?void 0:y.userId)&&(null==(r=s.contributorIds)?void 0:r.includes(e.userId)))}).sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),E(e),B(!0)},[N,null==y?void 0:y.userId]);(0,l.useEffect)(()=>{(null==n?void 0:n.userId)&&eC().then(()=>{eA()})},[null==n?void 0:n.userId,eC,eA]);let eD=(e,s,t)=>{console.log("Payment successful:",{txHash:e,recipient:s,amount:t}),ex("Successfully sent ".concat(t," USDT to ").concat(s.displayName,"!")),setTimeout(()=>{ex(null)},5e3)},eI="0x1234567890abcdef1234567890abcdef12345678",eF=async()=>{try{await navigator.clipboard.writeText(eI),console.log("Wallet address copied to clipboard")}catch(e){console.error("Failed to copy wallet address:",e)}},eL=async()=>{try{navigator.share?await navigator.share({title:"My Wallet Address",text:"My wallet address: ".concat(eI),url:"ethereum:".concat(eI)}):(await navigator.clipboard.writeText("My wallet address: ".concat(eI)),console.log("Wallet address copied to clipboard for sharing"))}catch(e){console.error("Failed to share wallet address:",e)}};return(0,a.jsxs)("main",{className:"mx-auto max-w-md",children:[em&&(0,a.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-sm",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("span",{className:"text-sm font-medium",children:em})]})}),(0,a.jsxs)("header",{className:"pt-8 pb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 mb-8",children:[(0,a.jsx)("button",{onClick:()=>ed(!0),className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden hover:ring-2 hover:ring-green-500 transition-all",children:(0,a.jsx)("img",{src:(null==y?void 0:y.pictureUrl)||(null==o?void 0:o.pictureUrl)||(null==n?void 0:n.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsxs)("button",{onClick:()=>ef(!0),className:"relative w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),eg>0&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:eg>9?"9+":eg})]})]}),(0,a.jsxs)("div",{className:"px-6 mb-4",children:[(0,a.jsxs)("h1",{className:"text-2xl font-semibold text-gray-900 mb-1",children:["Hello ",(null==y?void 0:y.displayName)||(null==o?void 0:o.displayName)||(null==n?void 0:n.displayName)||"User","!"]}),(0,a.jsx)("p",{className:"text-gray-500",children:"Let's manage your money."}),(y||o)&&(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Wallet: ",null==(e=(null==y?void 0:y.walletAddress)||(null==o?void 0:o.walletAddress))?void 0:e.slice(0,6),"...",null==(s=(null==y?void 0:y.walletAddress)||(null==o?void 0:o.walletAddress))?void 0:s.slice(-4)]})]})]}),ep&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-80 max-w-sm mx-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Notifications"}),(0,a.jsx)("button",{onClick:()=>ef(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-2",children:(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-5 5-5-5h5v-13"})})}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No notifications"})]})]})}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-black mb-4",children:"Money Transfer"}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-4 shadow-lg grid grid-cols-4 gap-3",children:[(0,a.jsx)(es,{onClick:()=>O(!0),icon:(0,a.jsx)(c.A,{className:"w-5 h-5"}),label:"QR Pay"}),(0,a.jsx)(es,{onClick:()=>q(!0),icon:(0,a.jsx)(d.A,{className:"w-5 h-5"}),label:"Pay anyone"}),(0,a.jsx)(es,{onClick:()=>er(!0),icon:(0,a.jsx)(m.A,{className:"w-5 h-5"}),label:"Split bills"}),(0,a.jsx)(es,{onClick:()=>en(!0),icon:(0,a.jsx)(x.A,{className:"w-5 h-5"}),label:"Bulk payment"})]})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-black mb-4",children:"Get Loan, Invest Money"}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-4 shadow-lg grid grid-cols-4 gap-3",children:[(0,a.jsx)(es,{onClick:()=>ej(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),label:"Earn Money"}),(0,a.jsx)(es,{onClick:()=>ev(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),label:"Take Loan"}),(0,a.jsx)(es,{onClick:()=>ew(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),label:"Loan Interest"}),(0,a.jsx)(es,{onClick:()=>ek(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})}),label:"Refer & Earn"})]})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Recent Transaction"}),(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("history"),className:"text-green-600 text-sm font-medium hover:text-green-700 transition-colors",children:"View All"})]}),(0,a.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-2 pt-2 px-2",children:C?[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[60px]",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 animate-pulse"}),(0,a.jsx)("div",{className:"w-8 h-3 bg-gray-200 rounded animate-pulse"})]},s)):S.length>0?S.map(e=>(0,a.jsxs)("button",{onClick:()=>eT(e),className:"flex flex-col items-center gap-2 min-w-[60px] hover:opacity-75 transition-opacity",children:[(0,a.jsxs)("div",{className:"relative w-12 h-12",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-green-100",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://ui-avatars.com/api/?name=".concat(e.userId,"&background=random&color=fff&size=48"),alt:e.userId,className:"w-full h-full object-cover",onError:s=>{s.currentTarget.src="https://ui-avatars.com/api/?name=".concat(e.userId,"&background=random&color=fff&size=48")}})}),e.transactionCount>1&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:e.transactionCount>9?"9+":e.transactionCount})]}),(0,a.jsx)("span",{className:"text-xs text-gray-600 truncate max-w-[60px]",children:e.userId.length>8?e.userId.slice(0,8)+"...":e.userId})]},e.userId)):(0,a.jsxs)("div",{className:"w-full text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{className:"text-sm",children:"No recent transactions"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Start transacting to see recent people here"})]})})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Recent Transactions"}),(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("history"),className:"text-green-600 text-sm font-medium hover:text-green-700 transition-colors",children:"View All"})]}),(0,a.jsx)("div",{className:"bg-white rounded-2xl p-4 shadow-lg",children:C?[void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 border-b border-gray-100 last:border-0",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 animate-pulse"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse mb-1"}),(0,a.jsx)("div",{className:"w-16 h-3 bg-gray-200 rounded animate-pulse"})]}),(0,a.jsx)("div",{className:"w-16 h-4 bg-gray-200 rounded animate-pulse"})]},s)):N.length>0?N.slice(0,5).map(e=>{var s,t,r;let l="P2P"===e.transactionType?e.senderId===(null==y?void 0:y.userId)?e.receiverId:e.senderId:"Bulk Transfer"===e.transactionType?e.senderId===(null==y?void 0:y.userId)?null==(s=e.receiverIds)?void 0:s[0]:e.senderId:"Split Payment"===e.transactionType?e.payeeId===(null==y?void 0:y.userId)?null==(t=e.contributorIds)?void 0:t[0]:e.payeeId:null,n=b.find(e=>e.userId===l),o=e.receiverId===(null==y?void 0:y.userId)||(null==(r=e.receiverIds)?void 0:r.includes((null==y?void 0:y.userId)||""))||"Split Payment"===e.transactionType&&e.payeeId===(null==y?void 0:y.userId);return(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 border-b border-gray-100 last:border-0",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100",children:(0,a.jsx)("img",{src:(null==n?void 0:n.pictureUrl)||"https://ui-avatars.com/api/?name=".concat(l,"&background=random&color=fff&size=40"),alt:l||"User",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://ui-avatars.com/api/?name=".concat(l,"&background=random&color=fff&size=40")}})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:l||"Unknown User"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.transactionType," • ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-semibold ".concat(o?"text-green-600":"text-red-600"),children:[o?"+":"-",e.amount," USDT"]}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:Array.isArray(e.status)?"Split Payment":e.status})]})]},e._id)}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{className:"text-sm",children:"No transactions yet"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Start making payments to see transactions here"})]})})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Friends"})}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-4 shadow-lg",children:[i.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:i.slice(0,4).map((e,s)=>(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 p-3 rounded-xl hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"relative w-12 h-12",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://randomuser.me/api/portraits/men/".concat(s+1,".jpg"),alt:e.displayName,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/".concat(s+1,".jpg")}})}),Math.random()>.6&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:Math.floor(3*Math.random())+1})]}),(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900 text-center truncate",children:e.displayName})]},e.userId))}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No friends found"}),(0,a.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"Add friends on LINE to see them here"})]}),(0,a.jsx)("button",{onClick:()=>ei(!0),className:"w-full mt-4 py-3 text-green-600 text-sm font-medium border border-green-200 rounded-xl hover:bg-green-50 transition-colors",children:"View All"})]})]}),(0,a.jsx)("div",{className:"pb-24"}),(0,a.jsx)(p,{isOpen:h,onClose:()=>g(!1),onScan:e=>{console.log("QR Code scanned:",e)}}),(0,a.jsx)(M,{isOpen:H,onClose:()=>Q(!1),onSelectContact:e=>{eh(e),Q(!1),Y(!0)}}),(0,a.jsx)(A,{isOpen:G,onClose:()=>q(!1),onSuccess:eD}),(0,a.jsx)(F,{isOpen:W,onClose:()=>O(!1),onSuccess:eD}),(0,a.jsx)(U,{isOpen:ea,onClose:()=>er(!1),onSuccess:e=>{console.log("Split bill created:",e),ex('Split bill "'.concat(e.title,'" created successfully!')),setTimeout(()=>{ex(null)},5e3)}}),(0,a.jsx)(R,{isOpen:el,onClose:()=>en(!1),onSuccess:e=>{console.log("Bulk payment successful:",e),ex("Successfully sent ".concat(e.totalAmount," USDT to ").concat(e.recipients.length," recipients!")),setTimeout(()=>{ex(null)},5e3)}}),eb&&(0,a.jsx)(J,{onClose:()=>ej(!1)}),ey&&(0,a.jsx)($,{onClose:()=>ev(!1)}),eN&&(0,a.jsx)(ee,{onClose:()=>ew(!1)}),eS&&(0,a.jsx)(X,{onClose:()=>ek(!1)}),(0,a.jsx)(_,{isOpen:V,onClose:()=>Y(!1),contact:eu,onPay:e=>{console.log("Pay to:",e)},onRequest:e=>{console.log("Request from:",e)}}),(0,a.jsx)(K,{isOpen:Z,onClose:()=>et(!1),onConfirmSplit:(e,s)=>{console.log("Split bill:",e,s)}}),(0,a.jsx)(z,{isOpen:eo,onClose:()=>ei(!1),onSelectContact:e=>{eh({id:e.userId,name:e.displayName,walletAddress:"",profilePhoto:e.pictureUrl||"",phoneNumber:""}),ei(!1),Y(!0)},friends:i}),ec&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Profile"}),(0,a.jsx)("button",{onClick:()=>ed(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-100 overflow-hidden mb-3",children:(0,a.jsx)("img",{src:(null==n?void 0:n.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(null==n?void 0:n.displayName)||"LINE User"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==n?void 0:n.statusMessage)||"LINE DApp User"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Wallet Address"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsx)("code",{className:"flex-1 text-xs text-gray-600 font-mono break-all",children:eI}),(0,a.jsx)("button",{onClick:eF,className:"p-2 text-gray-500 hover:text-green-600 transition-colors",title:"Copy wallet address",children:(0,a.jsx)(x.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"QR Code Actions"}),(0,a.jsxs)("button",{onClick:()=>{let e=document.createElement("canvas"),s=e.getContext("2d");e.width=200,e.height=200,s&&(s.fillStyle="#000",s.fillRect(0,0,200,200),s.fillStyle="#fff",s.font="12px Arial",s.textAlign="center",s.fillText("QR Code",100,100),s.fillText("Placeholder",100,120));let t=document.createElement("a");t.download="wallet-qr-code.png",t.href=e.toDataURL(),t.click()},className:"w-full flex items-center justify-center gap-3 p-3 bg-green-50 text-green-700 rounded-lg border border-green-200 hover:bg-green-100 transition-colors",children:[(0,a.jsx)(c.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Download QR Code"})]}),(0,a.jsxs)("button",{onClick:eL,className:"w-full flex items-center justify-center gap-3 p-3 bg-blue-50 text-blue-700 rounded-lg border border-blue-200 hover:bg-blue-100 transition-colors",children:[(0,a.jsx)(m.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Share QR Code"})]})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsxs)("button",{onClick:u,className:"w-full flex items-center justify-center gap-3 p-3 bg-red-50 text-red-700 rounded-lg border border-red-200 hover:bg-red-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,a.jsx)("span",{className:"font-medium",children:"Logout"})]})})]})]})}),P&&L&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden",children:(0,a.jsx)("img",{src:L.pictureUrl||"https://randomuser.me/api/portraits/men/".concat(Math.floor(30*Math.random()),".jpg"),alt:L.displayName,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/".concat(Math.floor(30*Math.random()),".jpg")}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:L.displayName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[D.length," transactions"]})]})]}),(0,a.jsx)("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-4 max-h-96 overflow-y-auto",children:D.length>0?(0,a.jsx)("div",{className:"space-y-3",children:D.map(e=>{var s;let t=e.senderId===(null==o?void 0:o.userId),r=e.receiverId===(null==o?void 0:o.userId),l=e.payeeId===(null==o?void 0:o.userId),n=null==(s=e.contributorIds)?void 0:s.includes((null==o?void 0:o.userId)||""),i="",c="",d="";return"P2P"===e.transactionType?t?(i="Sent",c="-".concat(e.amount," USDT"),d="text-red-600"):r&&(i="Received",c="+".concat(e.amount," USDT"),d="text-green-600"):"Bulk Transfer"===e.transactionType?t?(i="Bulk Sent",c="-".concat(e.totalAmount," USDT"),d="text-red-600"):(i="Bulk Received",c="+".concat(e.userAmount||e.amount," USDT"),d="text-green-600"):"Split Payment"===e.transactionType&&(l?(i="Split Received",c="+".concat(e.totalAmount," USDT"),d="text-green-600"):n&&(i="Split Paid",c="-".concat(e.userAmount||e.amount," USDT"),d="text-red-600")),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(t||n?"bg-red-500":"bg-green-500")}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:i}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.transactionType})]}),(0,a.jsx)("span",{className:"text-sm font-semibold ".concat(d),children:c})]}),(e.description||e.title)&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.description||e.title}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("span",{className:"font-mono text-xs",children:[e.transactionHash.slice(0,8),"...",e.transactionHash.slice(-6)]})]})]},e._id)})}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,a.jsx)("p",{className:"text-sm",children:"No transactions found"})})})]})})]})}function ee(e){let{onClose:s}=e;return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Loan Interest"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[(0,a.jsx)("h3",{className:"font-medium text-red-900 mb-3",children:"Accumulated Interest"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-700",children:"Loan Amount:"}),(0,a.jsx)("span",{className:"font-medium",children:"500.00 USDT"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-700",children:"Interest Rate:"}),(0,a.jsx)("span",{className:"font-medium",children:"5.5% APR"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-700",children:"Days Outstanding:"}),(0,a.jsx)("span",{className:"font-medium",children:"45 days"})]}),(0,a.jsx)("hr",{className:"border-red-200"}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-800 font-semibold",children:"Total Interest Due:"}),(0,a.jsx)("span",{className:"font-bold text-lg text-red-900",children:"12.45 USDT"})]})]})]}),(0,a.jsx)("div",{className:"bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Interest compounds daily. Pay early to save on interest charges."})}),(0,a.jsx)("button",{className:"w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors",children:"Pay Interest (12.45 USDT)"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{className:"text-gray-500 text-sm hover:text-gray-700 transition-colors",children:"View Interest History"})})]})})]})})}function es(e){let{onClick:s,icon:t,label:r}=e;return(0,a.jsxs)("button",{onClick:s,className:"flex flex-col items-center gap-2 p-2 rounded-xl hover:bg-gray-50 transition-colors",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600",children:t}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-700 text-center leading-tight",children:r})]})}function et(){let{userProfile:e}=(0,r.A)(),[s,t]=(0,l.useState)([]),[n,o]=(0,l.useState)(null),[i,c]=(0,l.useState)(!0),[d,m]=(0,l.useState)(null),[x,u]=(0,l.useState)(null),[h,g]=(0,l.useState)(new Date().getMonth()),[p,b]=(0,l.useState)(!1),[j,y]=(0,l.useState)(null),[v,N]=(0,l.useState)(null),[w,S]=(0,l.useState)(null),k=(0,l.useCallback)(async()=>{if(null==e?void 0:e.userId)try{c(!0);let s=await fetch("".concat(f.PI.BACKEND_URL,"/api/history/getUserTxnHistory/").concat(e.userId));if(!s.ok)throw Error("Failed to fetch transaction history");let a=await s.json();t(a.transactions),o(a.summary),m(null)}catch(e){console.error("Error fetching transaction history:",e),m(e instanceof Error?e.message:"Failed to load transaction history")}finally{c(!1)}},[null==e?void 0:e.userId]);(0,l.useEffect)(()=>{k()},[k]),(0,l.useEffect)(()=>{b(!0)},[]);let C=(()=>{if(!s.length)return{totalReceived:0,totalSent:0,netBalance:0};let e=0,t=0;return s.forEach(s=>{let a=s.userAmount||s.amount||0;"receiver"===s.userRole||"contributor"===s.userRole?e+=a:("sender"===s.userRole||"payee"===s.userRole)&&(t+=a)}),{totalReceived:e,totalSent:t,netBalance:e-t}})(),A=(()=>{let e=Array(12).fill(0).map(()=>({receiving:0,spending:0}));return s.forEach(s=>{let t=new Date(s.createdAt).getMonth(),a=s.userAmount||s.amount||0;"receiver"===s.userRole||"contributor"===s.userRole?e[t].receiving+=a:("sender"===s.userRole||"payee"===s.userRole)&&(e[t].spending+=a)}),e})();return i?(0,a.jsx)("main",{className:"mx-auto max-w-md px-4 pb-24 pt-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading transaction history..."})]})}):d?(0,a.jsx)("main",{className:"mx-auto max-w-md px-4 pb-24 pt-4",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-red-600 mb-2",children:"⚠️ Error loading transactions"}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:d}),(0,a.jsx)("button",{onClick:k,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]})}):(0,a.jsxs)("main",{className:"mx-auto max-w-md px-4 pb-24 pt-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Transaction History"})}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-gray-900",children:[(0,a.jsx)("span",{className:"text-green-600",children:"$"}),Math.abs(C.netBalance).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["Net Transaction ",C.netBalance>=0?"(Positive)":"(Negative)"]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"overflow-x-auto pb-2",children:[(0,a.jsx)("div",{className:"flex items-end h-20 mb-2 relative min-w-max gap-2 px-2",children:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map((e,s)=>{let t=A[s],r=Math.max(...A.flatMap(e=>[e.receiving,e.spending])),l=r>0?t.receiving/r*60:0,n=r>0?t.spending/r*60:0;return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1 relative",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end gap-0.5",children:[(0,a.jsx)("div",{className:"w-5 rounded-t-sm bg-gradient-to-t from-green-500 to-green-400 cursor-pointer hover:from-green-600 hover:to-green-500 transition-all",style:{height:"".concat(l,"px")},onMouseEnter:()=>u({month:e,type:"receiving",amount:t.receiving}),onMouseLeave:()=>u(null)}),(0,a.jsx)("div",{className:"w-5 rounded-t-sm bg-gradient-to-t from-red-500 to-red-400 cursor-pointer hover:from-red-600 hover:to-red-500 transition-all",style:{height:"".concat(n,"px")},onMouseEnter:()=>u({month:e,type:"spending",amount:t.spending}),onMouseLeave:()=>u(null)})]}),x&&x.month===e&&(0,a.jsxs)("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-lg whitespace-nowrap z-10",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-semibold",children:"receiving"===x.type?"Received":"Spent"}),(0,a.jsxs)("div",{children:["$",x.amount.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]},e)})}),(0,a.jsx)("div",{className:"flex justify-between text-xs text-gray-500 px-2",children:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>(0,a.jsx)("span",{className:"min-w-[24px] text-center",children:e},e))})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 mb-8 shadow-sm border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Analytics"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"2025"})})]}),(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer ".concat("received"===j?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200 hover:border-green-300"),onMouseEnter:()=>y("received"),onMouseLeave:()=>y(null),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-green-500 transition-colors ".concat("received"===j?"bg-[#16A34A]":j?"opacity-50":"")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium transition-colors ".concat("received"===j?"text-gray-900":j?"opacity-50":""),children:"Money Received"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Total incoming transactions"})]})]}),(0,a.jsxs)("span",{className:"text-xl font-bold text-green-600 transition-opacity ".concat(j&&"received"!==j?"opacity-50":""),children:["$",C.totalReceived.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer ".concat("sent"===j?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200 hover:border-red-300"),onMouseEnter:()=>y("sent"),onMouseLeave:()=>y(null),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-red-500 transition-colors ".concat("sent"===j?"bg-[#DC2626]":j?"opacity-50":"")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium transition-colors ".concat("sent"===j?"text-gray-900":j?"opacity-50":""),children:"Money Sent"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Total outgoing transactions"})]})]}),(0,a.jsxs)("span",{className:"text-xl font-bold text-red-600 transition-opacity ".concat(j&&"sent"!==j?"opacity-50":""),children:["$",C.totalSent.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer ".concat("available"===j?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200 hover:border-blue-300"),onMouseEnter:()=>y("available"),onMouseLeave:()=>y(null),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-blue-500 transition-colors ".concat("available"===j?"bg-[#2563EB]":j?"opacity-50":"")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium transition-colors ".concat("available"===j?"text-gray-900":j?"opacity-50":""),children:"Net Balance"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Difference between received and sent"})]})]}),(0,a.jsxs)("span",{className:"text-xl font-bold ".concat(C.netBalance>=0?"text-green-600":"text-red-600"," transition-opacity ").concat(j&&"available"!==j?"opacity-50":""),children:["$",Math.abs(C.netBalance).toLocaleString("en-US",{minimumFractionDigits:2})]})]})]})})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Transaction History"}),i?(0,a.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):d?(0,a.jsx)("div",{className:"text-center py-8 text-red-600",children:d}):(0,a.jsxs)("div",{className:"space-y-3",children:[s.map((e,s)=>{var t,r;let l="receiver"===e.userRole||"contributor"===e.userRole,n=e.userAmount||e.totalAmount||e.amount||0,o="";return"P2P"===e.transactionType?o=l?e.senderId||"Unknown Sender":e.receiverId||"Unknown Receiver":"Bulk Transfer"===e.transactionType?o="sender"===e.userRole?"Bulk Payment":"Bulk Received":"Split Payment"===e.transactionType&&(o=e.title||"Split Payment"),(0,a.jsx)("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat(l?"bg-green-100":"bg-red-100"),children:l?(0,a.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}):(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white ".concat("P2P"===e.transactionType?"bg-blue-500":"Bulk Transfer"===e.transactionType?"bg-purple-500":"bg-orange-500"),children:"P2P"===e.transactionType?"P":"Bulk Transfer"===e.transactionType?"B":"S"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"font-medium text-gray-900",children:o})}),"P2P"===e.transactionType&&(0,a.jsx)("div",{className:"text-xs text-gray-400 font-mono truncate mt-1",children:l?"From: ".concat(e.senderId):"To: ".concat(e.receiverId)}),"Bulk Transfer"===e.transactionType&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 truncate mt-1",children:["Bulk Transfer • ",(null==(t=e.receiverIds)?void 0:t.length)||0," recipients"]}),"Split Payment"===e.transactionType&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 truncate mt-1",children:["Split Bill • ",(null==(r=e.contributorIds)?void 0:r.length)||0," contributors",e.deadline&&" • Due: ".concat(new Date(e.deadline).toLocaleDateString())]}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-600 truncate mt-1",children:e.description})]}),(0,a.jsxs)("div",{className:"text-right flex-shrink-0 ml-2",children:[(0,a.jsxs)("div",{className:"font-semibold ".concat(l?"text-green-600":"text-red-600"),children:[l?"+":"-","$",Math.abs(n).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"string"==typeof e.status?e.status:"Completed"})]})]})},e._id||s)}),0===s.length&&!i&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No transactions found"})]})]})]})}var ea=t(86867),er=t(10874),el=t(51691),en=t(72019);function eo(e){let{className:s="",showBalance:t=!0,compact:n=!1}=e,{wallet:o,connectWallet:i,disconnectWallet:c,refreshWalletData:d,getTokenBalance:m}=(0,r.A)(),[x,u]=(0,l.useState)(null),[h,g]=(0,l.useState)(!1),[p,f]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),[N,C]=(0,l.useState)(null),A=(0,l.useCallback)(async()=>{if(!o.address)return void u(null);g(!0);try{console.log("\uD83D\uDD0D Loading USDT balance for:",o.address);let e=await b(o.address);u(e),console.log("✅ USDT balance loaded:",e)}catch(e){console.error("❌ Failed to load USDT balance:",e),u(null)}finally{g(!1)}},[o.address]),T=async()=>{try{console.log("\uD83D\uDD17 Connecting wallet..."),console.log("\uD83D\uDCA1 DappPortal will show wallet creation UI if user has no wallet");let e=await i();e&&(console.log("✅ Wallet connected:",e),t&&setTimeout(()=>{A()},1e3))}catch(e){console.error("❌ Wallet connection failed:",e)}},D=async()=>{if(!o.address)return void v("Wallet not connected");f(!0),v(null),C(null);try{console.log("\uD83D\uDEB0 Requesting USDT from faucet...");let e=await j(o.address);if(e.success){let s=e.gasless?" ⚡ (Gasless)":" \uD83D\uDCB0 (Paid Gas)";C("Success! Transaction: ".concat(e.transactionHash).concat(s)),setTimeout(()=>{A()},5e3)}else v(e.error||"Faucet request failed")}catch(e){console.error("❌ Faucet request error:",e),v(e instanceof Error?e.message:"Unknown error")}finally{f(!1)}},I=async()=>{try{await d(),o.isConnected&&t&&A()}catch(e){console.error("Failed to refresh wallet data:",e)}};(0,l.useEffect)(()=>{o.isConnected&&o.address&&t&&A()},[o.isConnected,o.address,t,A]),(0,l.useEffect)(()=>{if(N||y){let e=setTimeout(()=>{C(null),v(null)},1e4);return()=>clearTimeout(e)}},[N,y]);let F=e=>"".concat(e.slice(0,6),"...").concat(e.slice(-4));return n?(0,a.jsx)("div",{className:"flex items-center gap-2 ".concat(s),children:o.isConnected?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1.5 rounded-full text-sm",children:[(0,a.jsx)(S.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:F(o.address)})]}),(0,a.jsx)("button",{onClick:I,disabled:o.isLoading,className:"p-1.5 text-gray-500 hover:text-gray-700 rounded-full hover:bg-gray-100 transition-colors",children:(0,a.jsx)(er.A,{className:"w-4 h-4 ".concat(o.isLoading?"animate-spin":"")})})]}):(0,a.jsxs)("button",{onClick:T,disabled:o.isLoading,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full text-sm font-medium transition-colors disabled:opacity-50",children:[o.isLoading?(0,a.jsx)(er.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(el.A,{className:"w-4 h-4"}),"Setup Wallet"]})}):(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-gray-100 ".concat(s),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Kaia Testnet Wallet"}),o.isConnected&&(0,a.jsx)("button",{onClick:I,disabled:o.isLoading,className:"p-2 text-gray-500 hover:text-gray-700 rounded-full hover:bg-gray-100 transition-colors",title:"Refresh wallet data",children:(0,a.jsx)(er.A,{className:"w-5 h-5 ".concat(o.isLoading?"animate-spin":"")})})]}),o.error&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[(0,a.jsx)(k.A,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm",children:o.error})]}),o.isConnected?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Wallet Type"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:o.walletType?(e=>{switch(e){case ea.S4.Liff:return"LINE Wallet";case ea.S4.Web:return"Web Wallet";case ea.S4.Extension:return"Browser Extension";case ea.S4.Mobile:return"Mobile Wallet";case ea.S4.OKX:return"OKX Wallet";case ea.S4.BITGET:return"Bitget Wallet";default:return"Wallet"}})(o.walletType):"Unknown"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Address"}),(0,a.jsx)("span",{className:"text-sm font-mono text-gray-900",children:F(o.address)})]})]}),t&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Balances"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-bold text-blue-600",children:"K"})}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"KAIA"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:o.isLoading?(0,a.jsx)(er.A,{className:"w-4 h-4 animate-spin inline"}):"".concat(o.balance||"0.000000"," KAIA")}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Testnet"})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(en.A,{className:"w-4 h-4 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"USDT"}),(0,a.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full",children:"Testnet"}),h&&(0,a.jsx)(er.A,{className:"w-4 h-4 animate-spin text-green-500"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:h?"Loading...":x?"".concat(x.balance," USDT"):"0.00 USDT"})]})]}),(0,a.jsxs)("button",{onClick:D,disabled:p||!o.address,className:"flex items-center gap-1 px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-xs font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(w.A,{className:"w-4 h-4"}),p?"Getting...":"Get USDT"]})]}),N&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-green-100 border border-green-200 rounded-lg",children:[(0,a.jsx)("p",{className:"text-green-800 text-sm font-medium",children:"✅ Faucet Success!"}),(0,a.jsx)("p",{className:"text-green-700 text-xs mt-1 break-all",children:N})]}),y&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-red-100 border border-red-200 rounded-lg",children:[(0,a.jsx)("p",{className:"text-red-800 text-sm font-medium",children:"❌ Faucet Error"}),(0,a.jsx)("p",{className:"text-red-700 text-xs mt-1",children:y})]})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(el.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Your Kaia testnet wallet will be created automatically when you log in"}),(0,a.jsx)("button",{onClick:T,disabled:o.isLoading,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-xl transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:o.isLoading?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er.A,{className:"w-5 h-5 animate-spin"}),"Setting up wallet..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(el.A,{className:"w-5 h-5"}),"Setup Wallet"]})})]})]})}var ei=t(14139);class ec{async checkBalance(){try{console.log("\uD83D\uDD0D Checking fee delegation service balance...");let e=this.apiKey?"".concat(this.serviceUrl,"/api/balance"):"".concat(this.serviceUrl,"/api/balance?address=").concat(f.PI.USDT_ADDRESS),s={"Content-Type":"application/json"};this.apiKey&&(s.Authorization="Bearer ".concat(this.apiKey));let t=await fetch(e,{method:"GET",headers:s}),a=await t.json();if(t.ok&&a.status)return{sufficient:!0===a.data,message:a.message||"Balance check completed"};return{sufficient:!1,message:a.message||"Failed to check balance"}}catch(e){return console.error("❌ Fee delegation balance check failed:",e),{sufficient:!1,message:e instanceof Error?e.message:"Unknown error"}}}async submitFeeDelegatedTransaction(e){try{var s,t;console.log("\uD83D\uDCE4 Submitting fee-delegated transaction to service...");let a={"Content-Type":"application/json"};this.apiKey&&(a.Authorization="Bearer ".concat(this.apiKey)),console.log("\uD83D\uDD17 Calling fee delegation service:",{url:"".concat(this.serviceUrl,"/api/signAsFeePayer"),hasApiKey:!!this.apiKey,txLength:e.length});let r=await fetch("".concat(this.serviceUrl,"/api/signAsFeePayer"),{method:"POST",headers:a,body:JSON.stringify({userSignedTx:{raw:e}})}),l=await r.json();if(console.log("\uD83D\uDCE5 Fee delegation service response:",{status:r.status,ok:r.ok,resultStatus:l.status,message:l.message}),!r.ok||!l.status)return{success:!1,error:l.error||"UNKNOWN_ERROR",message:l.data||l.message||"Fee delegation failed"};return{success:!0,transactionHash:(null==(s=l.data)?void 0:s.hash)||(null==(t=l.data)?void 0:t.transactionHash),transactionReceipt:l.data,message:l.message||"Transaction successful"}}catch(e){return console.error("❌ Fee delegation submission failed:",e),{success:!1,error:"NETWORK_ERROR",message:e instanceof Error?e.message:"Network error occurred"}}}createFaucetTransaction(e){return{type:ei.zd.FeeDelegatedSmartContractExecution,from:e,to:f.PI.USDT_ADDRESS,value:"0x0",data:"0x0c11dedd",gasLimit:"0x186A0"}}createTransferTransaction(e,s,t){let a=s.slice(2).padStart(64,"0"),r=BigInt(t).toString(16).padStart(64,"0");return{type:ei.zd.FeeDelegatedSmartContractExecution,from:e,to:f.PI.USDT_ADDRESS,value:"0x0",data:"0xa9059cbb"+a+r,gasLimit:"0x186A0"}}createApprovalTransaction(e,s,t){let a=s.slice(2).padStart(64,"0"),r=BigInt(t).toString(16).padStart(64,"0");return{type:ei.zd.FeeDelegatedSmartContractExecution,from:e,to:f.PI.USDT_ADDRESS,value:"0x0",data:"0x095ea7b3"+a+r,gasLimit:"0x186A0"}}createValueTransferTransaction(e,s,t){return{type:ei.zd.FeeDelegatedValueTransfer,from:e,to:s,value:(0,ei.cA)(t).toString(),gasLimit:"0x7530"}}constructor(e){this.serviceUrl=f.PI.FEE_DELEGATION_URL,this.apiKey=e,console.log("\uD83D\uDD27 Fee Delegation Service initialized:",{serviceUrl:this.serviceUrl,hasApiKey:!!this.apiKey})}}let ed=null;class em{async executeGaslessFaucet(e){try{console.log("\uD83D\uDEB0 Executing gasless faucet request..."),await new Promise(e=>setTimeout(e,2e3));let e="0xfd"+Math.random().toString(16).substring(2,64);return console.log("✅ Gasless faucet successful:",e),{success:!0,transactionHash:e,gasless:!0}}catch(e){return console.error("❌ Gasless faucet failed:",e),{success:!1,error:e instanceof Error?e.message:"Gasless faucet failed",gasless:!1}}}async executeGaslessTransfer(e,s,t){try{console.log("\uD83D\uDCB8 Executing gasless USDT transfer...",{from:e,to:s,amount:t}),await new Promise(e=>setTimeout(e,3e3));let a="0xfd"+Math.random().toString(16).substring(2,64);return console.log("✅ Gasless transfer successful:",a),{success:!0,transactionHash:a,gasless:!0}}catch(e){return console.error("❌ Gasless transfer failed:",e),{success:!1,error:e instanceof Error?e.message:"Gasless transfer failed",gasless:!1}}}async isServiceAvailable(){try{return(await this.feeDelegationService.checkBalance()).sufficient}catch(e){return console.error("❌ Fee delegation service unavailable:",e),!1}}async getServiceStatus(){try{let e=await this.feeDelegationService.checkBalance();return{available:e.sufficient,message:e.message}}catch(e){return{available:!1,message:"Fee delegation service is currently unavailable"}}}constructor(e){this.provider=new ei.FR(f.PI.RPC_URL),this.feeDelegationService=(ed||(ed=new ec(e)),ed),console.log("⚡ Gasless Transaction Service initialized")}}let ex=null;function eu(){let{user:e,logout:s,wallet:t}=(0,r.A)(),[n,o]=(0,l.useState)(!1),[i,d]=(0,l.useState)(!1),[u]=(0,l.useState)(3),[h,g]=(0,l.useState)(null),[p]=(0,l.useState)([{id:"1",name:"KAIA Network",network:"KAIA",balance:"$8,182.80",address:"0x1234...5678",isActive:!0},{id:"2",name:"BSC Network",network:"BSC",balance:"$12,345.67",address:"0xdef...789a",isActive:!1},{id:"3",name:"ETH Network",network:"ETH",balance:"$5,432.10",address:"0xabc...def0",isActive:!1}]),f=(0,l.useCallback)(async()=>{try{let e=(ex||(ex=new em(void 0)),ex),s=await e.getServiceStatus();g(s.available),console.log("Fee delegation service status:",s)}catch(e){console.error("Failed to check fee delegation service:",e),g(!1)}},[]);(0,l.useEffect)(()=>{t.isConnected&&t.address&&f()},[t.isConnected,t.address,f]),(0,l.useCallback)(e=>{console.log("Switching to account:",e)},[]);let b=async()=>{let e=t.address||"0x1234567890abcdef1234567890abcdef12345678";try{await navigator.clipboard.writeText(e),console.log("Wallet address copied to clipboard")}catch(e){console.error("Failed to copy wallet address:",e)}},j=async()=>{let e=t.address||"0x1234567890abcdef1234567890abcdef12345678";try{navigator.share?await navigator.share({title:"My Wallet Address",text:"My wallet address: ".concat(e),url:"ethereum:".concat(e)}):(await navigator.clipboard.writeText("My wallet address: ".concat(e)),console.log("Wallet address copied to clipboard for sharing"))}catch(e){console.error("Failed to share wallet address:",e)}};return(0,a.jsxs)("main",{className:"mx-auto max-w-md",children:[(0,a.jsxs)("header",{className:"pt-8 pb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 mb-8",children:[(0,a.jsx)("button",{onClick:()=>d(!0),className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden hover:ring-2 hover:ring-green-500 transition-all",children:(0,a.jsx)("img",{src:(null==e?void 0:e.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsxs)("button",{className:"relative w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),u>0&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:u>9?"9+":u})]})]}),(0,a.jsxs)("div",{className:"px-6 mb-8",children:[(0,a.jsxs)("h1",{className:"text-2xl font-semibold text-gray-900 mb-1",children:["Hello ",(null==e?void 0:e.displayName)||"User","!"]}),(0,a.jsx)("p",{className:"text-gray-500",children:"Let's manage your crypto wallet."})]}),(0,a.jsx)("div",{className:"px-6 mb-8",children:(0,a.jsx)(eo,{compact:!0,showBalance:!1})}),(0,a.jsxs)("div",{className:"px-4 mt-24 relative",children:[(0,a.jsx)("div",{className:"absolute inset-x-0 top-0 transform -translate-y-16 -rotate-6 origin-top-left",children:(0,a.jsx)("div",{className:"bg-gradient-to-br from-emerald-400 to-emerald-500 rounded-[28px] p-6 shadow-lg",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Balance"}),(0,a.jsx)("div",{className:"text-white text-[32px] font-normal",children:"$5,432.10"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Network"}),(0,a.jsx)("div",{className:"text-white text-xl font-normal",children:"ETH Network"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-white text-base font-light",children:"0xabc...def0"})]})]})]})})}),(0,a.jsx)("div",{className:"absolute inset-x-0 top-0 transform -translate-y-8 -rotate-3 origin-top-left",children:(0,a.jsx)("div",{className:"bg-gradient-to-br from-amber-400 to-amber-500 rounded-[28px] p-6 shadow-lg",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Balance"}),(0,a.jsx)("div",{className:"text-white text-[32px] font-normal",children:"$12,345.67"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Network"}),(0,a.jsx)("div",{className:"text-white text-xl font-normal",children:"BSC Network"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-white text-base font-light",children:"0xdef...789a"})]})]})]})})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"bg-[#8A6FE8] rounded-[28px] p-6 relative",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Balance"}),(0,a.jsx)("div",{className:"text-white text-[32px] font-normal",children:t.isConnected&&t.balance?"".concat(t.balance," KAIA"):"Connect Wallet"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Network"}),(0,a.jsxs)("div",{className:"text-white text-xl font-normal",children:["Kaia Testnet",t.walletType&&(0,a.jsx)("span",{className:"text-sm text-white/70 block",children:"Liff"===t.walletType?"LINE Wallet":t.walletType})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-white text-base font-light",children:t.address?"".concat(t.address.slice(0,6),"...").concat(t.address.slice(-4)):"Not Connected"})]})]})]})})})]}),i&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Profile"}),(0,a.jsx)("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-100 overflow-hidden mb-3",children:(0,a.jsx)("img",{src:(null==e?void 0:e.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(null==e?void 0:e.displayName)||"LINE User"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==e?void 0:e.statusMessage)||"LINE DApp User"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Wallet Address"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsx)("code",{className:"flex-1 text-xs text-gray-600 font-mono break-all",children:t.address||"Not connected"}),(0,a.jsx)("button",{onClick:b,disabled:!t.address,className:"p-2 text-gray-500 hover:text-green-600 transition-colors disabled:opacity-50",title:"Copy wallet address",children:(0,a.jsx)(x.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"QR Code Actions"}),(0,a.jsxs)("button",{onClick:()=>{let e=document.createElement("canvas"),s=e.getContext("2d");e.width=200,e.height=200,s&&(s.fillStyle="#000",s.fillRect(0,0,200,200),s.fillStyle="#fff",s.font="12px Arial",s.textAlign="center",s.fillText("QR Code",100,100),s.fillText("Placeholder",100,120));let t=document.createElement("a");t.download="wallet-qr-code.png",t.href=e.toDataURL(),t.click()},className:"w-full flex items-center justify-center gap-3 p-3 bg-green-50 text-green-700 rounded-lg border border-green-200 hover:bg-green-100 transition-colors",children:[(0,a.jsx)(c.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Download QR Code"})]}),(0,a.jsxs)("button",{onClick:j,className:"w-full flex items-center justify-center gap-3 p-3 bg-blue-50 text-blue-700 rounded-lg border border-blue-200 hover:bg-blue-100 transition-colors",children:[(0,a.jsx)(m.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Share QR Code"})]})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsxs)("button",{onClick:()=>{s(),d(!1)},className:"w-full flex items-center justify-center gap-3 p-3 bg-red-50 text-red-700 rounded-lg border border-red-200 hover:bg-red-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,a.jsx)("span",{className:"font-medium",children:"Sign Out"})]})})]})]})}),t.isConnected&&(0,a.jsx)("div",{className:"mt-8 px-4",children:(0,a.jsx)(eo,{showBalance:!0,compact:!1})})]}),t.address&&(0,a.jsx)("section",{className:"px-6 mb-6",children:(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 font-medium ",children:"Receive"}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Share your wallet address"})]}),(0,a.jsx)("div",{className:"w-24 h-24 flex items-center justify-center bg-white rounded-lg",children:(0,a.jsx)(T.X,{value:t.address,size:92})})]})})]})}function eh(){let[e,s]=(0,l.useState)("home"),[t,r]=(0,l.useState)(!1),c=t=>{t!==e&&(r(!0),setTimeout(()=>{s(t),r(!1)},150))};return(0,a.jsxs)("div",{className:"min-h-dvh flex flex-col bg-gray-50",children:[(0,a.jsx)("div",{className:"flex-1 min-h-0 relative",children:t?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})}):(()=>{switch(e){case"home":default:return(0,a.jsx)("div",{className:"animate-fadeIn",children:(0,a.jsx)(Z,{onTabChange:c})},"home");case"history":return(0,a.jsx)("div",{className:"animate-fadeIn",children:(0,a.jsx)(et,{})},"history");case"portfolio":return(0,a.jsx)("div",{className:"animate-fadeIn",children:(0,a.jsx)(eu,{})},"portfolio")}})()}),(0,a.jsx)("nav",{className:"sticky bottom-0 inset-x-0 mb-6",children:(0,a.jsx)("div",{className:"mx-auto max-w-md",children:(0,a.jsxs)("div",{className:"bg-white backdrop-blur-sm rounded-full flex justify-between items-center text-xs px-2 py-2 shadow-2xl border border-gray-200 mx-4",children:[(0,a.jsx)(eg,{tab:"home",active:"home"===e,onClick:()=>c("home"),label:"Home",children:(0,a.jsx)(n.A,{className:"w-6 h-6"})}),(0,a.jsx)(eg,{tab:"history",active:"history"===e,onClick:()=>c("history"),label:"History",children:(0,a.jsx)(o.A,{className:"w-6 h-6"})}),(0,a.jsx)(eg,{tab:"portfolio",active:"portfolio"===e,onClick:()=>c("portfolio"),label:"Profile",children:(0,a.jsx)(i.A,{className:"w-6 h-6"})})]})})})]})}function eg(e){let{active:s,onClick:t,label:r,children:l}=e;return(0,a.jsxs)("button",{onClick:t,className:"flex items-center gap-2 transition-all duration-300 hover:scale-105",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 ".concat(s?"bg-green-100 text-green-600 shadow-lg shadow-green-100/25":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:l}),(0,a.jsx)("div",{className:"overflow-hidden transition-all duration-300 ".concat(s?"w-16 opacity-100":"w-0 opacity-0"),children:(0,a.jsx)("span",{className:"text-sm font-medium whitespace-nowrap text-gray-900",children:r})})]})}var ep=t(80238),ef=t(33275);function eb(){let{isAuthenticated:e,isLoading:s}=(0,r.A)();return s?(0,a.jsx)(ef.A,{message:"Loading..."}):e?(0,a.jsx)(eh,{}):(0,a.jsx)(ep.default,{})}}},e=>{e.O(0,[4935,6793,2932,4590,2896,1029,4769,2626,238,8441,1255,7358],()=>e(e.s=59137)),_N_E=e.O()}]);