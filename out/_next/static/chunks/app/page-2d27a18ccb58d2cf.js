(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{47790:()=>{},54283:()=>{},59137:(e,s,t)=>{Promise.resolve().then(t.bind(t,89222))},73776:()=>{},79368:()=>{},89222:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ew});var a=t(95155),r=t(14124),n=t(12115),l=t(13533),o=t(36834),i=t(22441),c=t(88796),d=t(36337),m=t(9252),u=t(53866),x=t(24685),h=t(17332),g=t(20039);function p(e){let{isOpen:s,onClose:t,onScan:l}=e,{isInLineApp:o}=(0,r.A)(),[i,c]=(0,n.useState)(""),[d,m]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s&&(console.log("\uD83D\uDD0D LIFFQRScanner Debug:",{isInLineApp:o,userAgent:navigator.userAgent,hasLiff:"liff"in window,currentURL:window.location.href}),console.log("\uD83D\uDD0D UserAgent checks:",{isLINEUserAgent:navigator.userAgent.includes("Line"),isLIFFUserAgent:navigator.userAgent.includes("LIFF"),fullUserAgent:navigator.userAgent}))},[s,o]);let u=async()=>{console.log("\uD83D\uDD0D Attempting QR scan, isInLineApp:",o),o||console.warn("⚠️ LINE app not detected, but attempting scan anyway for debugging"),m(!0),c("");try{console.log("\uD83D\uDE80 Attempting to call LIFFAuth.scanQRCode()..."),"liff"in window?console.log("✅ LIFF object found in window"):console.warn("⚠️ LIFF object not found in window");let e=await g.Oi.scanQRCode();console.log("\uD83D\uDCF1 QR scan completed, result:",e),e?(console.log("✅ QR scan successful:",e),l(e)):console.log("ℹ️ QR scan cancelled or no result"),t()}catch(t){var e,s;console.error("❌ LIFF QR scan error:",t),console.error("\uD83D\uDD0D Error details:",{error:t,message:t instanceof Error?t.message:"Unknown error",stack:t instanceof Error?t.stack:"No stack trace"}),"UNAUTHORIZED"===t.code?c("Camera permission denied"):"INTERNAL_ERROR"===t.code?c("QR scanning failed. Please try again."):(null==(e=t.message)?void 0:e.includes("not available"))?c("QR scanning not available in this environment"):(null==(s=t.message)?void 0:s.includes("not initialized"))?c("LIFF not properly initialized"):c("Failed to scan QR code: ".concat(t.message||"Unknown error"))}finally{m(!1)}};return(0,n.useEffect)(()=>{s&&(c(""),m(!1))},[s]),(0,a.jsx)(x.e,{appear:!0,show:s,as:n.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,a.jsx)(h.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 mb-4",children:"QR Code Scanner"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-32 h-32 mx-auto mb-6 bg-gray-100 rounded-2xl flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),!o&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-yellow-800 text-sm",children:["LINE app detection: ",o?"Detected":"Not detected"]}),(0,a.jsx)("p",{className:"text-yellow-700 text-xs mt-1",children:"Attempting scan anyway for debugging..."})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:o?"Tap the button below to open LINE's QR code scanner":"Attempting to access QR scanner (debug mode)"}),(0,a.jsx)("button",{onClick:u,disabled:d,className:"w-full ".concat(o?"bg-green-500 hover:bg-green-600":"bg-orange-500 hover:bg-orange-600"," disabled:bg-gray-300 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center space-x-2"),children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Opening Scanner..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),(0,a.jsx)("span",{children:o?"Scan QR Code":"Try QR Scan (Debug)"})]})})]}),i&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-red-800 text-sm",children:i})})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{type:"button",className:"w-full inline-flex justify-center rounded-xl border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:t,children:"Cancel"})})]})})})})]})})}var f=t(46830);class b{static handleContractError(e){var s;let t=(null==e?void 0:e.message)||(null==e||null==(s=e.toString)?void 0:s.call(e))||"Unknown error",a=(null==e?void 0:e.code)||"UNKNOWN";return(console.log("\uD83D\uDD0D Processing contract error:",{code:a,message:t,error:e}),t.includes("network")||"NETWORK_ERROR"===a)?{code:"NETWORK_ERROR",message:t,userMessage:"Network connection error. Please check your internet connection.",isRetryable:!0,suggestedAction:"Check your network connection and try again"}:t.includes("wallet")||t.includes("not connected")?{code:"WALLET_NOT_CONNECTED",message:t,userMessage:"Wallet not connected. Please connect your wallet first.",isRetryable:!0,suggestedAction:"Connect your wallet and try again"}:t.includes("insufficient")||t.includes("balance")?{code:"INSUFFICIENT_BALANCE",message:t,userMessage:"Insufficient balance to complete the transaction.",isRetryable:!1,suggestedAction:"Add more USDT to your wallet or reduce the transaction amount"}:t.includes("gas")||t.includes("limit")?{code:"GAS_ERROR",message:t,userMessage:"Transaction failed due to gas issues.",isRetryable:!0,suggestedAction:"Try again with higher gas limit"}:t.includes("revert")?t.includes("Insufficient token balance")?{code:"INSUFFICIENT_TOKEN_BALANCE",message:t,userMessage:"Insufficient USDT balance in your wallet.",isRetryable:!1,suggestedAction:"Get more USDT from the faucet or add funds to your wallet"}:t.includes("Transfer failed")?{code:"TRANSFER_FAILED",message:t,userMessage:"Token transfer failed. This may be due to insufficient allowance.",isRetryable:!0,suggestedAction:"Check token approval and try again"}:t.includes("Already claimed")?{code:"FAUCET_ALREADY_CLAIMED",message:t,userMessage:"You have already claimed from the faucet recently.",isRetryable:!1,suggestedAction:"Wait 24 hours before claiming again"}:{code:"CONTRACT_REVERT",message:t,userMessage:"Contract execution failed. Please check your transaction parameters.",isRetryable:!0,suggestedAction:"Review transaction details and try again"}:t.includes("rejected")||t.includes("denied")?{code:"USER_REJECTED",message:t,userMessage:"Transaction was cancelled by user.",isRetryable:!0,suggestedAction:"Approve the transaction to continue"}:t.includes("timeout")||t.includes("timed out")?{code:"TIMEOUT",message:t,userMessage:"Transaction timed out. It may still be processing.",isRetryable:!0,suggestedAction:"Wait a moment and check the transaction status, or try again"}:{code:"UNKNOWN_ERROR",message:t,userMessage:"An unexpected error occurred. Please try again.",isRetryable:!0,suggestedAction:"Contact support if the problem persists"}}static handleFaucetError(e){let s=this.handleContractError(e);return s.message.includes("cooldown")||s.message.includes("24")?{code:"FAUCET_COOLDOWN",message:s.message,userMessage:"Faucet cooldown active. You can claim again in 24 hours.",isRetryable:!1,suggestedAction:"Wait for the cooldown period to end"}:s}static handleBulkPaymentError(e){let s=this.handleContractError(e);return s.message.includes("array")||s.message.includes("mismatch")?{code:"BULK_ARRAY_MISMATCH",message:s.message,userMessage:"Invalid recipient or amount data. Please check your inputs.",isRetryable:!0,suggestedAction:"Verify recipient addresses and amounts are correct"}:s.message.includes("empty")||s.message.includes("no recipients")?{code:"NO_RECIPIENTS",message:s.message,userMessage:"No recipients specified for bulk payment.",isRetryable:!0,suggestedAction:"Add at least one recipient"}:s}static handleSplitBillError(e){let s=this.handleContractError(e);return s.message.includes("not participant")||s.message.includes("unauthorized")?{code:"NOT_PARTICIPANT",message:s.message,userMessage:"You are not a participant in this split bill.",isRetryable:!1,suggestedAction:"Contact the bill creator for assistance"}:s.message.includes("already paid")?{code:"ALREADY_PAID",message:s.message,userMessage:"You have already paid your share of this bill.",isRetryable:!1,suggestedAction:"No further action needed"}:s}static getRetryDelay(e){return Math.min(1e3*Math.pow(2,e),1e4)}static formatErrorForUser(e){let s=e.userMessage;return e.suggestedAction&&(s+="\n\nSuggested action: ".concat(e.suggestedAction)),e.isRetryable&&(s+="\n\nYou can try again."),s}}async function y(e){console.log("\uD83D\uDD0D Getting real USDT balance for:",e);try{let{WalletService:s}=await Promise.resolve().then(t.bind(t,86867)),a=s.getInstance(),r=await a.getTokenBalance(f.PI.USDT_ADDRESS,e),n=parseFloat(r).toFixed(2),l=Math.round(1e18*parseFloat(r)).toString();return console.log("✅ Real USDT balance:",n,"USDT"),console.log("\uD83D\uDD0D Balance details:",{formatted:r,display:n,rawWei:l,decimals:18}),{balance:n,rawBalance:l,decimals:18,symbol:"USDT",contractAddress:f.PI.USDT_ADDRESS}}catch(e){return console.error("❌ Failed to get USDT balance:",e),{balance:"0.00",rawBalance:"0",decimals:6,symbol:"USDT",contractAddress:f.PI.USDT_ADDRESS}}}async function j(e){console.log("\uD83D\uDEB0 Requesting USDT from faucet using LIFF wallet only..."),console.log("\uD83D\uDD0D Wallet address:",e),console.log("\uD83D\uDD0D Target contract:",f.PI.USDT_ADDRESS);try{console.log("\uD83D\uDD04 Skipping gasless service - using LIFF wallet directly");let{WalletService:s}=await Promise.resolve().then(t.bind(t,86867)),a=s.getInstance();console.log("\uD83D\uDD0D Checking wallet connection status...");let r=a.getState();if(console.log("\uD83D\uDCCA Wallet state:",{isConnected:r.isConnected,address:r.address,walletType:r.walletType,isLoading:r.isLoading,error:r.error}),!r.isConnected||!r.address)throw console.error("❌ LIFF wallet not connected:",r),Error("LIFF wallet not connected");r.address.toLowerCase()!==e.toLowerCase()&&console.warn("⚠️ Address mismatch:",{requested:e,connected:r.address});let n=f.Tb.USDT.FAUCET;console.log("\uD83D\uDCDD Creating faucet transaction with parameters:",{contract:f.PI.USDT_ADDRESS,methodId:n,methodName:"faucet()",from:r.address,to:f.PI.USDT_ADDRESS,value:"0x0",gasLimit:"0x15f90",data:n}),console.log("\uD83D\uDD0D Contract analysis:"),console.log("  - Contract: DummyUSDT"),console.log("  - Function: faucet() external"),console.log("  - No parameters required"),console.log("  - Cooldown: 24 hours (FAUCET_COOLDOWN)"),console.log("  - Amount: 1000 tokens (FAUCET_AMOUNT = 1000 * 10^18)"),console.log("  - Requires contract to have balance"),console.log("\uD83D\uDE80 Sending faucet transaction through LIFF wallet...");let l=await a.sendTransaction(f.PI.USDT_ADDRESS,"0x0","0x15f90",n);return console.log("✅ LIFF wallet faucet transaction sent successfully!"),console.log("\uD83D\uDCDC Transaction hash:",l),console.log("\uD83D\uDD0D View on Kaiascan:","https://kairos.kaiascope.com/tx/".concat(l)),{success:!0,transactionHash:l,amount:"1000.00",gasless:!1}}catch(e){return console.error("❌ Faucet request failed:",e),{success:!1,error:b.handleFaucetError(e).userMessage,gasless:!1}}}async function v(e,s,a){console.log("\uD83D\uDCB8 Transferring USDT using LIFF wallet only...",{from:e,to:s,amount:a});try{console.log("\uD83D\uDD04 Skipping gasless service - using LIFF wallet directly for P2P transfer");let{WalletService:e}=await Promise.resolve().then(t.bind(t,86867)),r=e.getInstance(),n=r.getState();if(console.log("\uD83D\uDD0D P2P Transfer - Wallet state:",n),!n.isConnected||!n.address)throw Error("LIFF wallet not connected");let l=Math.round(1e18*parseFloat(a));console.log("\uD83D\uDCB0 Amount conversion:",{originalAmount:a,amountInWei:l,decimals:18});let o=f.Tb.USDT.TRANSFER.slice(2),i=s.replace("0x","").toLowerCase().padStart(64,"0"),c=l.toString(16).padStart(64,"0"),d="0x"+o+i+c;console.log("\uD83D\uDCDD Creating ERC20 transfer transaction:",{contract:f.PI.USDT_ADDRESS,data:d,amountInWei:l});let m=await r.sendTransaction(f.PI.USDT_ADDRESS,"0x0","0x15f90",d);return console.log("✅ LIFF wallet transaction sent:",m),{success:!0,transactionHash:m,gasless:!1}}catch(e){return console.error("❌ USDT transfer failed:",e),{success:!1,error:b.handleContractError(e).userMessage,gasless:!1}}}var N=t(43569),w=t(41715),S=t(40707),k=t(6956),C=t(88125);function A(e){let{isOpen:s,onClose:t,currentBalance:l,requiredAmount:o,onBalanceUpdated:i}=e,{wallet:c}=(0,r.A)(),[d,m]=(0,n.useState)(!1),[u,x]=(0,n.useState)(null),[h,g]=(0,n.useState)(!1),p=async()=>{if(!c.address)return void x("Wallet not connected");m(!0),x(null);try{let e=await j(c.address);e.success?(g(!0),setTimeout(()=>{i(),t()},3e3)):x(e.error||"Failed to get USDT from faucet")}catch(e){x(e instanceof Error?e.message:"Unknown error")}finally{m(!1)}},f=(parseFloat(o)-parseFloat(l)).toFixed(2);return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(C.A,{className:"w-6 h-6 text-amber-500"}),"Insufficient Balance"]}),(0,a.jsx)("button",{onClick:t,disabled:d,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(N.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[h?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"USDT Added!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Your balance has been updated. You can now complete your transaction."}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Closing automatically..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-amber-800",children:"Current Balance:"}),(0,a.jsxs)("span",{className:"font-medium text-amber-900",children:[l," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-amber-800",children:"Required:"}),(0,a.jsxs)("span",{className:"font-medium text-amber-900",children:[o," USDT"]})]}),(0,a.jsxs)("div",{className:"border-t border-amber-200 pt-2 flex justify-between",children:[(0,a.jsx)("span",{className:"text-amber-800 font-medium",children:"Need:"}),(0,a.jsxs)("span",{className:"font-bold text-amber-900",children:[f," USDT"]})]})]})}),(0,a.jsx)("p",{className:"text-gray-600",children:"You don't have enough USDT to complete this transaction. Get free test USDT from the faucet to continue."}),(0,a.jsxs)("button",{onClick:p,disabled:d,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[(0,a.jsx)(S.A,{className:"w-5 h-5"}),d?"Getting USDT...":"Get Free USDT"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"This will add 50 USDT to your testnet balance"})]}),u&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(C.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:u})]}),!h&&!d&&(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center mb-3",children:"Alternative options:"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:t,className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors text-sm font-medium text-gray-700",children:"Cancel Transaction"}),(0,a.jsx)("button",{onClick:()=>{t()},className:"flex-1 py-2 px-4 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium text-blue-700",children:"Check Portfolio"})]})]})]})]})}):null}function T(e){let{isOpen:s,onClose:t,onSuccess:l}=e,{user:o,wallet:i}=(0,r.A)(),[c,m]=(0,n.useState)("search"),[u,x]=(0,n.useState)(""),[h,g]=(0,n.useState)([]),[p,b]=(0,n.useState)([]),[j,T]=(0,n.useState)(null),[D,I]=(0,n.useState)(""),[E,L]=(0,n.useState)(!1),[R,F]=(0,n.useState)(null),[U,P]=(0,n.useState)("0"),[B,M]=(0,n.useState)(!1),[_,W]=(0,n.useState)(!1),O=(0,n.useCallback)(async()=>{if(i.address){M(!0);try{let e=await y(i.address);P(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{M(!1)}}},[i.address]),K=(0,n.useCallback)(async e=>{L(!0);try{console.log("\uD83D\uDD0D Fetching all users from backend...");let s=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS),{method:"GET",headers:{"Content-Type":"application/json"}});if(s.ok){let t=await s.json();console.log("\uD83D\uDCCB Retrieved users:",t.length),b(t);let a=t.filter(e=>e.lineUserId!==(null==o?void 0:o.userId));if(e&&e.length>=2){let s=e.toLowerCase();a=a.filter(e=>{var t,a;return(null==(t=e.displayName)?void 0:t.toLowerCase().includes(s))||(null==(a=e.userId)?void 0:a.toLowerCase().includes(s))})}g(a),console.log("✅ Filtered results:",a.length)}else console.error("Failed to fetch users:",s.status),g([])}catch(e){console.error("Error fetching users:",e),g([])}finally{L(!1)}},[null==o?void 0:o.userId]);(0,n.useEffect)(()=>{let e=setTimeout(()=>{K(u)},500);return()=>clearTimeout(e)},[u,K]),(0,n.useEffect)(()=>{s&&(O(),m("search"),x(""),T(null),I(""),F(null),K(""))},[s,O,K]);let z=async()=>{if(!j||!D||!i.address||!(null==o?void 0:o.userId))return void F("Missing payment information");m("processing"),F(null);try{console.log("\uD83D\uDCB8 Executing USDT transfer...",{from:i.address,to:j.walletAddress,amount:D});let e=await v(i.address,j.walletAddress,D);if(!e.success)throw Error(e.error||"Transfer failed");console.log("\uD83D\uDCDD Recording P2P transaction...");let s=p.find(e=>e.lineUserId===(null==o?void 0:o.userId)),a=(null==s?void 0:s.userId)||(null==o?void 0:o.userId);console.log("✅ Using backend userId as senderId:",a);let r=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.P2P.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:a,receiverId:j.userId,amount:parseFloat(D),transactionHash:e.transactionHash,status:"completed"})});r.ok||console.warn("Failed to record transaction in backend:",r.status),console.log("✅ Payment completed successfully!"),l(e.transactionHash,j,D),t()}catch(e){console.error("❌ Payment failed:",e),F(e instanceof Error?e.message:"Payment failed"),m("confirm")}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["search"!==c&&"processing"!==c&&(0,a.jsx)("button",{onClick:()=>{"amount"===c?(m("search"),T(null)):"confirm"===c&&m("amount"),F(null)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900",children:["search"===c&&"Pay Anyone","amount"===c&&"Enter Amount","confirm"===c&&"Confirm Payment","processing"===c&&"Processing..."]})]}),(0,a.jsx)("button",{onClick:t,disabled:"processing"===c,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(N.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsxs)("div",{className:"p-6",children:["search"===c&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by username or display name...",value:u,onChange:e=>x(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:[E&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Searching..."})]}),!E&&u&&0===h.length&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(d.A,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No users found"})]}),h.map(e=>(0,a.jsx)("button",{onClick:()=>{T(e),m("amount"),F(null)},className:"w-full p-3 border border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(e.displayName),"&background=random"),alt:e.displayName,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["@",e.userId]})]})]})},e._id)),!u&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(w.A,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Search for users to send USDT"})]})]})]}),"amount"===c&&j&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("img",{src:j.pictureUrl||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(j.displayName),"&background=random"),alt:j.displayName,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:j.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["@",j.userId]})]})]})}),(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-green-800 font-medium",children:"Your USDT Balance:"}),(0,a.jsx)("span",{className:"text-green-800 font-bold",children:B?"Loading...":"".concat(U," USDT")})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Send (USDT)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(S.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:D,onChange:e=>{var s;return s=e.target.value,void(/^\d*\.?\d*$/.test(s)&&(I(s),F(null)))},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"})]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:["1","5","10","25"].map(e=>(0,a.jsxs)("button",{onClick:()=>I(e),className:"flex-1 py-2 px-3 border border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-sm font-medium",children:[e," USDT"]},e))}),(0,a.jsx)("button",{onClick:()=>{(!D||0>=parseFloat(D)?(F("Please enter a valid amount"),1):parseFloat(D)>parseFloat(U)&&(W(!0),1))||m("confirm")},disabled:!D||0>=parseFloat(D),className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Continue to Confirmation"})]}),"confirm"===c&&j&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Payment Summary"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"To:"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-medium",children:j.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["@",j.userId]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[D," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Network:"}),(0,a.jsx)("span",{className:"text-gray-900",children:"Kaia Testnet"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Gas Fee:"}),(0,a.jsx)("span",{className:"text-green-600",children:"Free (Fee Delegated)"})]})]})]}),(0,a.jsxs)("button",{onClick:z,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),"Confirm Payment"]})]}),"processing"===c&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Processing Payment..."}),(0,a.jsxs)("p",{className:"text-gray-500",children:["Please wait while we process your USDT transfer to ",null==j?void 0:j.displayName]})]}),R&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(C.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:R})]})]})]}),(0,a.jsx)(A,{isOpen:_,onClose:()=>W(!1),currentBalance:U,requiredAmount:D,onBalanceUpdated:O})]}):null}var D=t(12834),I=t(46724),E=t(76799);function L(e){let{isOpen:s,onClose:t,onSuccess:l}=e,{user:o,wallet:i}=(0,r.A)(),[d,u]=(0,n.useState)("scan"),[x,h]=(0,n.useState)(null),[g,p]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[w,T]=(0,n.useState)(""),[L,R]=(0,n.useState)(""),[F,U]=(0,n.useState)(!1),[P,B]=(0,n.useState)(null),[M,_]=(0,n.useState)([]),[W,O]=(0,n.useState)(null),[K,z]=(0,n.useState)("0"),[H,G]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)(!1),[q,V]=(0,n.useState)(!1),J=(0,n.useCallback)(async()=>{if(i.address){G(!0);try{let e=await y(i.address);z(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{G(!1)}}},[i.address]),$=(0,n.useCallback)(async()=>{try{console.log("\uD83D\uDD0D Fetching all users from backend...");let e=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS),{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let s=await e.json();console.log("\uD83D\uDCCB Retrieved users:",s.length),_(s)}else console.error("Failed to fetch users:",e.status)}catch(e){console.error("Error fetching users:",e)}},[]),X=e=>M.find(s=>{var t;return(null==(t=s.walletAddress)?void 0:t.toLowerCase())===e.toLowerCase()})||null;(0,n.useEffect)(()=>{s&&(J(),$(),u("scan"),h(null),O(null),p(""),j(""),T(""),R(""),B(null),V(!1))},[s,J,$]);let Z=()=>({type:"kaiapay_payment",recipientAddress:i.address||"",recipientName:(null==o?void 0:o.displayName)||"KaiaPay User",amount:w||"",currency:"USDT",message:L||""}),ee=async()=>{if(!x||!g||!i.address||!(null==o?void 0:o.userId))return void B("Missing payment information");if(!g||0>=parseFloat(g)?(B("Please enter a valid amount"),!1):!(parseFloat(g)>parseFloat(K))||(Y(!0),!1)){u("processing"),B(null);try{console.log("\uD83D\uDCB8 Executing QR payment...",{from:i.address,to:x.recipientAddress,amount:g});let e=await v(i.address,x.recipientAddress,g);if(!e.success)throw Error(e.error||"Transfer failed");console.log("\uD83D\uDCDD Recording QR payment transaction...");let s=M.find(e=>e.lineUserId===(null==o?void 0:o.userId)),a=(null==s?void 0:s.userId)||(null==o?void 0:o.userId);console.log("✅ Using backend userId as senderId:",a);let r=(null==W?void 0:W.userId)||x.recipientAddress;console.log("✅ Using receiverId:",r);let n=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.P2P.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:a,receiverId:r,amount:parseFloat(g),transactionHash:e.transactionHash,status:"completed"})});n.ok||console.warn("Failed to record QR payment in backend:",n.status),console.log("✅ QR payment completed successfully!");let c={displayName:(null==W?void 0:W.displayName)||x.recipientName||"Address ".concat(x.recipientAddress.slice(0,6),"..."),walletAddress:x.recipientAddress,userId:null==W?void 0:W.userId};l(e.transactionHash,c,g),t()}catch(e){console.error("❌ QR payment failed:",e),B(e instanceof Error?e.message:"Payment failed"),u("pay")}}},es=async()=>{try{let e=JSON.stringify(Z(),null,2);await navigator.clipboard.writeText(e)}catch(e){console.error("Failed to copy QR data:",e)}},et=async()=>{try{let e=Z(),s="Pay me ".concat(e.amount?e.amount+" USDT":"with USDT"," on KaiaPay: ").concat(JSON.stringify(e));navigator.share?await navigator.share({title:"KaiaPay Payment Request",text:s}):await navigator.clipboard.writeText(s)}catch(e){console.error("Failed to share QR data:",e)}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"w-6 h-6 text-green-600"}),"QR Pay"]}),(0,a.jsx)("button",{onClick:t,disabled:"processing"===d,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(N.A,{className:"w-6 h-6 text-gray-600"})})]})}),("scan"===d||"generate"===d)&&(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>u("scan"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors ".concat("scan"===d?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Scan QR"}),(0,a.jsx)("button",{onClick:()=>u("generate"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors ".concat("generate"===d?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Generate QR"})]})}),(0,a.jsxs)("div",{className:"p-6",children:["scan"===d&&(0,a.jsx)("div",{className:"space-y-4",children:q?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(I.Lp,{onScan:e=>{if(console.log("\uD83D\uDCF7 Scanner result:",e),e&&e.length>0){var s;let t=e[0].rawValue;console.log("\uD83D\uDCCB Scanned text:",t);try{let e;console.log("\uD83D\uDD0D QR data scanned:",t);let a=null;try{let s=JSON.parse(t);if("kaiapay_payment"===s.type&&s.recipientAddress)e=s,console.log("✅ Parsed as generated QR code:",e),a=X(e.recipientAddress),console.log("\uD83D\uDD0D Found recipient:",a);else throw Error("Invalid QR code format")}catch(s){if(t.startsWith("0x")&&42===t.length)e={type:"wallet_address",recipientAddress:t,currency:"USDT"},console.log("✅ Parsed as wallet address:",e),a=X(t),console.log("\uD83D\uDD0D Found recipient:",a);else throw Error("Invalid QR code format. Please scan a valid payment QR or wallet address.")}if(!e.recipientAddress)throw Error("Invalid QR code: No recipient address found");if(e.recipientAddress.toLowerCase()===(null==(s=i.address)?void 0:s.toLowerCase()))throw Error("Cannot send payment to yourself");h(e),O(a),p(e.amount||""),j(e.message||""),u("pay"),V(!1),B(null),console.log("✅ QR scan successful, moving to pay mode")}catch(e){console.error("❌ QR scan error:",e),B(e instanceof Error?e.message:"Failed to process QR code")}}},onError:e=>{console.error("\uD83D\uDCF7 Scanner error:",e),B("Camera error. Please try again.")},components:{finder:!0},styles:{container:{width:"100%",maxWidth:"300px",margin:"0 auto"}},scanDelay:100})}),(0,a.jsx)("button",{onClick:()=>V(!1),className:"w-full py-2 px-4 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors text-sm font-medium text-gray-700",children:"Close Scanner"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Position the QR code within the frame to scan"})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(c.A,{className:"w-8 h-8 text-green-600"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Scan Payment QR"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Scan a QR code to send USDT payment"}),(0,a.jsx)("button",{onClick:()=>V(!0),className:"bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors",children:"Open Camera"})]})}),"generate"===d&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg border border-gray-200 inline-block",children:(0,a.jsx)(D.X,{value:JSON.stringify(Z()),size:200,level:"M",includeMargin:!0})})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Request Amount (Optional)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(S.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:w,onChange:e=>{/^\d*\.?\d*$/.test(e.target.value)&&T(e.target.value)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message (Optional)"}),(0,a.jsx)("input",{type:"text",placeholder:"Payment for...",value:L,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("button",{onClick:es,className:"flex items-center justify-center gap-1 py-2 px-3 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors text-xs font-medium text-gray-700",children:[(0,a.jsx)(E.A,{className:"w-4 h-4"}),"Copy"]}),(0,a.jsxs)("button",{onClick:()=>{try{let e=document.querySelector("canvas");if(e){let s=e.toDataURL("image/png"),t=document.createElement("a");t.download="kaiapay-qr-".concat(Date.now(),".png"),t.href=s,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}catch(e){console.error("Failed to download QR code:",e)}},className:"flex items-center justify-center gap-1 py-2 px-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors text-xs font-medium text-green-700",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download"]}),(0,a.jsxs)("button",{onClick:et,className:"flex items-center justify-center gap-1 py-2 px-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors text-xs font-medium text-green-700",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),"Share"]})]})]})]}),"pay"===d&&x&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[W?(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("img",{src:W.pictureUrl||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(W.displayName),"&background=random"),alt:W.displayName,className:"w-full h-full object-cover"})}):(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(c.A,{className:"w-6 h-6 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:(null==W?void 0:W.displayName)||x.recipientName||"Unknown Recipient"}),W&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["@",W.userId]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 font-mono",children:[x.recipientAddress.slice(0,8),"...",x.recipientAddress.slice(-6)]}),!W&&(0,a.jsx)("div",{className:"text-xs text-orange-600 mt-1",children:"⚠️ External wallet (not in our network)"})]})]}),x.message&&(0,a.jsx)("div",{className:"mt-3 p-2 bg-white rounded border border-blue-200",children:(0,a.jsx)("p",{className:"text-sm text-gray-700",children:x.message})}),"wallet_address"===x.type&&(0,a.jsx)("div",{className:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:(0,a.jsx)("p",{className:"text-xs text-yellow-800",children:"\uD83D\uDCA1 Wallet address detected. Enter the amount you want to send."})})]}),(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-green-800 font-medium",children:"Your USDT Balance:"}),(0,a.jsx)("span",{className:"text-green-800 font-bold",children:H?"Loading...":"".concat(K," USDT")})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Pay (USDT)"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(S.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:g,onChange:e=>{var s;return s=e.target.value,void(/^\d*\.?\d*$/.test(s)&&(p(s),B(null)))},disabled:!!x.amount,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg disabled:bg-gray-100"})]}),x.amount&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Amount preset by QR code"})]}),(0,a.jsxs)("button",{onClick:ee,disabled:!g||0>=parseFloat(g),className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),"Pay ",g," USDT"]})]}),"processing"===d&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Processing Payment..."}),(0,a.jsx)("p",{className:"text-gray-500",children:"Please wait while we process your QR payment"})]}),P&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(C.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:P})]})]})]}),(0,a.jsx)(A,{isOpen:Q,onClose:()=>Y(!1),currentBalance:K,requiredAmount:g,onBalanceUpdated:J})]}):null}var R=t(57218),F=t(9554);function U(e){let{isOpen:s,onClose:l,onSuccess:o}=e,{user:i,wallet:c,userProfile:d}=(0,r.A)(),[m,u]=(0,n.useState)("create"),[x,h]=(0,n.useState)(""),[g,p]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[v,w]=(0,n.useState)([]),[T,D]=(0,n.useState)("equal"),[I,E]=(0,n.useState)(""),[L,U]=(0,n.useState)(null),[P,B]=(0,n.useState)(!1),[M,_]=(0,n.useState)([]),[W,O]=(0,n.useState)(!1),[K,z]=(0,n.useState)(new Set),[H,G]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)("0"),[q,V]=(0,n.useState)(!1),[J,$]=(0,n.useState)(!1),X=(0,n.useCallback)(async()=>{if(c.address){V(!0);try{let e=await y(c.address);Y(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{V(!1)}}},[c.address]),Z=(0,n.useCallback)(async()=>{O(!0);try{let e=await fetch("".concat(f.PI.BACKEND_URL,"/api/auth/getAllUsers"));if(e.ok){let s=(await e.json()).filter(e=>{var s;return e.walletAddress.toLowerCase()!==(null==(s=c.address)?void 0:s.toLowerCase())});_(s)}else console.error("Failed to fetch users:",e.status),U("Failed to load users")}catch(e){console.error("Error fetching users:",e),U("Failed to load users")}finally{O(!1)}},[c.address]);(0,n.useEffect)(()=>{s&&(X(),Z(),u("create"),h(""),p(""),j(""),w([]),D("equal"),E(""),U(null),z(new Set),G(!1))},[s,X,Z]),(0,n.useEffect)(()=>{if("equal"===T&&b&&v.length>0){let e=(parseFloat(b)/v.length).toFixed(2);w(s=>s.map(s=>({...s,amount:e})))}},[b,v.length,T]);let ee=e=>{if(U(null),"create"===e)return x.trim()?!(!b||0>=parseFloat(b))||(U("Please enter a valid total amount"),!1):(U("Please enter a bill title"),!1);if("participants"===e){if(0===v.length)return U("Please add at least one participant"),!1;let e=v.reduce((e,s)=>e+parseFloat(s.amount||"0"),0),s=parseFloat(b);if(Math.abs(e-s)>.01)return U("Participant amounts (".concat(e.toFixed(2),") don't match total (").concat(s.toFixed(2),")")),!1}return!0},es=()=>{"create"===m&&ee("create")?u("participants"):"participants"===m&&ee("participants")&&u("review")},et=async()=>{if(!c.address||!(null==i?void 0:i.userId))return void U("Wallet not connected");u("processing"),U(null);try{console.log("\uD83D\uDCDD Creating split bill...",{title:x,description:g,totalAmount:b,participants:v.length,creator:c.address});let e=v.map(e=>e.address),s=v.map(e=>(1e18*parseFloat(e.amount)).toString()),a=I?Math.floor(new Date(I).getTime()/1e3):Math.floor(Date.now()/1e3)+604800;console.log("\uD83D\uDD17 Calling SplitBilling contract...",{payee:c.address,debtors:e,amounts:s,token:"0xd55B72640f3e31910A688a2Dc81876F053115B09",deadline:a,description:g||x}),console.log("⚠️  Using simplified contract interaction"),console.log("\uD83D\uDCDD Split bill parameters:",{totalAmount:b,participantCount:v.length,hasDeadline:!!I});let{WalletService:r}=await Promise.resolve().then(t.bind(t,86867)),n=r.getInstance();console.log("\uD83D\uDCE4 Sending transaction to SplitBilling contract...");let m=await n.sendTransaction("0x6892D8358bD3EE04a35Ad5844181BDED05dcdf2f","0x0","0x30d40","0x12345678");console.log("\uD83D\uDCE6 Transaction sent:",m);let u="split_".concat(m.slice(2,10));console.log("✅ Split bill created successfully!",{splitId:u,transactionHash:m});let h={id:u,title:x,description:g,totalAmount:b,participants:v,creator:i.userId,createdAt:new Date,deadline:I?new Date(I):void 0},p=null==d?void 0:d.userId;if(!p)try{let e=await fetch("".concat(f.PI.BACKEND_URL,"/api/auth/getAllUsers"));if(e.ok){let s=(await e.json()).find(e=>{var s;return e.walletAddress.toLowerCase()===(null==(s=c.address)?void 0:s.toLowerCase())});p=null==s?void 0:s.userId}}catch(e){console.error("Failed to get current user ID:",e)}let y={payeeId:p,contributorIds:v.map(e=>e.userId),amounts:v.map(e=>parseFloat(e.amount)),transactionHash:m,title:x,description:g||"",totalAmount:parseFloat(b),deadline:I?new Date(I):void 0,status:v.map(e=>({contributorId:e.userId,paid:!1}))};console.log("\uD83D\uDCE4 Recording split payment in backend:",y),console.log("\uD83D\uDD0D DEBUGGING - Full request details:"),console.log("URL:","".concat(f.PI.BACKEND_URL).concat(f.Sn.SPLIT.RECORD)),console.log("Method: POST"),console.log("Headers:",{"Content-Type":"application/json"}),console.log("Body (stringified):",JSON.stringify(y,null,2)),console.log("Body (raw object):",y);let j=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.SPLIT.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(j.ok){let e=await j.json();console.log("\uD83D\uDCCA Split bill recorded in backend successfully:",e)}else{let e=await j.text();console.warn("Failed to record split bill in backend:",j.status,e)}o(h),l()}catch(e){console.error("❌ Split bill creation failed:",e),U(e instanceof Error?e.message:"Failed to create split bill"),u("review")}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["create"!==m&&"processing"!==m&&(0,a.jsx)("button",{onClick:()=>{"participants"===m?u("create"):"review"===m&&u("participants"),U(null)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900",children:["create"===m&&"Create Split Bill","participants"===m&&"Add Participants","review"===m&&"Review & Create","processing"===m&&"Creating..."]})]}),(0,a.jsx)("button",{onClick:l,disabled:"processing"===m,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(N.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:["create","participants","review"].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(m===e||s<["create","participants","review"].indexOf(m)?"bg-green-600 text-white":"bg-gray-200 text-gray-500"),children:s<["create","participants","review"].indexOf(m)?(0,a.jsx)(k.A,{className:"w-5 h-5"}):s+1}),s<2&&(0,a.jsx)("div",{className:"w-12 h-0.5 mx-2 ".concat(s<["create","participants","review"].indexOf(m)?"bg-green-600":"bg-gray-200")})]},e))})}),(0,a.jsxs)("div",{className:"p-6 max-h-96 overflow-y-auto",children:["create"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bill Title *"}),(0,a.jsx)("input",{type:"text",placeholder:"e.g., Dinner at Restaurant",value:x,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{placeholder:"Optional description...",value:g,onChange:e=>p(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Amount (USDT) *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(S.A,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"0.00",value:b,onChange:e=>{var s;return s=e.target.value,void(/^\d*\.?\d*$/.test(s)&&(j(s),U(null)))},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Deadline (Optional)"}),(0,a.jsx)("input",{type:"date",value:I,onChange:e=>E(e.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsx)("button",{onClick:es,disabled:!x.trim()||!b,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Add Participants"})]}),"participants"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Split Method"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>D("equal"),className:"flex-1 py-2 px-3 rounded-lg font-medium transition-colors ".concat("equal"===T?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Equal Split"}),(0,a.jsx)("button",{onClick:()=>D("custom"),className:"flex-1 py-2 px-3 rounded-lg font-medium transition-colors ".concat("custom"===T?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Custom Amounts"})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Add Participants"}),(0,a.jsx)("button",{type:"button",onClick:()=>G(!H),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium",children:H?"Cancel":"Select Users"})]}),H&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-2",children:0===M.length?(0,a.jsx)("div",{className:"text-gray-500 text-center py-2",children:W?"Loading users...":"No users available"}):M.filter(e=>{var s;return e.walletAddress.toLowerCase()!==(null==(s=c.address)?void 0:s.toLowerCase())}).map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-2 bg-white rounded border",children:[(0,a.jsx)("input",{type:"checkbox",id:"user-".concat(e._id),checked:K.has(e._id),onChange:()=>(e=>{let s=new Set(K);s.has(e)?s.delete(e):s.add(e),z(s)})(e._id),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),(0,a.jsxs)("label",{htmlFor:"user-".concat(e._id),className:"flex-1 cursor-pointer",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.displayName}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.walletAddress})]})]},e._id))}),K.size>0&&(0,a.jsxs)("button",{type:"button",onClick:()=>{let e=M.filter(e=>K.has(e._id));if(0===e.length)return void U("Please select at least one user");let s=e.map(e=>({id:e._id,userId:e.userId,address:e.walletAddress,name:e.displayName,amount:"0",paid:!1}));w(e=>[...e,...s]),z(new Set),G(!1),U(null)},className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(R.A,{className:"w-4 h-4"}),"Add ",K.size," Selected User",K.size>1?"s":""]})]})]}),v.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900",children:["Participants (",v.length,")"]}),v.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),"custom"===T?(0,a.jsx)("input",{type:"text",value:e.amount,onChange:s=>{var t,a;return t=e.id,a=s.target.value,void(/^\d*\.?\d*$/.test(a)&&w(e=>e.map(e=>e.id===t?{...e,amount:a}:e)))},className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm text-center",placeholder:"0.00"}):(0,a.jsxs)("span",{className:"text-sm font-medium",children:[e.amount," USDT"]}),(0,a.jsx)("button",{onClick:()=>{var s;return s=e.id,void w(e=>e.filter(e=>e.id!==s))},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,a.jsx)(F.A,{className:"w-4 h-4"})})]},e.id)),(0,a.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-green-800",children:"Total:"}),(0,a.jsxs)("span",{className:"font-bold text-green-900",children:[v.reduce((e,s)=>e+parseFloat(s.amount||"0"),0).toFixed(2)," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Expected:"}),(0,a.jsxs)("span",{className:"text-green-800",children:[b," USDT"]})]})]})]}),(0,a.jsx)("button",{onClick:es,disabled:0===v.length,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review & Create"})]}),"review"===m&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Bill Summary"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Title:"}),(0,a.jsx)("span",{className:"font-medium",children:x})]}),g&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Description:"}),(0,a.jsx)("span",{className:"font-medium",children:g})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[b," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Participants:"}),(0,a.jsx)("span",{className:"font-medium",children:v.length})]}),I&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Deadline:"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(I).toLocaleDateString()})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Payment Breakdown"}),v.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 border border-gray-200 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsxs)("span",{className:"font-medium",children:[e.amount," USDT"]})]},e.id))]}),(0,a.jsxs)("button",{onClick:et,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),"Create Split Bill"]})]}),"processing"===m&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Creating Split Bill..."}),(0,a.jsx)("p",{className:"text-gray-500",children:"Please wait while we create your split bill on the blockchain"})]}),L&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(C.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:L})]})]})]}),(0,a.jsx)(A,{isOpen:J,onClose:()=>$(!1),currentBalance:Q,requiredAmount:"0",onBalanceUpdated:X})]}):null}class P{startTracking(){this.checkInterval||(console.log("\uD83D\uDD0D Starting transaction status tracking..."),this.checkInterval=setInterval(()=>{this.checkPendingTransactions()},5e3))}stopTracking(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null,console.log("⏹️ Stopped transaction tracking"))}addTransaction(e,s,t){let a={hash:e,status:"pending",timestamp:Date.now(),type:s,confirmations:0,...t};return this.pendingTransactions.set(e,a),console.log("\uD83D\uDCDD Added transaction to tracking: ".concat(e," (").concat(s,")")),this.startTracking(),a}getTransaction(e){return this.pendingTransactions.get(e)||this.confirmedTransactions.get(e)||null}getAllPendingTransactions(){return Array.from(this.pendingTransactions.values())}getAllConfirmedTransactions(){return Array.from(this.confirmedTransactions.values())}async checkPendingTransactions(){if(0===this.pendingTransactions.size)return;console.log("\uD83D\uDD0D Checking ".concat(this.pendingTransactions.size," pending transactions..."));let e=Array.from(this.pendingTransactions.entries()).map(e=>{let[s,t]=e;return this.checkTransactionStatus(s,t)});await Promise.allSettled(e)}async checkTransactionStatus(e,s){try{let t=await this.getTransactionReceipt(e);if(t){let a={...s,status:"success"===t.status?"confirmed":"failed",blockNumber:t.blockNumber,gasUsed:t.gasUsed,confirmations:await this.getConfirmationCount(t.blockNumber)};this.pendingTransactions.delete(e),this.confirmedTransactions.set(e,a),console.log("✅ Transaction ".concat(e," ").concat(a.status," (block: ").concat(t.blockNumber,")")),this.emitTransactionUpdate(a)}else{let e=await this.getCurrentBlockNumber();if(s.blockNumber&&e){let t=Math.max(0,e-s.blockNumber);s.confirmations=t}}}catch(t){console.error("❌ Error checking transaction ".concat(e,":"),t),Date.now()-s.timestamp>6e5&&(s.status="failed",s.error="Transaction timeout",this.pendingTransactions.delete(e),this.confirmedTransactions.set(e,s),this.emitTransactionUpdate(s))}}async getTransactionReceipt(e){try{let s=await fetch(f.PI.RPC_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_getTransactionReceipt",params:[e],id:1})}),t=await s.json();if(t.result)return{transactionHash:t.result.transactionHash,blockNumber:parseInt(t.result.blockNumber,16),gasUsed:parseInt(t.result.gasUsed,16).toString(),status:"0x1"===t.result.status?"success":"failed",logs:t.result.logs||[]};return null}catch(e){return console.error("❌ Error fetching transaction receipt:",e),null}}async getCurrentBlockNumber(){try{let e=await fetch(f.PI.RPC_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_blockNumber",params:[],id:1})}),s=await e.json();return s.result?parseInt(s.result,16):null}catch(e){return console.error("❌ Error fetching block number:",e),null}}async getConfirmationCount(e){let s=await this.getCurrentBlockNumber();return s?Math.max(0,s-e):0}emitTransactionUpdate(e){window.dispatchEvent(new CustomEvent("transaction-update",{detail:e}))}trackFaucetTransaction(e){return this.addTransaction(e,"faucet")}trackTransferTransaction(e,s,t,a){return this.addTransaction(e,"transfer",{from:s,to:t,amount:a})}trackBulkPaymentTransaction(e,s,t){return this.addTransaction(e,"bulk_payment",{recipientCount:s,totalAmount:t})}trackSplitPaymentTransaction(e,s,t){return this.addTransaction(e,"split_payment",{splitId:s,amount:t})}trackApprovalTransaction(e,s,t){return this.addTransaction(e,"approve",{spender:s,amount:t})}getKaiascanUrl(e){return"https://kairos.kaiascope.com/tx/".concat(e)}cleanup(){if(this.confirmedTransactions.size>100){let e=Array.from(this.confirmedTransactions.entries());e.sort((e,s)=>s[1].timestamp-e[1].timestamp),this.confirmedTransactions.clear(),e.slice(0,100).forEach(e=>{let[s,t]=e;this.confirmedTransactions.set(s,t)}),console.log("\uD83E\uDDF9 Cleaned up old transactions, keeping ".concat(100," most recent"))}}constructor(){this.pendingTransactions=new Map,this.confirmedTransactions=new Map,this.checkInterval=null}}let B=new P;class M{async executeBulkPayment(e,s){console.log("\uD83D\uDCB8 Executing bulk payment...",{tokenAddress:e,recipientCount:s.length,contract:f.PI.BULK_PAYROLL_ADDRESS});try{let{WalletService:a}=await Promise.resolve().then(t.bind(t,86867)),r=a.getInstance(),n=r.getState();if(!n.isConnected||!n.address)throw Error("Wallet not connected");let l=s.map(e=>e.address),o=s.map(e=>Math.round(1e18*parseFloat(e.amount)));console.log("\uD83D\uDCDD Bulk payment parameters:",{tokenAddress:e,recipientAddresses:l,recipientAmounts:o.map(e=>e.toString()),totalRecipients:l.length});let i=f.Tb.BULK_PAYROLL.BULK_TRANSFER.slice(2),c=this.encodeBulkTransferData(i,e,l,o);console.log("\uD83D\uDCDD Transaction data prepared:",{methodId:f.Tb.BULK_PAYROLL.BULK_TRANSFER,dataLength:c.length,contract:f.PI.BULK_PAYROLL_ADDRESS}),await this.approveTokenSpend(e,o);let d=await r.sendTransaction(f.PI.BULK_PAYROLL_ADDRESS,"0x0","0x493e0",c);return console.log("✅ Bulk payment transaction sent:",d),console.log("\uD83D\uDD17 View on Kaiascan: https://kairos.kaiascope.com/tx/".concat(d)),B.trackBulkPaymentTransaction(d,s.length,s.reduce((e,s)=>e+parseFloat(s.amount),0).toString()),{success:!0,transactionHash:d}}catch(e){return console.error("❌ Bulk payment failed:",e),{success:!1,error:b.handleBulkPaymentError(e).userMessage}}}async claimFailedTransfer(e){console.log("\uD83D\uDD04 Claiming failed transfer...",{tokenAddress:e});try{let{WalletService:s}=await Promise.resolve().then(t.bind(t,86867)),a=s.getInstance(),r=a.getState();if(!r.isConnected||!r.address)throw Error("Wallet not connected");let n=f.Tb.BULK_PAYROLL.CLAIM_FAILED.slice(2),l=e.replace("0x","").toLowerCase().padStart(64,"0"),o="0x"+n+l;console.log("\uD83D\uDCDD Claim failed transfer data:",{methodId:f.Tb.BULK_PAYROLL.CLAIM_FAILED,tokenAddress:e,data:o});let i=await a.sendTransaction(f.PI.BULK_PAYROLL_ADDRESS,"0x0","0x15f90",o);return console.log("✅ Claim failed transfer successful:",i),{success:!0,transactionHash:i}}catch(e){return console.error("❌ Claim failed transfer error:",e),{success:!1,error:b.handleContractError(e).userMessage}}}async getFailedAmount(e,s){console.log("\uD83D\uDD0D Getting failed amount...",{tokenAddress:e,userAddress:s});try{let{WalletService:e}=await Promise.resolve().then(t.bind(t,86867));return e.getInstance(),"0"}catch(e){return console.error("❌ Failed to get failed amount:",e),"0"}}async approveTokenSpend(e,s){let a=s.reduce((e,s)=>e+s,0),r=2*a;console.log("\uD83D\uDD10 Approving token spend...",{tokenAddress:e,totalAmount:a,approveAmount:r});let{WalletService:n}=await Promise.resolve().then(t.bind(t,86867)),l=n.getInstance(),o=f.Tb.USDT.APPROVE.slice(2),i=f.PI.BULK_PAYROLL_ADDRESS.replace("0x","").toLowerCase().padStart(64,"0"),c=r.toString(16).padStart(64,"0");await l.sendTransaction(e,"0x0","0x15f90","0x"+o+i+c),console.log("✅ Token approval successful")}encodeBulkTransferData(e,s,t,a){let r=s.replace("0x","").toLowerCase().padStart(64,"0"),n=(128+32*t.length).toString(16).padStart(64,"0"),l=t.length.toString(16).padStart(64,"0"),o=t.map(e=>e.replace("0x","").toLowerCase().padStart(64,"0")).join("");return"0x"+e+r+"0000000000000000000000000000000000000000000000000000000000000060"+n+l+o+a.length.toString(16).padStart(64,"0")+a.map(e=>e.toString(16).padStart(64,"0")).join("")}}let _=new M;function W(e){let{isOpen:s,onClose:t,onSuccess:l}=e,{user:o,wallet:i}=(0,r.A)(),[c,m]=(0,n.useState)("select"),[x,h]=(0,n.useState)([]),[g,p]=(0,n.useState)("0"),[b,j]=(0,n.useState)(null),[v,w]=(0,n.useState)(!1),[S,T]=(0,n.useState)([]),[D,I]=(0,n.useState)(!1),[E,L]=(0,n.useState)(new Set),[U,P]=(0,n.useState)("0"),[B,M]=(0,n.useState)(!1),[W,O]=(0,n.useState)(!1),K=(0,n.useCallback)(async()=>{if(i.address){M(!0);try{let e=await y(i.address);P(e.balance)}catch(e){console.error("Failed to load balance:",e)}finally{M(!1)}}},[i.address]),z=(0,n.useCallback)(async()=>{I(!0);try{let e=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS));if(e.ok){let s=(await e.json()).filter(e=>e.lineUserId!==(null==o?void 0:o.userId));T(s)}else console.error("Failed to fetch users:",e.status),j("Failed to load users")}catch(e){console.error("Error fetching users:",e),j("Failed to load users")}finally{I(!1)}},[null==o?void 0:o.userId]);(0,n.useEffect)(()=>{s&&(K(),z(),m("select"),h([]),p("0"),j(null),L(new Set))},[s,K,z]),(0,n.useEffect)(()=>{p(x.reduce((e,s)=>e+parseFloat(s.amount||"0"),0).toFixed(6))},[x]);let H=e=>{if(j(null),"select"===e)return 0!==x.length||(j("Please add at least one recipient"),!1);if("amounts"===e){if(x.some(e=>!e.amount||0>=parseFloat(e.amount)))return j("Please enter valid amounts for all recipients"),!1;if(parseFloat(g)>parseFloat(U))return O(!0),!1}return!0},G=()=>{"select"===c&&H("select")?m("amounts"):"amounts"===c&&H("amounts")&&m("review")},Q=async()=>{if(!i.address||!(null==o?void 0:o.userId))return void j("Wallet not connected");m("processing"),j(null);try{console.log("\uD83D\uDCB0 Executing bulk payment...",{recipientCount:x.length,totalAmount:g,from:i.address});let e=x.map(e=>({address:e.address,amount:e.amount,userId:e.userId})),s=await _.executeBulkPayment(f.PI.USDT_ADDRESS,e);if(!s.success)throw Error(s.error||"Bulk payment failed");let a=s.transactionHash;console.log("✅ Bulk payment transaction sent:",a),console.log("\uD83D\uDCDD Recording bulk payment in backend...");let r=null==o?void 0:o.userId;try{console.log("\uD83D\uDD0D Fetching all users to find sender username...");let e=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.AUTH.GET_ALL_USERS),{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let s=(await e.json()).find(e=>e.lineUserId===(null==o?void 0:o.userId));s?(r=s.userId,console.log("✅ Found sender username:",r)):console.warn("⚠️ Current user not found in backend, using fallback")}else console.warn("⚠️ Failed to fetch users, using fallback username")}catch(e){console.error("❌ Error fetching users:",e),console.log("⚠️ Using fallback username")}let n={id:"bulk_".concat(a.slice(2,10)),recipients:x,totalAmount:g,transactionHash:a,createdAt:new Date},c={senderId:r,receiverIds:x.map(e=>e.userId),amounts:x.map(e=>parseFloat(e.amount)),transactionHash:a,status:"completed"};console.log("\uD83D\uDCE4 BULK PAYMENT REQUEST BODY:",JSON.stringify(c,null,2)),console.log("\uD83D\uDCE4 Request details:",{senderUsername:r,recipientUsernames:x.map(e=>e.userId),amounts:x.map(e=>parseFloat(e.amount)),bulkTx:a,recipientsData:x});let d=await fetch("".concat(f.PI.BACKEND_URL).concat(f.Sn.BULK.RECORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});d.ok||console.warn("Failed to record bulk payment in backend:",d.status),console.log("\uD83C\uDF89 Bulk payment completed successfully!"),l(n),t()}catch(e){console.error("❌ Bulk payment failed:",e),j(e instanceof Error?e.message:"Bulk payment failed"),m("review")}};return s?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["select"!==c&&"processing"!==c&&(0,a.jsx)("button",{onClick:()=>{"amounts"===c?m("select"):"review"===c&&m("amounts"),j(null)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(u.A,{className:"w-6 h-6 text-green-600"}),"select"===c&&"Select Recipients","amounts"===c&&"Set Amounts","review"===c&&"Review Payment","processing"===c&&"Processing..."]})]}),(0,a.jsx)("button",{onClick:t,disabled:"processing"===c,className:"p-1 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:(0,a.jsx)(N.A,{className:"w-6 h-6 text-gray-600"})})]})}),(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:["select","amounts","review"].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(c===e||s<["select","amounts","review"].indexOf(c)?"bg-green-600 text-white":"bg-gray-200 text-gray-500"),children:s<["select","amounts","review"].indexOf(c)?(0,a.jsx)(k.A,{className:"w-5 h-5"}):s+1}),s<2&&(0,a.jsx)("div",{className:"w-12 h-0.5 mx-2 ".concat(s<["select","amounts","review"].indexOf(c)?"bg-green-600":"bg-gray-200")})]},e))})}),(0,a.jsxs)("div",{className:"p-6 max-h-96 overflow-y-auto",children:["select"===c&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Available Users"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[E.size," selected"]})]}),(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 rounded-lg p-3",children:D?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading users..."})]}):0===S.length?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)(d.A,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No users available"})]}):S.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded border",children:[(0,a.jsx)("input",{type:"checkbox",id:"user-".concat(e._id),checked:E.has(e._id),onChange:()=>(e=>{let s=new Set(E);s.has(e)?s.delete(e):s.add(e),L(s)})(e._id),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),(0,a.jsxs)("label",{htmlFor:"user-".concat(e._id),className:"flex-1 cursor-pointer",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.displayName}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 font-mono",children:[e.walletAddress.slice(0,8),"...",e.walletAddress.slice(-6)]})]})]},e._id))}),E.size>0&&(0,a.jsxs)("button",{onClick:()=>{let e=S.filter(e=>E.has(e._id));if(0===e.length)return void j("Please select at least one user");let s=e.map(e=>({id:e._id,userId:e.userId,address:e.walletAddress,name:e.displayName,amount:"0"}));h(e=>[...e,...s]),L(new Set),j(null)},className:"w-full mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(R.A,{className:"w-4 h-4"}),"Add ",E.size," Selected User",E.size>1?"s":""]})]}),x.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900",children:["Recipients (",x.length,")"]}),x.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsx)("button",{onClick:()=>{var s;return s=e.id,void h(e=>e.filter(e=>e.id!==s))},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,a.jsx)(F.A,{className:"w-4 h-4"})})]},e.id))]}),(0,a.jsx)("button",{onClick:G,disabled:0===x.length,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Set Amounts"})]}),"amounts"===c&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-green-800 font-medium",children:"Your USDT Balance:"}),(0,a.jsx)("span",{className:"text-green-800 font-bold",children:B?"Loading...":"".concat(U," USDT")})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Set Payment Amounts"}),x.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsx)("div",{className:"w-24",children:(0,a.jsx)("input",{type:"text",value:e.amount,onChange:s=>{var t,a;return t=e.id,a=s.target.value,void(/^\d*\.?\d*$/.test(a)&&h(e=>e.map(e=>e.id===t?{...e,amount:a}:e)))},placeholder:"0.00",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500"})})]},e.id))]}),(0,a.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-green-800",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-green-900",children:[g," USDT"]})]})}),(0,a.jsx)("button",{onClick:G,disabled:x.some(e=>!e.amount||0>=parseFloat(e.amount)),className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next: Review Payment"})]}),"review"===c&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Payment Summary"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Recipients:"}),(0,a.jsx)("span",{className:"font-medium",children:x.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Amount:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[g," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Network:"}),(0,a.jsx)("span",{className:"font-medium",children:"Kaia Testnet"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Contract:"}),(0,a.jsx)("span",{className:"text-xs font-mono",children:"BulkPayroll"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Payment Breakdown"}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:x.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 border border-gray-200 rounded text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 font-mono",children:[e.address.slice(0,8),"...",e.address.slice(-6)]})]}),(0,a.jsxs)("span",{className:"font-medium",children:[e.amount," USDT"]})]},e.id))})]}),(0,a.jsxs)("button",{onClick:Q,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(k.A,{className:"w-5 h-5"}),"Execute Bulk Payment"]})]}),"processing"===c&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Processing Bulk Payment..."}),(0,a.jsx)("p",{className:"text-gray-500",children:"Approving USDT spending and executing bulk transfer..."})]}),b&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,a.jsx)(C.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 text-sm mt-1",children:b})]})]})]}),(0,a.jsx)(A,{isOpen:W,onClose:()=>O(!1),currentBalance:U,requiredAmount:g,onBalanceUpdated:K})]}):null}var O=t(15239);let K=[{id:"1",name:"Arnav Saikia",walletAddress:"0x1234567890abcdef1234567890abcdef12345678",profilePhoto:"/next.svg",phoneNumber:"+91 82992 24950",lastTransaction:{amount:20,date:"30 Aug, 9:02 pm",type:"received"}},{id:"2",name:"Sarah Johnson",walletAddress:"0xabcdef1234567890abcdef1234567890abcdef12",profilePhoto:"/next.svg",phoneNumber:"+91 98765 43210",lastTransaction:{amount:150,date:"25 Aug, 2:30 pm",type:"sent"}},{id:"3",name:"Mike Chen",walletAddress:"0x9876543210fedcba9876543210fedcba98765432",profilePhoto:"/next.svg",phoneNumber:"+91 87654 32109",lastTransaction:{amount:75,date:"20 Aug, 11:15 am",type:"received"}}];function z(e){let{isOpen:s,onClose:t,onSelectContact:r}=e,[l,o]=(0,n.useState)(""),[i,c]=(0,n.useState)(K);return(0,a.jsx)(x.e,{appear:!0,show:s,as:n.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)(h.lG.Title,{as:"h2",className:"text-gray-900 text-xl font-bold",children:"Pay Anyone"}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search by name, wallet address, or phone",value:l,onChange:e=>{var s;o(s=e.target.value),c(K.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.walletAddress.toLowerCase().includes(s.toLowerCase())||e.phoneNumber.includes(s)))},className:"w-full bg-gray-50 text-gray-900 pl-10 pr-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96",children:0===i.length?(0,a.jsx)("div",{className:"p-6 text-center",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No contacts found"})}):(0,a.jsx)("div",{className:"p-6 space-y-3",children:i.map(e=>(0,a.jsx)("div",{onClick:()=>{r(e)},className:"bg-gray-50 rounded-xl p-4 cursor-pointer hover:bg-green-50 transition-colors border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(O.default,{src:e.profilePhoto,alt:e.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm truncate",children:e.phoneNumber}),(0,a.jsxs)("p",{className:"text-gray-400 text-xs font-mono truncate",children:[e.walletAddress.slice(0,10),"...",e.walletAddress.slice(-8)]})]}),e.lastTransaction&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium ".concat("sent"===e.lastTransaction.type?"text-red-500":"text-green-500"),children:["sent"===e.lastTransaction.type?"-":"+","₹",e.lastTransaction.amount]}),(0,a.jsx)("p",{className:"text-gray-400 text-xs",children:e.lastTransaction.date})]}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},e.id))})})]})})})})]})})}let H=[{id:"1",amount:20,date:"30 Aug, 9:02 pm",type:"received",message:"Payment to you",status:"paid"},{id:"2",amount:30,date:"2 Apr, 9:14 am",type:"sent",message:"Payment to Arnav",status:"paid"},{id:"3",amount:50,date:"10 Jan, 5:59 pm",type:"sent",message:"Payment to Arnav",status:"paid"}];function G(e){let{isOpen:s,onClose:t,contact:r,onPay:l,onRequest:o}=e,[i,c]=(0,n.useState)("");return r?(0,a.jsx)(x.e,{appear:!0,show:s,as:n.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(O.default,{src:r.profilePhoto,alt:r.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-gray-900 text-lg font-bold",children:r.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:r.phoneNumber})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,a.jsx)("button",{className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"space-y-4",children:H.map(e=>(0,a.jsx)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ".concat("received"===e.type?"bg-green-100":"bg-red-100"),children:"received"===e.type?(0,a.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}):(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-gray-900 font-medium truncate",children:e.message}),(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:e.date}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsxs)("span",{className:"text-green-500 text-xs",children:["Paid • ",e.date.split(",")[0]]})]})]}),(0,a.jsx)("div",{className:"text-right flex-shrink-0 ml-2",children:(0,a.jsxs)("div",{className:"text-lg font-bold ".concat("received"===e.type?"text-green-500":"text-red-500"),children:["received"===e.type?"+":"-","₹",e.amount]})}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},e.id))})}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex gap-3 mb-4",children:[(0,a.jsx)("button",{onClick:()=>l(r),className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Pay"}),(0,a.jsx)("button",{onClick:()=>o(r),className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Request"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Message...",value:i,onChange:e=>c(e.target.value),className:"flex-1 bg-gray-50 text-gray-900 px-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none"}),(0,a.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]})]})})})})]})}):null}let Q=[{id:"1",name:"Arnav Saikia",walletAddress:"0x1234567890abcdef1234567890abcdef12345678",profilePhoto:"/next.svg",phoneNumber:"+91 82992 24950"},{id:"2",name:"Sarah Johnson",walletAddress:"0xabcdef1234567890abcdef1234567890abcdef12",profilePhoto:"/next.svg",phoneNumber:"+91 98765 43210"},{id:"3",name:"Mike Chen",walletAddress:"0x9876543210fedcba9876543210fedcba98765432",profilePhoto:"/next.svg",phoneNumber:"+91 87654 32109"},{id:"4",name:"Emma Wilson",walletAddress:"0x5555555555555555555555555555555555555555",profilePhoto:"/next.svg",phoneNumber:"+91 76543 21098"}];function Y(e){let{isOpen:s,onClose:t,onConfirmSplit:r}=e,[l,o]=(0,n.useState)("select"),[i,c]=(0,n.useState)([]),[d,m]=(0,n.useState)(0),[u,g]=(0,n.useState)(""),p=Q.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())||e.walletAddress.toLowerCase().includes(u.toLowerCase())||e.phoneNumber.includes(u)),f=i.reduce((e,s)=>e+s.amount,0),b=.01>Math.abs(f-d);return(0,a.jsx)(x.e,{appear:!0,show:s,as:n.Fragment,children:(0,a.jsxs)(h.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsx)(x.e.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(h.lG.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsxs)(h.lG.Title,{as:"h2",className:"text-gray-900 text-xl font-bold",children:["select"===l&&"Select People","preview"===l&&"Preview Selection","amount"===l&&"Split Amount"]}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),"select"===l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search people...",value:u,onChange:e=>g(e.target.value),className:"w-full bg-gray-50 text-gray-900 pl-10 pr-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-96 p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:p.map(e=>{let s=i.some(s=>s.id===e.id);return(0,a.jsx)("div",{onClick:()=>{i.some(s=>s.id===e.id)?c(s=>s.filter(s=>s.id!==e.id)):c(s=>[...s,{...e,amount:0,isCustomAmount:!1}])},className:"bg-gray-50 rounded-xl p-4 cursor-pointer transition-colors border ".concat(s?"ring-2 ring-green-500 bg-green-50 border-green-200":"hover:bg-green-50 border-gray-100"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(O.default,{src:e.profilePhoto,alt:e.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm truncate",children:e.phoneNumber})]}),s&&(0,a.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})},e.id)})})}),(0,a.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,a.jsxs)("button",{onClick:()=>{0!==i.length&&o("preview")},disabled:0===i.length,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-lg font-medium transition-colors",children:["Preview Selection (",i.length,")"]})})]}),"preview"===l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-y-auto max-h-96 p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,a.jsx)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(O.default,{src:e.profilePhoto,alt:e.name,width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 text-sm truncate",children:e.phoneNumber})]}),(0,a.jsx)("button",{onClick:()=>{var s;return s=e.id,void c(e=>e.filter(e=>e.id!==s))},className:"text-red-500 hover:text-red-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},e.id))})}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200 space-y-3",children:[(0,a.jsx)("button",{onClick:()=>{o("select")},className:"w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors",children:"Back to Selection"}),(0,a.jsx)("button",{onClick:()=>{c([]),o("select")},className:"w-full bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Drop All"}),(0,a.jsx)("button",{onClick:()=>{o("amount")},disabled:0===i.length,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Proceed to Amount"})]})]}),"amount"===l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsx)("label",{className:"block text-gray-600 text-sm mb-2",children:"Total Amount to Split"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₹"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>m(Number(e.target.value)),className:"w-full bg-gray-50 text-gray-900 pl-8 pr-4 py-3 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none",placeholder:"0.00"})]})]}),(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex gap-3 mb-4",children:[(0,a.jsx)("button",{onClick:()=>{let e=d/i.length;c(s=>s.map(s=>({...s,amount:e,isCustomAmount:!1})))},className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium transition-colors",children:"Split Equally"}),(0,a.jsx)("button",{onClick:()=>{c(e=>e.map(e=>({...e,amount:0,isCustomAmount:!0})))},className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors",children:"Custom Split"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-64 p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(O.default,{src:e.profilePhoto,alt:e.name,width:20,height:20,className:"rounded-full"})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsx)("h3",{className:"text-gray-900 font-medium truncate",children:e.name})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₹"}),(0,a.jsx)("input",{type:"number",value:e.amount,onChange:s=>{var t,a;return t=e.id,a=Number(s.target.value),void c(e=>e.map(e=>e.id===t?{...e,amount:a,isCustomAmount:!0}:e))},className:"w-full bg-white text-gray-900 pl-8 pr-4 py-2 rounded-lg border border-gray-200 focus:border-green-500 focus:outline-none",placeholder:"0.00"})]})]},e.id))})}),(0,a.jsxs)("div",{className:"p-6 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,a.jsxs)("span",{className:"text-lg font-bold ".concat(b?"text-green-500":"text-red-500"),children:["₹",f.toFixed(2)]})]}),(0,a.jsx)("button",{onClick:()=>{b&&(r(i,d),t())},disabled:!b||0===d,className:"w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-lg font-medium transition-colors",children:"Confirm Split"})]})]})]})})})})]})})}function q(e){let{isOpen:s,onClose:t,onSelectContact:r,friends:l}=e,[o,i]=(0,n.useState)(""),c=l.filter(e=>e.displayName.toLowerCase().includes(o.toLowerCase()));return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-t-3xl w-full max-w-md max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Friends"}),(0,a.jsx)("button",{onClick:t,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-gray-600"})})]}),(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(w.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search friends...",value:o,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"space-y-3",children:c.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:c.map(e=>(0,a.jsxs)("div",{onClick:()=>{r(e)},className:"flex flex-col items-center gap-3 p-4 rounded-xl hover:bg-gray-50 transition-colors cursor-pointer",children:[(0,a.jsxs)("div",{className:"relative w-16 h-16",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full overflow-hidden",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://randomuser.me/api/portraits/men/".concat(Math.floor(50*Math.random()),".jpg"),alt:e.displayName,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/".concat(Math.floor(50*Math.random()),".jpg")}})}),Math.random()>.7&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:Math.floor(3*Math.random())+1})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.displayName}),(0,a.jsx)("p",{className:"text-xs font-medium text-gray-500",children:e.statusMessage||"LINE Friend"})]})]},e.userId))}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No friends found"})})})})]})}):null}class V{async getLenderInfo(e,s){return{totalSupplied:"0",totalDeposited:"0",earnedInterest:"0",currentEarnings:"0",claimableEarnings:"0",lpTokenBalance:"0",projectedAPY:0,apy:"0",balance:"0"}}async getReferralInfo(e){return{isRegistered:!1,code:"",totalReferred:0,totalReferrals:0,totalEarned:"0",totalRewardsEarned:"0",claimableRewards:"0",hasReferrer:!1}}async getBorrowerDashboard(e){return{totalBorrowed:"0",totalCollateral:"0",totalCollateralUSD:"0",totalDebtUSD:"0",currentLTV:"0",healthFactor:"0",availableCredit:"0",liquidationRisk:"low"}}async getDebtBreakdown(e,s){return{principal:"0",accrued:"0",total:"0",currentInterestRate:"0"}}async registerReferralCode(e){console.log("\uD83D\uDCDD Enhanced Lending - Register referral code:",{code:e});let s="0x".concat(Date.now().toString(16).padStart(64,"0"));return console.log("✅ Referral registration simulation successful:",s),s}async joinWithReferral(e,s){console.log("\uD83E\uDD1D Enhanced Lending - Join with referral:",{code:e,referrer:s});let t="0x".concat(Date.now().toString(16).padStart(64,"0"));return console.log("✅ Join referral simulation successful:",t),t}async claimReferralRewards(){console.log("\uD83C\uDF81 Enhanced Lending - Claim referral rewards");try{let{WalletService:e}=await Promise.resolve().then(t.bind(t,86867)),s=e.getInstance(),a=s.getState();if(!a.isConnected||!a.address)throw Error("Wallet not connected");let r=f.PI.ENHANCED_LENDING_ADDRESS,n="0x05eaab4b";console.log("\uD83D\uDCDD Creating claim referral rewards transaction:",{contract:r,methodId:n,data:n});let l=await s.sendTransaction(r,"0x0","0x15f90",n);return console.log("✅ Claim referral rewards transaction successful:",l),l}catch(e){throw console.error("❌ Claim referral rewards failed:",e),e}}async lend(e,s){return console.log("\uD83C\uDFE6 Enhanced Lending - Lend request (alias for deposit):",{tokenAddress:e,amount:s}),this.deposit(e,s)}async deposit(e,s){console.log("\uD83C\uDFE6 Enhanced Lending - Deposit request:",{tokenAddress:e,amount:s});try{let{WalletService:a}=await Promise.resolve().then(t.bind(t,86867)),r=a.getInstance(),n=r.getState();if(!n.isConnected||!n.address)throw Error("Wallet not connected");let l=f.PI.ENHANCED_LENDING_ADDRESS,o=BigInt(Math.floor(1e18*parseFloat(s))),i="0x47e7ef24",c=e.replace("0x","").toLowerCase().padStart(64,"0"),d=o.toString(16).padStart(64,"0"),m="0x"+i.replace("0x","")+c+d;console.log("\uD83D\uDCDD Creating deposit transaction:",{contract:l,methodId:i,function:"deposit(address,uint256)",tokenAddress:e,amount:s,amountInWei:o,data:m});let u=o*BigInt(2);console.log("� First approving token spend...");let x=l.replace("0x","").toLowerCase().padStart(64,"0"),h=u.toString(16).padStart(64,"0");await r.sendTransaction(e,"0x0","0x15f90","0x095ea7b3"+x+h),console.log("✅ Token approval successful, now depositing...");let g=await r.sendTransaction(l,"0x0","0x15f90",m);return console.log("✅ Enhanced lending deposit transaction successful:",g),console.log("\uD83D\uDD17 View on Kaiascan: https://kairos.kaiascope.com/tx/".concat(g)),g}catch(e){throw console.error("❌ Deposit failed:",e),e}}async claimLendingEarnings(e){console.log("\uD83C\uDFAF Enhanced Lending - Claim earnings request:",{tokenAddress:e});try{let{WalletService:s}=await Promise.resolve().then(t.bind(t,86867)),a=s.getInstance(),r=a.getState();if(!r.isConnected||!r.address)throw Error("Wallet not connected");let n=f.PI.ENHANCED_LENDING_ADDRESS,l="0x790778b1",o=e.replace("0x","").toLowerCase().padStart(64,"0"),i=l+o;console.log("� Creating claim earnings transaction:",{contract:n,methodId:l,tokenAddress:e,data:i});let c=await a.sendTransaction(n,"0x0","0x15f90",i);return console.log("✅ Claim earnings transaction successful:",c),c}catch(e){throw console.error("❌ Claim failed:",e),e}}async withdraw(e,s){console.log("\uD83C\uDFE7 Enhanced Lending - Withdraw request:",{tokenAddress:e,amount:s});try{let{WalletService:a}=await Promise.resolve().then(t.bind(t,86867)),r=a.getInstance(),n=r.getState();if(!n.isConnected||!n.address)throw Error("Wallet not connected");let l=f.PI.ENHANCED_LENDING_ADDRESS,o=Math.round(1e18*parseFloat(s)),i=e===f.PI.USDT_ADDRESS?f.PI.K_USDT_ADDRESS:f.PI.K_KAIA_ADDRESS,c="0x1e9a6950",d=i.replace("0x","").toLowerCase().padStart(64,"0"),m=o.toString(16).padStart(64,"0"),u=c+d+m;console.log("\uD83D\uDCDD Creating redeem transaction:",{contract:l,methodId:c,function:"redeem(address,uint256)",lpTokenAddress:i,amount:s,lpAmountInWei:o,data:u});let x=await r.sendTransaction(l,"0x0","0x15f90",u);return console.log("✅ Enhanced lending redeem transaction successful:",x),console.log("\uD83D\uDD17 View on Kaiascan: https://kairos.kaiascope.com/tx/".concat(x)),x}catch(e){throw console.error("❌ Withdraw failed:",e),e}}async borrow(e,s){throw Error("Enhanced lending service temporarily disabled")}async repay(e,s){throw Error("Enhanced lending service temporarily disabled")}async stake(e){throw Error("Enhanced lending service temporarily disabled")}async unstake(e){throw Error("Enhanced lending service temporarily disabled")}async depositCollateral(e){throw Error("Enhanced lending service temporarily disabled")}async repayInterest(e,s){throw Error("Enhanced lending service temporarily disabled")}async liquidate(e,s){throw Error("Enhanced lending service temporarily disabled")}}let J=new V,$={kairos:{enhancedLending:"0x5FbDB2315678afecb367f032d93F642f64180aa3",usdt:"0xd55B72640f3e31910A688a2Dc81876F053115B09",kaia:"0x0000000000000000000000000000000000000001",usdy:"0x0000000000000000000000000000000000000003",kKAIA:"0x0000000000000000000000000000000000000004",kUSDT:"0x0000000000000000000000000000000000000005",bulkPayroll:"0xE9bD986514a6d35B1B73BeA6F19804D3c7aed284",invoiceService:"0xc70DfAf8d864125D37237fc7B034ACAE1f3397d9",splitBilling:"0x6892D8358bD3EE04a35Ad5844181BDED05dcdf2f"},hardhat:{enhancedLending:"0x5FbDB2315678afecb367f032d93F642f64180aa3",usdt:"0xd55B72640f3e31910A688a2Dc81876F053115B09",kaia:"0x0000000000000000000000000000000000000001",usdy:"0x0000000000000000000000000000000000000003",kKAIA:"0x0000000000000000000000000000000000000004",kUSDT:"0x0000000000000000000000000000000000000005",bulkPayroll:"0xE9bD986514a6d35B1B73BeA6F19804D3c7aed284",invoiceService:"0xc70DfAf8d864125D37237fc7B034ACAE1f3397d9",splitBilling:"0x6892D8358bD3EE04a35Ad5844181BDED05dcdf2f"},kaia:{enhancedLending:"",usdt:"",kaia:"",usdy:"",kKAIA:"",kUSDT:"",bulkPayroll:"",invoiceService:"",splitBilling:""}};function X(e){return $["localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"hardhat":"kairos"][e]}let Z=()=>X("usdt"),ee=()=>X("kaia");function es(e){let{onClose:s}=e,{userProfile:t}=(0,r.A)(),[l,o]=(0,n.useState)("lend"),[i,c]=(0,n.useState)("USDT"),[d,m]=(0,n.useState)(""),[u,x]=(0,n.useState)(!1),[h,g]=(0,n.useState)(null),p=(0,n.useMemo)(()=>({USDT:{icon:"\uD83D\uDCB2",address:Z(),name:"USDT"},KAIA:{icon:"\uD83D\uDD38",address:ee(),name:"KAIA"}}),[]),f=(0,n.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=p[i].address,s=await J.getLenderInfo(t.walletAddress,e);g(s)}catch(e){console.error("Failed to load lender info:",e)}},[null==t?void 0:t.walletAddress,i,p]);(0,n.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&f()},[null==t?void 0:t.walletAddress,f]);let b=async()=>{try{if(!d||0>=parseFloat(d))return void alert("Please enter a valid amount");x(!0);let e=p[i].address,s=await J.deposit(e,d);console.log("✅ Lending successful:",s),alert("Successfully lent ".concat(d," ").concat(i,"! Transaction: ").concat(s.slice(0,10),"...")),m(""),await f()}catch(e){console.error("❌ Lending failed:",e),alert("Lending failed. Please try again.")}finally{x(!1)}},y=async()=>{try{x(!0);let e=p[i].address,s=await J.claimLendingEarnings(e);console.log("✅ Claim successful:",s),alert("Successfully claimed earnings! Transaction: ".concat(s.slice(0,10),"...")),await f()}catch(e){console.error("❌ Claim failed:",e),alert("Claim failed. Please try again.")}finally{x(!1)}},j=async()=>{try{if(!d||0>=parseFloat(d))return void alert("Please enter a valid amount");x(!0);let e=p[i].address,s=await J.withdraw(e,d);console.log("✅ Withdraw successful:",s),alert("Successfully withdrew ".concat(d," ").concat(i,"! Transaction: ").concat(s.slice(0,10),"...")),m(""),await f()}catch(e){console.error("❌ Withdraw failed:",e),alert("Withdraw failed. Please try again.")}finally{x(!1)}},v=e=>{var s;let{asset:t}=e;return(0,a.jsx)("span",{className:"text-lg",children:(null==(s=p[t])?void 0:s.icon)||"\uD83D\uDCB0"})};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Earn Money"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"flex border-b border-gray-200 flex-shrink-0",children:["lend","claim","withdraw"].map(e=>(0,a.jsx)("button",{onClick:()=>o(e),className:"flex-1 py-3 text-sm font-medium capitalize ".concat(l===e?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),children:e},e))}),(0,a.jsxs)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:["lend"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Asset"}),(0,a.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:u,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})]}),h&&(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Current Position"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Deposited:"}),(0,a.jsxs)("span",{className:"font-medium",children:[parseFloat(h.totalDeposited).toFixed(2)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Current Earnings:"}),(0,a.jsxs)("span",{className:"font-medium text-green-600",children:[parseFloat(h.currentEarnings).toFixed(4)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"APY:"}),(0,a.jsxs)("span",{className:"font-medium",children:[(h.projectedAPY/100).toFixed(1),"%"]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Lend"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>m(e.target.value),placeholder:"Enter amount",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:u})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-green-800",children:"Expected APY: 8.5%"}),(0,a.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"Earn rewards by lending your assets"})]}),(0,a.jsx)("button",{onClick:b,disabled:u||!d||0>=parseFloat(d),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{asset:i}),"Lend ",i]})})]}),"claim"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Your Earnings"}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm",disabled:u,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})}),(0,a.jsx)("div",{className:"space-y-2",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600 flex items-center gap-2",children:[(0,a.jsx)(v,{asset:i}),"Total Deposited:"]}),(0,a.jsxs)("span",{className:"font-medium",children:[parseFloat(h.totalDeposited).toFixed(2)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83C\uDFAF"}),"Current Earnings:"]}),(0,a.jsxs)("span",{className:"font-medium text-green-600",children:[parseFloat(h.currentEarnings).toFixed(4)," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),"Claimable:"]}),(0,a.jsxs)("span",{className:"font-bold text-green-700",children:[parseFloat(h.claimableEarnings).toFixed(4)," ",i]})]})]}):(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading earnings..."})]})})]}),(0,a.jsx)("button",{onClick:y,disabled:u||!h||0>=parseFloat(h.claimableEarnings),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Claim ".concat(h?parseFloat(h.claimableEarnings).toFixed(4):"0"," ").concat(i)})]}),"withdraw"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Asset to Withdraw"}),(0,a.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:u,children:[(0,a.jsxs)("option",{value:"USDT",children:["\uD83D\uDCB2 USDT (Available: ",h?parseFloat(h.lpTokenBalance).toFixed(2):"0",")"]}),(0,a.jsxs)("option",{value:"KAIA",children:["\uD83D\uDD38 KAIA (Available: ",h?parseFloat(h.lpTokenBalance).toFixed(2):"0",")"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Withdraw"}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>m(e.target.value),placeholder:"Enter amount",max:h?parseFloat(h.lpTokenBalance):0,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:u})]}),(0,a.jsx)("button",{onClick:j,disabled:u||!d||0>=parseFloat(d),className:"w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{asset:i}),"Withdraw Funds"]})})]})]})]})})}function et(e){let{onClose:s}=e,{userProfile:t}=(0,r.A)(),[l,o]=(0,n.useState)("getLoan"),[i,c]=(0,n.useState)("USDY"),[d,m]=(0,n.useState)(""),[u,x]=(0,n.useState)(""),[h,g]=(0,n.useState)(""),[p,f]=(0,n.useState)("USDT"),[b,y]=(0,n.useState)(!1),[j,v]=(0,n.useState)(null),[N,w]=(0,n.useState)(null),S=(0,n.useMemo)(()=>({USDT:{icon:"\uD83D\uDCB2",address:Z(),name:"USDT"},KAIA:{icon:"\uD83D\uDD38",address:ee(),name:"KAIA"},USDY:{icon:"\uD83D\uDC8E",address:X("usdy"),name:"USDY"}}),[]),k=(0,n.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=await J.getBorrowerDashboard(t.walletAddress);v(e)}catch(e){console.error("Failed to load borrower info:",e)}},[null==t?void 0:t.walletAddress]),C=(0,n.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=S[p].address,s=await J.getDebtBreakdown(t.walletAddress,e);w(s)}catch(e){console.error("Failed to load debt breakdown:",e)}},[null==t?void 0:t.walletAddress,p,S]);(0,n.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&k()},[null==t?void 0:t.walletAddress,k]),(0,n.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&"repayLoan"===l&&C()},[null==t?void 0:t.walletAddress,p,l,C]);let A=async()=>{try{if(!u||0>=parseFloat(u))return void alert("Please enter a valid collateral amount");y(!0);let e=await J.depositCollateral(u);console.log("✅ Collateral deposit successful:",e),alert("Successfully deposited ".concat(u," USDY as collateral! Transaction: ").concat(e.slice(0,10),"...")),await k()}catch(e){console.error("❌ Collateral deposit failed:",e),alert("Collateral deposit failed. Please try again.")}finally{y(!1)}},T=async()=>{try{if(!d||0>=parseFloat(d))return void alert("Please enter a valid borrow amount");y(!0);let e=S[p].address,s=await J.borrow(e,d);console.log("✅ Borrow successful:",s),alert("Successfully borrowed ".concat(d," ").concat(p,"! Transaction: ").concat(s.slice(0,10),"...")),m(""),x(""),await k()}catch(e){console.error("❌ Borrow failed:",e),alert("Borrow failed. Please try again.")}finally{y(!1)}},D=async()=>{try{if(!h||0>=parseFloat(h))return void alert("Please enter a valid repay amount");y(!0);let e=S[p].address,s=await J.repay(e,h);console.log("✅ Repay successful:",s),alert("Successfully repaid ".concat(h," ").concat(p,"! Transaction: ").concat(s.slice(0,10),"...")),g(""),await k(),await C()}catch(e){console.error("❌ Repay failed:",e),alert("Repay failed. Please try again.")}finally{y(!1)}},I=async()=>{try{y(!0);let e=S[p].address,s=await J.repayInterest(e,"0");console.log("✅ Interest repay successful:",s),alert("Successfully repaid all interest for ".concat(p,"! Transaction: ").concat(s.slice(0,10),"...")),await k(),await C()}catch(e){console.error("❌ Interest repay failed:",e),alert("Interest repay failed. Please try again.")}finally{y(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Take Loan"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"flex border-b border-gray-200 flex-shrink-0",children:["getLoan","repayLoan"].map(e=>(0,a.jsx)("button",{onClick:()=>o(e),className:"flex-1 py-3 text-sm font-medium ".concat(l===e?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),children:"getLoan"===e?"Get Loan":"Repay Loan"},e))}),(0,a.jsxs)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:["getLoan"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[j&&(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-3",children:"Your Position"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Collateral:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",parseFloat(j.totalCollateralUSD).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Debt:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",parseFloat(j.totalDebtUSD).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Current LTV:"}),(0,a.jsxs)("span",{className:"font-medium ".concat(parseFloat(j.currentLTV)>75?"text-red-600":"text-green-600"),children:[parseFloat(j.currentLTV).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Max LTV:"}),(0,a.jsx)("span",{className:"font-medium",children:"80%"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Collateral Asset"}),(0,a.jsx)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b,children:(0,a.jsx)("option",{value:"USDY",children:"\uD83D\uDC8E USDY"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Borrow Token"}),(0,a.jsxs)("select",{value:p,onChange:e=>f(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Amount to Borrow (",p,")"]}),(0,a.jsx)("input",{type:"number",value:d,onChange:e=>{m(e.target.value),x(((parseFloat(e.target.value)||0)/.8).toFixed(2))},placeholder:"Enter borrow amount",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Required Collateral"}),(0,a.jsx)("input",{type:"number",value:u,onChange:e=>x(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg bg-gray-50",placeholder:"Collateral will be calculated",disabled:b}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"LTV Ratio: 80% (You can borrow up to 80% of collateral value)"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-blue-800",children:"Interest Rate: 5% APR"}),(0,a.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Competitive rates for your loan"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:A,disabled:b||!u||0>=parseFloat(u),className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Deposit ".concat(u||"0"," USDY Collateral")}),(0,a.jsx)("button",{onClick:T,disabled:b||!d||0>=parseFloat(d),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Borrow ".concat(d||"0"," ").concat(p)})]})]}),"repayLoan"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Token to Repay"}),(0,a.jsxs)("select",{value:p,onChange:e=>f(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b,children:[(0,a.jsx)("option",{value:"USDT",children:"\uD83D\uDCB2 USDT"}),(0,a.jsx)("option",{value:"KAIA",children:"\uD83D\uDD38 KAIA"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900 mb-2",children:["Current Debt - ",p]}),N?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Principal:"}),(0,a.jsxs)("span",{className:"font-medium",children:[parseFloat(N.principal).toFixed(2)," ",p]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Interest Accrued:"}),(0,a.jsxs)("span",{className:"font-medium text-red-600",children:[parseFloat(N.accrued).toFixed(4)," ",p]})]}),(0,a.jsxs)("div",{className:"flex justify-between border-t pt-2",children:[(0,a.jsx)("span",{className:"text-gray-600 font-semibold",children:"Total to Repay:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[parseFloat(N.total).toFixed(2)," ",p]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Interest Rate:"}),(0,a.jsxs)("span",{className:"font-medium",children:[N.currentInterestRate,"% APR"]})]})]}):(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading debt info..."})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount to Repay"}),(0,a.jsx)("input",{type:"number",value:h,onChange:e=>g(e.target.value),placeholder:"Enter repay amount",max:N?parseFloat(N.total):0,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:b})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:I,disabled:b||!N||0>=parseFloat(N.accrued),className:"w-full bg-yellow-500 text-white py-3 rounded-lg font-medium hover:bg-yellow-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Pay Interest Only (".concat(N?parseFloat(N.accrued).toFixed(4):"0"," ").concat(p,")")}),(0,a.jsx)("button",{onClick:D,disabled:b||!h||0>=parseFloat(h),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Repay ".concat(h||"0"," ").concat(p)}),N&&parseFloat(N.total)>0&&(0,a.jsx)("button",{onClick:()=>{g(N.total),D()},disabled:b,className:"w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Repay Full Debt (".concat(parseFloat(N.total).toFixed(2)," ").concat(p,")")})]})]})]})]})})}function ea(e){let{onClose:s}=e,{userProfile:t}=(0,r.A)(),[l,o]=(0,n.useState)(!1),[i,c]=(0,n.useState)(null),[d,x]=(0,n.useState)(""),[h,g]=(0,n.useState)(""),[p,f]=(0,n.useState)(!1),b=(0,n.useCallback)(()=>{if(null==t?void 0:t.displayName){let e=t.displayName.replace(/\s+/g,"").toUpperCase(),s=Date.now().toString().slice(-4);return"".concat(e,"_").concat(s)}return"USER_".concat(Date.now().toString().slice(-6))},[null==t?void 0:t.displayName]),y="https://kaiapay.app/join?ref=".concat(d,"&referrer=").concat(null==t?void 0:t.walletAddress),j=(0,n.useCallback)(async()=>{try{if(!(null==t?void 0:t.walletAddress))return;let e=await J.getReferralInfo(t.walletAddress);c(e),e.isRegistered||x(b())}catch(e){console.error("Failed to load referral info:",e)}},[null==t?void 0:t.walletAddress,b]);(0,n.useEffect)(()=>{(null==t?void 0:t.walletAddress)&&j()},[null==t?void 0:t.walletAddress,j]);let v=async()=>{try{if(!d.trim())return void alert("Please enter a referral code");o(!0);let e=await J.registerReferralCode(d.trim());console.log("✅ Referral code registered:",e),alert("Successfully registered referral code! Transaction: ".concat(e.slice(0,10),"...")),await j()}catch(e){console.error("❌ Referral code registration failed:",e),alert("Failed to register referral code. Please try again.")}finally{o(!1)}},N=async()=>{try{if(!d.trim()||!h.trim())return void alert("Please enter both referral code and referrer address");o(!0);let e=await J.joinWithReferral(d.trim(),h.trim());console.log("✅ Joined with referral:",e),alert("Successfully joined with referral! Transaction: ".concat(e.slice(0,10),"...")),await j()}catch(e){console.error("❌ Join with referral failed:",e),alert("Failed to join with referral. Please try again.")}finally{o(!1)}},w=async()=>{try{o(!0);let e=await J.claimReferralRewards();console.log("✅ Rewards claimed:",e),alert("Successfully claimed referral rewards! Transaction: ".concat(e.slice(0,10),"...")),await j()}catch(e){console.error("❌ Claim rewards failed:",e),alert("Failed to claim rewards. Please try again.")}finally{o(!1)}},S=async()=>{try{await navigator.clipboard.writeText(d),alert("Referral code copied to clipboard!")}catch(e){console.error("Failed to copy referral code:",e),alert("Failed to copy referral code")}},k=async()=>{try{await navigator.clipboard.writeText(y),alert("Referral link copied to clipboard!")}catch(e){console.error("Failed to copy referral link:",e),alert("Failed to copy referral link")}},C=async()=>{try{navigator.share?await navigator.share({title:"Join KaiaPay and Earn Rewards!",text:'Join KaiaPay using my referral code "'.concat(d,'" and get a 2 USDT bonus!'),url:y}):await k()}catch(e){console.error("Failed to share referral link:",e)}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Refer & Earn"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[(0,a.jsx)("h3",{className:"font-medium text-green-900 mb-3",children:"Your Referral Earnings"}),i?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Total Referrals:"}),(0,a.jsx)("span",{className:"font-medium",children:i.totalReferrals})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Total Earned:"}),(0,a.jsxs)("span",{className:"font-bold text-lg",children:[parseFloat(i.totalRewardsEarned).toFixed(2)," USDT"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-green-700",children:"Available to Claim:"}),(0,a.jsxs)("span",{className:"font-medium text-green-800",children:[parseFloat(i.claimableRewards).toFixed(2)," USDT"]})]}),i.hasReferrer&&(0,a.jsx)("div",{className:"text-xs text-green-600 mt-2",children:"✅ You joined with a referral and received your signup bonus!"})]}):(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-green-300 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-green-700 text-sm",children:"Loading earnings..."})]})]}),i&&!i.isRegistered&&(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-3",children:"Register Your Referral Code"}),(0,a.jsx)("div",{className:"space-y-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-blue-700 mb-1",children:"Your Referral Code"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>x(e.target.value),className:"flex-1 p-2 border border-blue-300 rounded text-sm font-mono",placeholder:"Enter your referral code",disabled:l}),(0,a.jsx)("button",{onClick:v,disabled:l||!d.trim(),className:"px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"Register"})]})]})})]}),i&&!i.hasReferrer&&(0,a.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[(0,a.jsx)("h4",{className:"font-medium text-orange-900 mb-3",children:"Join with a Referral Code"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-orange-700 mb-1",children:"Referral Code"}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>x(e.target.value),className:"w-full p-2 border border-orange-300 rounded text-sm",placeholder:"Enter friend's referral code",disabled:l})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-orange-700 mb-1",children:"Referrer Address"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),className:"w-full p-2 border border-orange-300 rounded text-sm font-mono",placeholder:"0x...",disabled:l})]}),(0,a.jsx)("button",{onClick:N,disabled:l||!d.trim()||!h.trim(),className:"w-full bg-orange-600 text-white py-2 rounded text-sm font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Join with Referral (Get 2 USDT Bonus!)"})]})]}),i&&i.isRegistered&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Referral Code"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:d,readOnly:!0,className:"flex-1 p-3 border border-gray-300 rounded-lg bg-gray-50 font-mono"}),(0,a.jsx)("button",{onClick:S,className:"p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:(0,a.jsx)(u.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Referral Link"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:y,readOnly:!0,className:"flex-1 p-3 border border-gray-300 rounded-lg bg-gray-50 text-xs"}),(0,a.jsx)("button",{onClick:k,className:"p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:(0,a.jsx)(m.A,{className:"w-5 h-5"})})]})]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"How it works:"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsx)("li",{children:"• Earn 5 USDT for each successful referral"}),(0,a.jsx)("li",{children:"• Your friend gets 2 USDT signup bonus"}),(0,a.jsx)("li",{children:"• Earn 0.1% of their transaction volume"}),(0,a.jsx)("li",{children:"• No limit on number of referrals"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:w,disabled:l||!i||0>=parseFloat(i.claimableRewards),className:"w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"}):"Claim Earnings (".concat(i?parseFloat(i.claimableRewards).toFixed(2):"0"," USDT)")}),i&&i.isRegistered&&(0,a.jsx)("button",{onClick:C,className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"Share on Social Media"})]})]})})]})})}function er(){var e,s;let{onTabChange:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{user:l,userProfile:o,friends:i,logout:x}=(0,r.A)(),[h,g]=(0,n.useState)(!1),[b,y]=(0,n.useState)([]),[j,v]=(0,n.useState)(null),[N,w]=(0,n.useState)([]),[S,k]=(0,n.useState)([]),[C,A]=(0,n.useState)(!0),[D,I]=(0,n.useState)([]),[E,R]=(0,n.useState)(null),[F,P]=(0,n.useState)(!1);console.log("\uD83C\uDFE0 HomePage - User Profile:",o);let[B,M]=(0,n.useState)(!1),[_,O]=(0,n.useState)(!1),[K,H]=(0,n.useState)(!1),[Q,V]=(0,n.useState)(!1),[J,$]=(0,n.useState)(!1),[X,Z]=(0,n.useState)(!1),[ee,er]=(0,n.useState)(!1),[eo,ei]=(0,n.useState)(!1),[ec,ed]=(0,n.useState)(!1),[em,eu]=(0,n.useState)(null),[ex,eh]=(0,n.useState)(null),[eg]=(0,n.useState)(3),[ep,ef]=(0,n.useState)(!1),[eb,ey]=(0,n.useState)(!1),[ej,ev]=(0,n.useState)(!1),[eN,ew]=(0,n.useState)(!1),[eS,ek]=(0,n.useState)(!1),eC=(0,n.useCallback)(async()=>{if(null==l?void 0:l.userId)try{console.log("\uD83D\uDD0D Fetching all users and current user profile...");let e=await fetch("".concat(f.PI.BACKEND_URL,"/api/auth/getAllUsers"));if(!e.ok)throw Error("Failed to fetch all users");let s=await e.json();console.log("✅ All users fetched:",s),y(s);let t=s.find(e=>e.lineUserId===l.userId);return console.log("✅ Current user profile found:",t),v(t),t}catch(e){return console.error("❌ Error fetching users:",e),null}},[null==l?void 0:l.userId]),eA=(0,n.useCallback)(async()=>{let e=j||await eC();if(null==e?void 0:e.userId)try{A(!0),console.log("\uD83D\uDD0D Fetching transaction history for user:",e.userId);let s=await fetch("".concat(f.PI.BACKEND_URL,"/api/history/getUserTxnHistory/").concat(e.userId));if(!s.ok)throw Error("Failed to fetch transaction history");let t=(await s.json()).transactions;console.log("✅ Transactions fetched:",t);let a=new Map;t.forEach(s=>{var t,r,n;let l=null;if("P2P"===s.transactionType?s.senderId===e.userId?l=s.receiverId||null:s.receiverId===e.userId&&(l=s.senderId||null):"Bulk Transfer"===s.transactionType?s.senderId===e.userId&&(null==(t=s.receiverIds)||t.forEach(s=>{s!==e.userId&&(l=s)})):"Split Payment"===s.transactionType&&(s.payeeId===e.userId?null==(n=s.contributorIds)||n.forEach(s=>{s!==e.userId&&(l=s)}):(null==(r=s.contributorIds)?void 0:r.includes(e.userId))&&(l=s.payeeId||null)),l){let e=a.get(l),t="User ".concat(l.slice(-4)),r="",n=b.find(e=>e.userId===l);n?(t=n.displayName||t,r=n.pictureUrl||"",console.log("\uD83D\uDC64 Found user details:",{userId:l,displayName:t,pictureUrl:r||"No picture URL"})):console.log("❌ User not found in allUsers:",l),e?(new Date(s.createdAt)>new Date(e.lastTransactionDate)&&(e.lastTransactionDate=s.createdAt),e.transactionCount+=1,console.log("\uD83D\uDCC8 Updated existing person:",l,"count:",e.transactionCount)):(a.set(l,{userId:l,displayName:t,pictureUrl:r,lastTransactionDate:s.createdAt,transactionCount:1}),console.log("\uD83C\uDD95 Added new person:",l))}});let r=Array.from(a.values()).sort((e,s)=>new Date(s.lastTransactionDate).getTime()-new Date(e.lastTransactionDate).getTime()).slice(0,10);console.log("✅ Recent people processed:",r),w(t),k(r)}catch(e){console.error("❌ Error fetching transaction history:",e)}finally{A(!1)}},[j,b,eC]),eT=(0,n.useCallback)(e=>{I(N.filter(s=>{var t,a,r;return"P2P"===s.transactionType?s.senderId===e.userId&&s.receiverId===(null==j?void 0:j.userId)||s.receiverId===e.userId&&s.senderId===(null==j?void 0:j.userId):"Bulk Transfer"===s.transactionType?s.senderId===e.userId||s.senderId===(null==j?void 0:j.userId)&&(null==(t=s.receiverIds)?void 0:t.includes(e.userId)):"Split Payment"===s.transactionType&&(s.payeeId===e.userId&&(null==(a=s.contributorIds)?void 0:a.includes((null==j?void 0:j.userId)||""))||s.payeeId===(null==j?void 0:j.userId)&&(null==(r=s.contributorIds)?void 0:r.includes(e.userId)))}).sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),R(e),P(!0)},[N,null==j?void 0:j.userId]);(0,n.useEffect)(()=>{(null==l?void 0:l.userId)&&eC().then(()=>{eA()})},[null==l?void 0:l.userId,eC,eA]);let eD=(e,s,t)=>{console.log("Payment successful:",{txHash:e,recipient:s,amount:t}),eu("Successfully sent ".concat(t," USDT to ").concat(s.displayName,"!")),setTimeout(()=>{eu(null)},5e3)},eI="0x1234567890abcdef1234567890abcdef12345678",eE=async()=>{try{await navigator.clipboard.writeText(eI),console.log("Wallet address copied to clipboard")}catch(e){console.error("Failed to copy wallet address:",e)}},eL=async()=>{try{navigator.share?await navigator.share({title:"My Wallet Address",text:"My wallet address: ".concat(eI),url:"ethereum:".concat(eI)}):(await navigator.clipboard.writeText("My wallet address: ".concat(eI)),console.log("Wallet address copied to clipboard for sharing"))}catch(e){console.error("Failed to share wallet address:",e)}};return(0,a.jsxs)("main",{className:"mx-auto max-w-md",children:[em&&(0,a.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-sm",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("span",{className:"text-sm font-medium",children:em})]})}),(0,a.jsxs)("header",{className:"pt-8 pb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 mb-8",children:[(0,a.jsx)("button",{onClick:()=>ed(!0),className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden hover:ring-2 hover:ring-green-500 transition-all",children:(0,a.jsx)("img",{src:(null==j?void 0:j.pictureUrl)||(null==o?void 0:o.pictureUrl)||(null==l?void 0:l.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsxs)("button",{onClick:()=>ef(!0),className:"relative w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),eg>0&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:eg>9?"9+":eg})]})]}),(0,a.jsxs)("div",{className:"px-6 mb-4",children:[(0,a.jsxs)("h1",{className:"text-2xl font-semibold text-gray-900 mb-1",children:["Hello ",(null==j?void 0:j.displayName)||(null==o?void 0:o.displayName)||(null==l?void 0:l.displayName)||"User","!"]}),(0,a.jsx)("p",{className:"text-gray-500",children:"Let's manage your money."}),(j||o)&&(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Wallet: ",null==(e=(null==j?void 0:j.walletAddress)||(null==o?void 0:o.walletAddress))?void 0:e.slice(0,6),"...",null==(s=(null==j?void 0:j.walletAddress)||(null==o?void 0:o.walletAddress))?void 0:s.slice(-4)]})]})]}),ep&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-80 max-w-sm mx-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Notifications"}),(0,a.jsx)("button",{onClick:()=>ef(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-2",children:(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-5 5-5-5h5v-13"})})}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No notifications"})]})]})}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-black mb-4",children:"Money Transfer"}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-4 shadow-lg grid grid-cols-4 gap-3",children:[(0,a.jsx)(el,{onClick:()=>M(!0),icon:(0,a.jsx)(c.A,{className:"w-5 h-5"}),label:"QR Pay"}),(0,a.jsx)(el,{onClick:()=>H(!0),icon:(0,a.jsx)(d.A,{className:"w-5 h-5"}),label:"Pay anyone"}),(0,a.jsx)(el,{onClick:()=>Z(!0),icon:(0,a.jsx)(m.A,{className:"w-5 h-5"}),label:"Split bills"}),(0,a.jsx)(el,{onClick:()=>er(!0),icon:(0,a.jsx)(u.A,{className:"w-5 h-5"}),label:"Bulk payment"})]})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-black mb-4",children:"Get Loan, Invest Money"}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-4 shadow-lg grid grid-cols-4 gap-3",children:[(0,a.jsx)(el,{onClick:()=>ey(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),label:"Earn Money"}),(0,a.jsx)(el,{onClick:()=>ev(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),label:"Take Loan"}),(0,a.jsx)(el,{onClick:()=>ew(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),label:"Loan Interest"}),(0,a.jsx)(el,{onClick:()=>ek(!0),icon:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})}),label:"Refer & Earn"})]})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Recent Transaction"}),(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("history"),className:"text-green-600 text-sm font-medium hover:text-green-700 transition-colors",children:"View All"})]}),(0,a.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-2 pt-2 px-2",children:C?[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 min-w-[60px]",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 animate-pulse"}),(0,a.jsx)("div",{className:"w-8 h-3 bg-gray-200 rounded animate-pulse"})]},s)):S.length>0?S.map(e=>(0,a.jsxs)("button",{onClick:()=>eT(e),className:"flex flex-col items-center gap-2 min-w-[60px] hover:opacity-75 transition-opacity",children:[(0,a.jsxs)("div",{className:"relative w-12 h-12",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-green-100",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://ui-avatars.com/api/?name=".concat(e.userId,"&background=random&color=fff&size=48"),alt:e.userId,className:"w-full h-full object-cover",onError:s=>{s.currentTarget.src="https://ui-avatars.com/api/?name=".concat(e.userId,"&background=random&color=fff&size=48")}})}),e.transactionCount>1&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:e.transactionCount>9?"9+":e.transactionCount})]}),(0,a.jsx)("span",{className:"text-xs text-gray-600 truncate max-w-[60px]",children:e.userId.length>8?e.userId.slice(0,8)+"...":e.userId})]},e.userId)):(0,a.jsxs)("div",{className:"w-full text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{className:"text-sm",children:"No recent transactions"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Start transacting to see recent people here"})]})})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Recent Transactions"}),(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("history"),className:"text-green-600 text-sm font-medium hover:text-green-700 transition-colors",children:"View All"})]}),(0,a.jsx)("div",{className:"bg-white rounded-2xl p-4 shadow-lg",children:C?[void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 border-b border-gray-100 last:border-0",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 animate-pulse"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse mb-1"}),(0,a.jsx)("div",{className:"w-16 h-3 bg-gray-200 rounded animate-pulse"})]}),(0,a.jsx)("div",{className:"w-16 h-4 bg-gray-200 rounded animate-pulse"})]},s)):N.length>0?N.slice(0,5).map(e=>{var s,t,r;let n="P2P"===e.transactionType?e.senderId===(null==j?void 0:j.userId)?e.receiverId:e.senderId:"Bulk Transfer"===e.transactionType?e.senderId===(null==j?void 0:j.userId)?null==(s=e.receiverIds)?void 0:s[0]:e.senderId:"Split Payment"===e.transactionType?e.payeeId===(null==j?void 0:j.userId)?null==(t=e.contributorIds)?void 0:t[0]:e.payeeId:null,l=b.find(e=>e.userId===n),o=e.receiverId===(null==j?void 0:j.userId)||(null==(r=e.receiverIds)?void 0:r.includes((null==j?void 0:j.userId)||""))||"Split Payment"===e.transactionType&&e.payeeId===(null==j?void 0:j.userId);return(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 border-b border-gray-100 last:border-0",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-100",children:(0,a.jsx)("img",{src:(null==l?void 0:l.pictureUrl)||"https://ui-avatars.com/api/?name=".concat(n,"&background=random&color=fff&size=40"),alt:n||"User",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://ui-avatars.com/api/?name=".concat(n,"&background=random&color=fff&size=40")}})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:n||"Unknown User"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.transactionType," • ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-semibold ".concat(o?"text-green-600":"text-red-600"),children:[o?"+":"-",e.amount," USDT"]}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:Array.isArray(e.status)?"Split Payment":e.status})]})]},e._id)}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{className:"text-sm",children:"No transactions yet"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Start making payments to see transactions here"})]})})]}),(0,a.jsxs)("section",{className:"px-6 mb-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Friends"})}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-4 shadow-lg",children:[i.length>0?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:i.slice(0,4).map((e,s)=>(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 p-3 rounded-xl hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"relative w-12 h-12",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden",children:(0,a.jsx)("img",{src:e.pictureUrl||"https://randomuser.me/api/portraits/men/".concat(s+1,".jpg"),alt:e.displayName,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/".concat(s+1,".jpg")}})}),Math.random()>.6&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:Math.floor(3*Math.random())+1})]}),(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900 text-center truncate",children:e.displayName})]},e.userId))}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No friends found"}),(0,a.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"Add friends on LINE to see them here"})]}),(0,a.jsx)("button",{onClick:()=>ei(!0),className:"w-full mt-4 py-3 text-green-600 text-sm font-medium border border-green-200 rounded-xl hover:bg-green-50 transition-colors",children:"View All"})]})]}),(0,a.jsx)("div",{className:"pb-24"}),(0,a.jsx)(p,{isOpen:h,onClose:()=>g(!1),onScan:e=>{console.log("QR Code scanned:",e)}}),(0,a.jsx)(z,{isOpen:_,onClose:()=>O(!1),onSelectContact:e=>{eh(e),O(!1),V(!0)}}),(0,a.jsx)(T,{isOpen:K,onClose:()=>H(!1),onSuccess:eD}),(0,a.jsx)(L,{isOpen:B,onClose:()=>M(!1),onSuccess:eD}),(0,a.jsx)(U,{isOpen:X,onClose:()=>Z(!1),onSuccess:e=>{console.log("Split bill created:",e),eu('Split bill "'.concat(e.title,'" created successfully!')),setTimeout(()=>{eu(null)},5e3)}}),(0,a.jsx)(W,{isOpen:ee,onClose:()=>er(!1),onSuccess:e=>{console.log("Bulk payment successful:",e),eu("Successfully sent ".concat(e.totalAmount," USDT to ").concat(e.recipients.length," recipients!")),setTimeout(()=>{eu(null)},5e3)}}),eb&&(0,a.jsx)(es,{onClose:()=>ey(!1)}),ej&&(0,a.jsx)(et,{onClose:()=>ev(!1)}),eN&&(0,a.jsx)(en,{onClose:()=>ew(!1)}),eS&&(0,a.jsx)(ea,{onClose:()=>ek(!1)}),(0,a.jsx)(G,{isOpen:Q,onClose:()=>V(!1),contact:ex,onPay:e=>{console.log("Pay to:",e)},onRequest:e=>{console.log("Request from:",e)}}),(0,a.jsx)(Y,{isOpen:J,onClose:()=>$(!1),onConfirmSplit:(e,s)=>{console.log("Split bill:",e,s)}}),(0,a.jsx)(q,{isOpen:eo,onClose:()=>ei(!1),onSelectContact:e=>{eh({id:e.userId,name:e.displayName,walletAddress:"",profilePhoto:e.pictureUrl||"",phoneNumber:""}),ei(!1),V(!0)},friends:i}),ec&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Profile"}),(0,a.jsx)("button",{onClick:()=>ed(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-100 overflow-hidden mb-3",children:(0,a.jsx)("img",{src:(null==l?void 0:l.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(null==l?void 0:l.displayName)||"LINE User"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==l?void 0:l.statusMessage)||"LINE DApp User"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Wallet Address"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsx)("code",{className:"flex-1 text-xs text-gray-600 font-mono break-all",children:eI}),(0,a.jsx)("button",{onClick:eE,className:"p-2 text-gray-500 hover:text-green-600 transition-colors",title:"Copy wallet address",children:(0,a.jsx)(u.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"QR Code Actions"}),(0,a.jsxs)("button",{onClick:()=>{let e=document.createElement("canvas"),s=e.getContext("2d");e.width=200,e.height=200,s&&(s.fillStyle="#000",s.fillRect(0,0,200,200),s.fillStyle="#fff",s.font="12px Arial",s.textAlign="center",s.fillText("QR Code",100,100),s.fillText("Placeholder",100,120));let t=document.createElement("a");t.download="wallet-qr-code.png",t.href=e.toDataURL(),t.click()},className:"w-full flex items-center justify-center gap-3 p-3 bg-green-50 text-green-700 rounded-lg border border-green-200 hover:bg-green-100 transition-colors",children:[(0,a.jsx)(c.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Download QR Code"})]}),(0,a.jsxs)("button",{onClick:eL,className:"w-full flex items-center justify-center gap-3 p-3 bg-blue-50 text-blue-700 rounded-lg border border-blue-200 hover:bg-blue-100 transition-colors",children:[(0,a.jsx)(m.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Share QR Code"})]})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsxs)("button",{onClick:x,className:"w-full flex items-center justify-center gap-3 p-3 bg-red-50 text-red-700 rounded-lg border border-red-200 hover:bg-red-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,a.jsx)("span",{className:"font-medium",children:"Logout"})]})})]})]})}),F&&E&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden",children:(0,a.jsx)("img",{src:E.pictureUrl||"https://randomuser.me/api/portraits/men/".concat(Math.floor(30*Math.random()),".jpg"),alt:E.displayName,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/".concat(Math.floor(30*Math.random()),".jpg")}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:E.displayName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[D.length," transactions"]})]})]}),(0,a.jsx)("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-4 max-h-96 overflow-y-auto",children:D.length>0?(0,a.jsx)("div",{className:"space-y-3",children:D.map(e=>{var s;let t=e.senderId===(null==o?void 0:o.userId),r=e.receiverId===(null==o?void 0:o.userId),n=e.payeeId===(null==o?void 0:o.userId),l=null==(s=e.contributorIds)?void 0:s.includes((null==o?void 0:o.userId)||""),i="",c="",d="";return"P2P"===e.transactionType?t?(i="Sent",c="-".concat(e.amount," USDT"),d="text-red-600"):r&&(i="Received",c="+".concat(e.amount," USDT"),d="text-green-600"):"Bulk Transfer"===e.transactionType?t?(i="Bulk Sent",c="-".concat(e.totalAmount," USDT"),d="text-red-600"):(i="Bulk Received",c="+".concat(e.userAmount||e.amount," USDT"),d="text-green-600"):"Split Payment"===e.transactionType&&(n?(i="Split Received",c="+".concat(e.totalAmount," USDT"),d="text-green-600"):l&&(i="Split Paid",c="-".concat(e.userAmount||e.amount," USDT"),d="text-red-600")),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(t||l?"bg-red-500":"bg-green-500")}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:i}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.transactionType})]}),(0,a.jsx)("span",{className:"text-sm font-semibold ".concat(d),children:c})]}),(e.description||e.title)&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.description||e.title}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("span",{className:"font-mono text-xs",children:[e.transactionHash.slice(0,8),"...",e.transactionHash.slice(-6)]})]})]},e._id)})}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,a.jsx)("p",{className:"text-sm",children:"No transactions found"})})})]})})]})}function en(e){let{onClose:s}=e;return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Loan Interest"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"p-6 flex-1 overflow-y-auto hide-scrollbar",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[(0,a.jsx)("h3",{className:"font-medium text-red-900 mb-3",children:"Accumulated Interest"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-700",children:"Loan Amount:"}),(0,a.jsx)("span",{className:"font-medium",children:"500.00 USDT"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-700",children:"Interest Rate:"}),(0,a.jsx)("span",{className:"font-medium",children:"5.5% APR"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-700",children:"Days Outstanding:"}),(0,a.jsx)("span",{className:"font-medium",children:"45 days"})]}),(0,a.jsx)("hr",{className:"border-red-200"}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-red-800 font-semibold",children:"Total Interest Due:"}),(0,a.jsx)("span",{className:"font-bold text-lg text-red-900",children:"12.45 USDT"})]})]})]}),(0,a.jsx)("div",{className:"bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Interest compounds daily. Pay early to save on interest charges."})}),(0,a.jsx)("button",{className:"w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors",children:"Pay Interest (12.45 USDT)"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{className:"text-gray-500 text-sm hover:text-gray-700 transition-colors",children:"View Interest History"})})]})})]})})}function el(e){let{onClick:s,icon:t,label:r}=e;return(0,a.jsxs)("button",{onClick:s,className:"flex flex-col items-center gap-2 p-2 rounded-xl hover:bg-gray-50 transition-colors",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600",children:t}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-700 text-center leading-tight",children:r})]})}function eo(){let{userProfile:e}=(0,r.A)(),[s,t]=(0,n.useState)([]),[l,o]=(0,n.useState)(null),[i,c]=(0,n.useState)(!0),[d,m]=(0,n.useState)(null),[u,x]=(0,n.useState)(null),[h,g]=(0,n.useState)(new Date().getMonth()),[p,b]=(0,n.useState)(!1),[y,j]=(0,n.useState)(null),[v,N]=(0,n.useState)(null),[w,S]=(0,n.useState)(null),k=(0,n.useCallback)(async()=>{if(null==e?void 0:e.userId)try{c(!0);let s=await fetch("".concat(f.PI.BACKEND_URL,"/api/history/getUserTxnHistory/").concat(e.userId));if(!s.ok)throw Error("Failed to fetch transaction history");let a=await s.json();t(a.transactions),o(a.summary),m(null)}catch(e){console.error("Error fetching transaction history:",e),m(e instanceof Error?e.message:"Failed to load transaction history")}finally{c(!1)}},[null==e?void 0:e.userId]);(0,n.useEffect)(()=>{k()},[k]),(0,n.useEffect)(()=>{b(!0)},[]);let C=(()=>{if(!s.length)return{totalReceived:0,totalSent:0,netBalance:0};let e=0,t=0;return s.forEach(s=>{let a=s.userAmount||s.amount||0;"receiver"===s.userRole||"contributor"===s.userRole?e+=a:("sender"===s.userRole||"payee"===s.userRole)&&(t+=a)}),{totalReceived:e,totalSent:t,netBalance:e-t}})(),A=(()=>{let e=Array(12).fill(0).map(()=>({receiving:0,spending:0}));return s.forEach(s=>{let t=new Date(s.createdAt).getMonth(),a=s.userAmount||s.amount||0;"receiver"===s.userRole||"contributor"===s.userRole?e[t].receiving+=a:("sender"===s.userRole||"payee"===s.userRole)&&(e[t].spending+=a)}),e})();return i?(0,a.jsx)("main",{className:"mx-auto max-w-md px-4 pb-24 pt-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading transaction history..."})]})}):d?(0,a.jsx)("main",{className:"mx-auto max-w-md px-4 pb-24 pt-4",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-red-600 mb-2",children:"⚠️ Error loading transactions"}),(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:d}),(0,a.jsx)("button",{onClick:k,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]})}):(0,a.jsxs)("main",{className:"mx-auto max-w-md px-4 pb-24 pt-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Transaction History"})}),(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-gray-900",children:[(0,a.jsx)("span",{className:"text-green-600",children:"$"}),Math.abs(C.netBalance).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["Net Transaction ",C.netBalance>=0?"(Positive)":"(Negative)"]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"overflow-x-auto pb-2",children:[(0,a.jsx)("div",{className:"flex items-end h-20 mb-2 relative min-w-max gap-2 px-2",children:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map((e,s)=>{let t=A[s],r=Math.max(...A.flatMap(e=>[e.receiving,e.spending])),n=r>0?t.receiving/r*60:0,l=r>0?t.spending/r*60:0;return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1 relative",children:[(0,a.jsxs)("div",{className:"flex flex-col items-end gap-0.5",children:[(0,a.jsx)("div",{className:"w-5 rounded-t-sm bg-gradient-to-t from-green-500 to-green-400 cursor-pointer hover:from-green-600 hover:to-green-500 transition-all",style:{height:"".concat(n,"px")},onMouseEnter:()=>x({month:e,type:"receiving",amount:t.receiving}),onMouseLeave:()=>x(null)}),(0,a.jsx)("div",{className:"w-5 rounded-t-sm bg-gradient-to-t from-red-500 to-red-400 cursor-pointer hover:from-red-600 hover:to-red-500 transition-all",style:{height:"".concat(l,"px")},onMouseEnter:()=>x({month:e,type:"spending",amount:t.spending}),onMouseLeave:()=>x(null)})]}),u&&u.month===e&&(0,a.jsxs)("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded shadow-lg whitespace-nowrap z-10",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-semibold",children:"receiving"===u.type?"Received":"Spent"}),(0,a.jsxs)("div",{children:["$",u.amount.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]},e)})}),(0,a.jsx)("div",{className:"flex justify-between text-xs text-gray-500 px-2",children:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>(0,a.jsx)("span",{className:"min-w-[24px] text-center",children:e},e))})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 mb-8 shadow-sm border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Analytics"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"2025"})})]}),(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer ".concat("received"===y?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200 hover:border-green-300"),onMouseEnter:()=>j("received"),onMouseLeave:()=>j(null),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-green-500 transition-colors ".concat("received"===y?"bg-[#16A34A]":y?"opacity-50":"")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium transition-colors ".concat("received"===y?"text-gray-900":y?"opacity-50":""),children:"Money Received"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Total incoming transactions"})]})]}),(0,a.jsxs)("span",{className:"text-xl font-bold text-green-600 transition-opacity ".concat(y&&"received"!==y?"opacity-50":""),children:["$",C.totalReceived.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer ".concat("sent"===y?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200 hover:border-red-300"),onMouseEnter:()=>j("sent"),onMouseLeave:()=>j(null),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-red-500 transition-colors ".concat("sent"===y?"bg-[#DC2626]":y?"opacity-50":"")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium transition-colors ".concat("sent"===y?"text-gray-900":y?"opacity-50":""),children:"Money Sent"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Total outgoing transactions"})]})]}),(0,a.jsxs)("span",{className:"text-xl font-bold text-red-600 transition-opacity ".concat(y&&"sent"!==y?"opacity-50":""),children:["$",C.totalSent.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer ".concat("available"===y?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200 hover:border-blue-300"),onMouseEnter:()=>j("available"),onMouseLeave:()=>j(null),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-blue-500 transition-colors ".concat("available"===y?"bg-[#2563EB]":y?"opacity-50":"")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium transition-colors ".concat("available"===y?"text-gray-900":y?"opacity-50":""),children:"Net Balance"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Difference between received and sent"})]})]}),(0,a.jsxs)("span",{className:"text-xl font-bold ".concat(C.netBalance>=0?"text-green-600":"text-red-600"," transition-opacity ").concat(y&&"available"!==y?"opacity-50":""),children:["$",Math.abs(C.netBalance).toLocaleString("en-US",{minimumFractionDigits:2})]})]})]})})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Transaction History"}),i?(0,a.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):d?(0,a.jsx)("div",{className:"text-center py-8 text-red-600",children:d}):(0,a.jsxs)("div",{className:"space-y-3",children:[s.map((e,s)=>{var t,r;let n="receiver"===e.userRole||"contributor"===e.userRole,l=e.userAmount||e.totalAmount||e.amount||0,o="";return"P2P"===e.transactionType?o=n?e.senderId||"Unknown Sender":e.receiverId||"Unknown Receiver":"Bulk Transfer"===e.transactionType?o="sender"===e.userRole?"Bulk Payment":"Bulk Received":"Split Payment"===e.transactionType&&(o=e.title||"Split Payment"),(0,a.jsx)("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat(n?"bg-green-100":"bg-red-100"),children:n?(0,a.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}):(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white ".concat("P2P"===e.transactionType?"bg-blue-500":"Bulk Transfer"===e.transactionType?"bg-purple-500":"bg-orange-500"),children:"P2P"===e.transactionType?"P":"Bulk Transfer"===e.transactionType?"B":"S"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("span",{className:"font-medium text-gray-900",children:o})}),"P2P"===e.transactionType&&(0,a.jsx)("div",{className:"text-xs text-gray-400 font-mono truncate mt-1",children:n?"From: ".concat(e.senderId):"To: ".concat(e.receiverId)}),"Bulk Transfer"===e.transactionType&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 truncate mt-1",children:["Bulk Transfer • ",(null==(t=e.receiverIds)?void 0:t.length)||0," recipients"]}),"Split Payment"===e.transactionType&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 truncate mt-1",children:["Split Bill • ",(null==(r=e.contributorIds)?void 0:r.length)||0," contributors",e.deadline&&" • Due: ".concat(new Date(e.deadline).toLocaleDateString())]}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-600 truncate mt-1",children:e.description})]}),(0,a.jsxs)("div",{className:"text-right flex-shrink-0 ml-2",children:[(0,a.jsxs)("div",{className:"font-semibold ".concat(n?"text-green-600":"text-red-600"),children:[n?"+":"-","$",Math.abs(l).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"string"==typeof e.status?e.status:"Completed"})]})]})},e._id||s)}),0===s.length&&!i&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No transactions found"})]})]})]})}var ei=t(86867),ec=t(10874),ed=t(51691),em=t(72019);function eu(e){let{className:s="",showBalance:t=!0,compact:l=!1}=e,{wallet:o,connectWallet:i,disconnectWallet:c,refreshWalletData:d,getTokenBalance:m}=(0,r.A)(),[u,x]=(0,n.useState)(null),[h,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!1),[b,v]=(0,n.useState)(null),[N,w]=(0,n.useState)(null),A=(0,n.useCallback)(async()=>{if(!o.address)return void x(null);g(!0);try{console.log("\uD83D\uDD0D Loading USDT balance for:",o.address);let e=await y(o.address);x(e),console.log("✅ USDT balance loaded:",e)}catch(e){console.error("❌ Failed to load USDT balance:",e),x(null)}finally{g(!1)}},[o.address]),T=async()=>{try{console.log("\uD83D\uDD17 Connecting wallet..."),console.log("\uD83D\uDCA1 DappPortal will show wallet creation UI if user has no wallet");let e=await i();e&&(console.log("✅ Wallet connected:",e),t&&setTimeout(()=>{A()},1e3))}catch(e){console.error("❌ Wallet connection failed:",e)}},D=async()=>{if(!o.address)return void v("Wallet not connected");f(!0),v(null),w(null);try{console.log("\uD83D\uDEB0 Requesting USDT from faucet...");let e=await j(o.address);if(e.success){let s=e.gasless?" ⚡ (Gasless)":" \uD83D\uDCB0 (Paid Gas)";w("Success! Transaction: ".concat(e.transactionHash).concat(s)),setTimeout(()=>{A()},5e3)}else v(e.error||"Faucet request failed")}catch(e){console.error("❌ Faucet request error:",e),v(e instanceof Error?e.message:"Unknown error")}finally{f(!1)}},I=async()=>{try{await d(),o.isConnected&&t&&A()}catch(e){console.error("Failed to refresh wallet data:",e)}};(0,n.useEffect)(()=>{o.isConnected&&o.address&&t&&A()},[o.isConnected,o.address,t,A]),(0,n.useEffect)(()=>{if(N||b){let e=setTimeout(()=>{w(null),v(null)},1e4);return()=>clearTimeout(e)}},[N,b]);let E=e=>"".concat(e.slice(0,6),"...").concat(e.slice(-4));return l?(0,a.jsx)("div",{className:"flex items-center gap-2 ".concat(s),children:o.isConnected?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1.5 rounded-full text-sm",children:[(0,a.jsx)(k.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:E(o.address)})]}),(0,a.jsx)("button",{onClick:I,disabled:o.isLoading,className:"p-1.5 text-gray-500 hover:text-gray-700 rounded-full hover:bg-gray-100 transition-colors",children:(0,a.jsx)(ec.A,{className:"w-4 h-4 ".concat(o.isLoading?"animate-spin":"")})})]}):(0,a.jsxs)("button",{onClick:T,disabled:o.isLoading,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full text-sm font-medium transition-colors disabled:opacity-50",children:[o.isLoading?(0,a.jsx)(ec.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(ed.A,{className:"w-4 h-4"}),"Setup Wallet"]})}):(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-gray-100 ".concat(s),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Kaia Testnet Wallet"}),o.isConnected&&(0,a.jsx)("button",{onClick:I,disabled:o.isLoading,className:"p-2 text-gray-500 hover:text-gray-700 rounded-full hover:bg-gray-100 transition-colors",title:"Refresh wallet data",children:(0,a.jsx)(ec.A,{className:"w-5 h-5 ".concat(o.isLoading?"animate-spin":"")})})]}),o.error&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[(0,a.jsx)(C.A,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm",children:o.error})]}),o.isConnected?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Wallet Type"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:o.walletType?(e=>{switch(e){case ei.S4.Liff:return"LINE Wallet";case ei.S4.Web:return"Web Wallet";case ei.S4.Extension:return"Browser Extension";case ei.S4.Mobile:return"Mobile Wallet";case ei.S4.OKX:return"OKX Wallet";case ei.S4.BITGET:return"Bitget Wallet";default:return"Wallet"}})(o.walletType):"Unknown"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Address"}),(0,a.jsx)("span",{className:"text-sm font-mono text-gray-900",children:E(o.address)})]})]}),t&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900",children:"Balances"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-bold text-blue-600",children:"K"})}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"KAIA"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:o.isLoading?(0,a.jsx)(ec.A,{className:"w-4 h-4 animate-spin inline"}):"".concat(o.balance||"0.000000"," KAIA")}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Testnet"})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(em.A,{className:"w-4 h-4 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"USDT"}),(0,a.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full",children:"Testnet"}),h&&(0,a.jsx)(ec.A,{className:"w-4 h-4 animate-spin text-green-500"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:h?"Loading...":u?"".concat(u.balance," USDT"):"0.00 USDT"})]})]}),(0,a.jsxs)("button",{onClick:D,disabled:p||!o.address,className:"flex items-center gap-1 px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-xs font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(S.A,{className:"w-4 h-4"}),p?"Getting...":"Get USDT"]})]}),N&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-green-100 border border-green-200 rounded-lg",children:[(0,a.jsx)("p",{className:"text-green-800 text-sm font-medium",children:"✅ Faucet Success!"}),(0,a.jsx)("p",{className:"text-green-700 text-xs mt-1 break-all",children:N})]}),b&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-red-100 border border-red-200 rounded-lg",children:[(0,a.jsx)("p",{className:"text-red-800 text-sm font-medium",children:"❌ Faucet Error"}),(0,a.jsx)("p",{className:"text-red-700 text-xs mt-1",children:b})]})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(ed.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Your Kaia testnet wallet will be created automatically when you log in"}),(0,a.jsx)("button",{onClick:T,disabled:o.isLoading,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-xl transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:o.isLoading?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.A,{className:"w-5 h-5 animate-spin"}),"Setting up wallet..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ed.A,{className:"w-5 h-5"}),"Setup Wallet"]})})]})]})}var ex=t(67016);class eh{async checkBalance(){try{console.log("\uD83D\uDD0D Checking fee delegation service balance...");let e=this.apiKey?"".concat(this.serviceUrl,"/api/balance"):"".concat(this.serviceUrl,"/api/balance?address=").concat(f.PI.USDT_ADDRESS),s={"Content-Type":"application/json"};this.apiKey&&(s.Authorization="Bearer ".concat(this.apiKey));let t=await fetch(e,{method:"GET",headers:s}),a=await t.json();if(t.ok&&a.status)return{sufficient:!0===a.data,message:a.message||"Balance check completed"};return{sufficient:!1,message:a.message||"Failed to check balance"}}catch(e){return console.error("❌ Fee delegation balance check failed:",e),{sufficient:!1,message:e instanceof Error?e.message:"Unknown error"}}}async submitFeeDelegatedTransaction(e){try{var s,t;console.log("\uD83D\uDCE4 Submitting fee-delegated transaction to service...");let a={"Content-Type":"application/json"};this.apiKey&&(a.Authorization="Bearer ".concat(this.apiKey)),console.log("\uD83D\uDD17 Calling fee delegation service:",{url:"".concat(this.serviceUrl,"/api/signAsFeePayer"),hasApiKey:!!this.apiKey,txLength:e.length});let r=await fetch("".concat(this.serviceUrl,"/api/signAsFeePayer"),{method:"POST",headers:a,body:JSON.stringify({userSignedTx:{raw:e}})}),n=await r.json();if(console.log("\uD83D\uDCE5 Fee delegation service response:",{status:r.status,ok:r.ok,resultStatus:n.status,message:n.message}),!r.ok||!n.status)return{success:!1,error:n.error||"UNKNOWN_ERROR",message:n.data||n.message||"Fee delegation failed"};return{success:!0,transactionHash:(null==(s=n.data)?void 0:s.hash)||(null==(t=n.data)?void 0:t.transactionHash),transactionReceipt:n.data,message:n.message||"Transaction successful"}}catch(e){return console.error("❌ Fee delegation submission failed:",e),{success:!1,error:"NETWORK_ERROR",message:e instanceof Error?e.message:"Network error occurred"}}}createFaucetTransaction(e){return{type:ex.zd.FeeDelegatedSmartContractExecution,from:e,to:f.PI.USDT_ADDRESS,value:"0x0",data:"0x0c11dedd",gasLimit:"0x186A0"}}createTransferTransaction(e,s,t){let a=s.slice(2).padStart(64,"0"),r=BigInt(t).toString(16).padStart(64,"0");return{type:ex.zd.FeeDelegatedSmartContractExecution,from:e,to:f.PI.USDT_ADDRESS,value:"0x0",data:"0xa9059cbb"+a+r,gasLimit:"0x186A0"}}createApprovalTransaction(e,s,t){let a=s.slice(2).padStart(64,"0"),r=BigInt(t).toString(16).padStart(64,"0");return{type:ex.zd.FeeDelegatedSmartContractExecution,from:e,to:f.PI.USDT_ADDRESS,value:"0x0",data:"0x095ea7b3"+a+r,gasLimit:"0x186A0"}}createValueTransferTransaction(e,s,t){return{type:ex.zd.FeeDelegatedValueTransfer,from:e,to:s,value:(0,ex.cA)(t).toString(),gasLimit:"0x7530"}}constructor(e){this.serviceUrl=f.PI.FEE_DELEGATION_URL,this.apiKey=e,console.log("\uD83D\uDD27 Fee Delegation Service initialized:",{serviceUrl:this.serviceUrl,hasApiKey:!!this.apiKey})}}let eg=null;class ep{async executeGaslessFaucet(e){try{console.log("\uD83D\uDEB0 Executing gasless faucet request..."),await new Promise(e=>setTimeout(e,2e3));let e="0xfd"+Math.random().toString(16).substring(2,64);return console.log("✅ Gasless faucet successful:",e),{success:!0,transactionHash:e,gasless:!0}}catch(e){return console.error("❌ Gasless faucet failed:",e),{success:!1,error:e instanceof Error?e.message:"Gasless faucet failed",gasless:!1}}}async executeGaslessTransfer(e,s,t){try{console.log("\uD83D\uDCB8 Executing gasless USDT transfer...",{from:e,to:s,amount:t}),await new Promise(e=>setTimeout(e,3e3));let a="0xfd"+Math.random().toString(16).substring(2,64);return console.log("✅ Gasless transfer successful:",a),{success:!0,transactionHash:a,gasless:!0}}catch(e){return console.error("❌ Gasless transfer failed:",e),{success:!1,error:e instanceof Error?e.message:"Gasless transfer failed",gasless:!1}}}async isServiceAvailable(){try{return(await this.feeDelegationService.checkBalance()).sufficient}catch(e){return console.error("❌ Fee delegation service unavailable:",e),!1}}async getServiceStatus(){try{let e=await this.feeDelegationService.checkBalance();return{available:e.sufficient,message:e.message}}catch(e){return{available:!1,message:"Fee delegation service is currently unavailable"}}}constructor(e){this.provider=new ex.FR(f.PI.RPC_URL),this.feeDelegationService=(eg||(eg=new eh(e)),eg),console.log("⚡ Gasless Transaction Service initialized")}}let ef=null;function eb(){let{user:e,logout:s,wallet:t}=(0,r.A)(),[l,o]=(0,n.useState)(!1),[i,d]=(0,n.useState)(!1),[x]=(0,n.useState)(3),[h,g]=(0,n.useState)(null),[p]=(0,n.useState)([{id:"1",name:"KAIA Network",network:"KAIA",balance:"$8,182.80",address:"0x1234...5678",isActive:!0},{id:"2",name:"BSC Network",network:"BSC",balance:"$12,345.67",address:"0xdef...789a",isActive:!1},{id:"3",name:"ETH Network",network:"ETH",balance:"$5,432.10",address:"0xabc...def0",isActive:!1}]),f=(0,n.useCallback)(async()=>{try{let e=(ef||(ef=new ep(void 0)),ef),s=await e.getServiceStatus();g(s.available),console.log("Fee delegation service status:",s)}catch(e){console.error("Failed to check fee delegation service:",e),g(!1)}},[]);(0,n.useEffect)(()=>{t.isConnected&&t.address&&f()},[t.isConnected,t.address,f]),(0,n.useCallback)(e=>{console.log("Switching to account:",e)},[]);let b=async()=>{let e=t.address||"0x1234567890abcdef1234567890abcdef12345678";try{await navigator.clipboard.writeText(e),console.log("Wallet address copied to clipboard")}catch(e){console.error("Failed to copy wallet address:",e)}},y=async()=>{let e=t.address||"0x1234567890abcdef1234567890abcdef12345678";try{navigator.share?await navigator.share({title:"My Wallet Address",text:"My wallet address: ".concat(e),url:"ethereum:".concat(e)}):(await navigator.clipboard.writeText("My wallet address: ".concat(e)),console.log("Wallet address copied to clipboard for sharing"))}catch(e){console.error("Failed to share wallet address:",e)}};return(0,a.jsxs)("main",{className:"mx-auto max-w-md",children:[(0,a.jsxs)("header",{className:"pt-8 pb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 mb-8",children:[(0,a.jsx)("button",{onClick:()=>d(!0),className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden hover:ring-2 hover:ring-green-500 transition-all",children:(0,a.jsx)("img",{src:(null==e?void 0:e.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsxs)("button",{className:"relative w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),x>0&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg border-2 border-white",children:x>9?"9+":x})]})]}),(0,a.jsxs)("div",{className:"px-6 mb-8",children:[(0,a.jsxs)("h1",{className:"text-2xl font-semibold text-gray-900 mb-1",children:["Hello ",(null==e?void 0:e.displayName)||"User","!"]}),(0,a.jsx)("p",{className:"text-gray-500",children:"Let's manage your crypto wallet."})]}),(0,a.jsx)("div",{className:"px-6 mb-8",children:(0,a.jsx)(eu,{compact:!0,showBalance:!1})}),(0,a.jsxs)("div",{className:"px-4 mt-24 relative",children:[(0,a.jsx)("div",{className:"absolute inset-x-0 top-0 transform -translate-y-16 -rotate-6 origin-top-left",children:(0,a.jsx)("div",{className:"bg-gradient-to-br from-emerald-400 to-emerald-500 rounded-[28px] p-6 shadow-lg",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Balance"}),(0,a.jsx)("div",{className:"text-white text-[32px] font-normal",children:"$5,432.10"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Network"}),(0,a.jsx)("div",{className:"text-white text-xl font-normal",children:"ETH Network"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-white text-base font-light",children:"0xabc...def0"})]})]})]})})}),(0,a.jsx)("div",{className:"absolute inset-x-0 top-0 transform -translate-y-8 -rotate-3 origin-top-left",children:(0,a.jsx)("div",{className:"bg-gradient-to-br from-amber-400 to-amber-500 rounded-[28px] p-6 shadow-lg",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Balance"}),(0,a.jsx)("div",{className:"text-white text-[32px] font-normal",children:"$12,345.67"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Network"}),(0,a.jsx)("div",{className:"text-white text-xl font-normal",children:"BSC Network"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-white text-base font-light",children:"0xdef...789a"})]})]})]})})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"bg-[#8A6FE8] rounded-[28px] p-6 relative",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Balance"}),(0,a.jsx)("div",{className:"text-white text-[32px] font-normal",children:t.isConnected&&t.balance?"".concat(t.balance," KAIA"):"Connect Wallet"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Network"}),(0,a.jsxs)("div",{className:"text-white text-xl font-normal",children:["Kaia Testnet",t.walletType&&(0,a.jsx)("span",{className:"text-sm text-white/70 block",children:"Liff"===t.walletType?"LINE Wallet":t.walletType})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-white/90 text-base font-light mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-white text-base font-light",children:t.address?"".concat(t.address.slice(0,6),"...").concat(t.address.slice(-4)):"Not Connected"})]})]})]})})})]}),i&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md mx-4 bg-white rounded-2xl shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Profile"}),(0,a.jsx)("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mb-6",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-100 overflow-hidden mb-3",children:(0,a.jsx)("img",{src:(null==e?void 0:e.pictureUrl)||"https://randomuser.me/api/portraits/men/0.jpg",alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://randomuser.me/api/portraits/women/0.jpg"}})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(null==e?void 0:e.displayName)||"LINE User"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==e?void 0:e.statusMessage)||"LINE DApp User"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Wallet Address"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsx)("code",{className:"flex-1 text-xs text-gray-600 font-mono break-all",children:t.address||"Not connected"}),(0,a.jsx)("button",{onClick:b,disabled:!t.address,className:"p-2 text-gray-500 hover:text-green-600 transition-colors disabled:opacity-50",title:"Copy wallet address",children:(0,a.jsx)(u.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"QR Code Actions"}),(0,a.jsxs)("button",{onClick:()=>{let e=document.createElement("canvas"),s=e.getContext("2d");e.width=200,e.height=200,s&&(s.fillStyle="#000",s.fillRect(0,0,200,200),s.fillStyle="#fff",s.font="12px Arial",s.textAlign="center",s.fillText("QR Code",100,100),s.fillText("Placeholder",100,120));let t=document.createElement("a");t.download="wallet-qr-code.png",t.href=e.toDataURL(),t.click()},className:"w-full flex items-center justify-center gap-3 p-3 bg-green-50 text-green-700 rounded-lg border border-green-200 hover:bg-green-100 transition-colors",children:[(0,a.jsx)(c.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Download QR Code"})]}),(0,a.jsxs)("button",{onClick:y,className:"w-full flex items-center justify-center gap-3 p-3 bg-blue-50 text-blue-700 rounded-lg border border-blue-200 hover:bg-blue-100 transition-colors",children:[(0,a.jsx)(m.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"font-medium",children:"Share QR Code"})]})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsxs)("button",{onClick:()=>{s(),d(!1)},className:"w-full flex items-center justify-center gap-3 p-3 bg-red-50 text-red-700 rounded-lg border border-red-200 hover:bg-red-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,a.jsx)("span",{className:"font-medium",children:"Sign Out"})]})})]})]})}),t.isConnected&&(0,a.jsx)("div",{className:"mt-8 px-4",children:(0,a.jsx)(eu,{showBalance:!0,compact:!1})})]}),t.address&&(0,a.jsx)("section",{className:"px-6 mb-6",children:(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 font-medium ",children:"Receive"}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Share your wallet address"})]}),(0,a.jsx)("div",{className:"w-24 h-24 flex items-center justify-center bg-white rounded-lg",children:(0,a.jsx)(D.X,{value:t.address,size:92})})]})})]})}function ey(){let[e,s]=(0,n.useState)("home"),[t,r]=(0,n.useState)(!1),c=t=>{t!==e&&(r(!0),setTimeout(()=>{s(t),r(!1)},150))};return(0,a.jsxs)("div",{className:"min-h-dvh flex flex-col bg-gray-50",children:[(0,a.jsx)("div",{className:"flex-1 min-h-0 relative",children:t?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50",children:(0,a.jsx)("div",{className:"w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})}):(()=>{switch(e){case"home":default:return(0,a.jsx)("div",{className:"animate-fadeIn",children:(0,a.jsx)(er,{onTabChange:c})},"home");case"history":return(0,a.jsx)("div",{className:"animate-fadeIn",children:(0,a.jsx)(eo,{})},"history");case"portfolio":return(0,a.jsx)("div",{className:"animate-fadeIn",children:(0,a.jsx)(eb,{})},"portfolio")}})()}),(0,a.jsx)("nav",{className:"sticky bottom-0 inset-x-0 mb-6",children:(0,a.jsx)("div",{className:"mx-auto max-w-md",children:(0,a.jsxs)("div",{className:"bg-white backdrop-blur-sm rounded-full flex justify-between items-center text-xs px-2 py-2 shadow-2xl border border-gray-200 mx-4",children:[(0,a.jsx)(ej,{tab:"home",active:"home"===e,onClick:()=>c("home"),label:"Home",children:(0,a.jsx)(l.A,{className:"w-6 h-6"})}),(0,a.jsx)(ej,{tab:"history",active:"history"===e,onClick:()=>c("history"),label:"History",children:(0,a.jsx)(o.A,{className:"w-6 h-6"})}),(0,a.jsx)(ej,{tab:"portfolio",active:"portfolio"===e,onClick:()=>c("portfolio"),label:"Profile",children:(0,a.jsx)(i.A,{className:"w-6 h-6"})})]})})})]})}function ej(e){let{active:s,onClick:t,label:r,children:n}=e;return(0,a.jsxs)("button",{onClick:t,className:"flex items-center gap-2 transition-all duration-300 hover:scale-105",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 ".concat(s?"bg-green-100 text-green-600 shadow-lg shadow-green-100/25":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:n}),(0,a.jsx)("div",{className:"overflow-hidden transition-all duration-300 ".concat(s?"w-16 opacity-100":"w-0 opacity-0"),children:(0,a.jsx)("span",{className:"text-sm font-medium whitespace-nowrap text-gray-900",children:r})})]})}var ev=t(80238),eN=t(33275);function ew(){let{isAuthenticated:e,isLoading:s}=(0,r.A)();return s?(0,a.jsx)(eN.A,{message:"Loading..."}):e?(0,a.jsx)(ey,{}):(0,a.jsx)(ev.default,{})}}},e=>{e.O(0,[4935,6793,2932,4590,2896,1029,7852,2626,238,8441,1255,7358],()=>e(e.s=59137)),_N_E=e.O()}]);